
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Poisson - 网络书屋(Web Reading Room)</title>
  <meta name="author" content="Ye Zhaoliang">

  
  <meta name="description" content="poisson.f90 code notelink1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jueqingsizhe66.github.io/blog/2014/05/14/poisson">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="网络书屋(Web Reading Room)" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">网络书屋(Web Reading Room)</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss email">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
    <li><a href="zhaoturkey@163.com" rel="subscribe-email" title="subscribe via email">Email</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jueqingsizhe66.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Poisson</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-14T02:09:00+08:00" pubdate data-updated="true">May 14<span>th</span>, 2014</time>
        

         
          | <a href="#comments">Comments</a>
         
      </p>
    
  </header>


<div class="entry-content"><!--more-->




<figure class='code'><figcaption><span>poisson.f90 code note</span><a href='http://jueqingsizhe66.github.io'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
<span class='line-number'>314</span>
<span class='line-number'>315</span>
<span class='line-number'>316</span>
<span class='line-number'>317</span>
<span class='line-number'>318</span>
<span class='line-number'>319</span>
<span class='line-number'>320</span>
<span class='line-number'>321</span>
<span class='line-number'>322</span>
<span class='line-number'>323</span>
<span class='line-number'>324</span>
<span class='line-number'>325</span>
<span class='line-number'>326</span>
<span class='line-number'>327</span>
<span class='line-number'>328</span>
<span class='line-number'>329</span>
<span class='line-number'>330</span>
<span class='line-number'>331</span>
<span class='line-number'>332</span>
<span class='line-number'>333</span>
<span class='line-number'>334</span>
<span class='line-number'>335</span>
<span class='line-number'>336</span>
<span class='line-number'>337</span>
<span class='line-number'>338</span>
<span class='line-number'>339</span>
<span class='line-number'>340</span>
<span class='line-number'>341</span>
<span class='line-number'>342</span>
<span class='line-number'>343</span>
<span class='line-number'>344</span>
<span class='line-number'>345</span>
<span class='line-number'>346</span>
<span class='line-number'>347</span>
<span class='line-number'>348</span>
<span class='line-number'>349</span>
<span class='line-number'>350</span>
<span class='line-number'>351</span>
<span class='line-number'>352</span>
<span class='line-number'>353</span>
<span class='line-number'>354</span>
<span class='line-number'>355</span>
<span class='line-number'>356</span>
<span class='line-number'>357</span>
<span class='line-number'>358</span>
<span class='line-number'>359</span>
<span class='line-number'>360</span>
<span class='line-number'>361</span>
<span class='line-number'>362</span>
<span class='line-number'>363</span>
<span class='line-number'>364</span>
<span class='line-number'>365</span>
<span class='line-number'>366</span>
<span class='line-number'>367</span>
<span class='line-number'>368</span>
<span class='line-number'>369</span>
<span class='line-number'>370</span>
<span class='line-number'>371</span>
<span class='line-number'>372</span>
<span class='line-number'>373</span>
<span class='line-number'>374</span>
<span class='line-number'>375</span>
<span class='line-number'>376</span>
<span class='line-number'>377</span>
<span class='line-number'>378</span>
<span class='line-number'>379</span>
<span class='line-number'>380</span>
<span class='line-number'>381</span>
<span class='line-number'>382</span>
<span class='line-number'>383</span>
<span class='line-number'>384</span>
<span class='line-number'>385</span>
<span class='line-number'>386</span>
<span class='line-number'>387</span>
<span class='line-number'>388</span>
<span class='line-number'>389</span>
<span class='line-number'>390</span>
<span class='line-number'>391</span>
<span class='line-number'>392</span>
<span class='line-number'>393</span>
<span class='line-number'>394</span>
<span class='line-number'>395</span>
<span class='line-number'>396</span>
<span class='line-number'>397</span>
<span class='line-number'>398</span>
<span class='line-number'>399</span>
<span class='line-number'>400</span>
<span class='line-number'>401</span>
<span class='line-number'>402</span>
<span class='line-number'>403</span>
<span class='line-number'>404</span>
<span class='line-number'>405</span>
<span class='line-number'>406</span>
<span class='line-number'>407</span>
<span class='line-number'>408</span>
<span class='line-number'>409</span>
<span class='line-number'>410</span>
<span class='line-number'>411</span>
<span class='line-number'>412</span>
<span class='line-number'>413</span>
<span class='line-number'>414</span>
<span class='line-number'>415</span>
<span class='line-number'>416</span>
<span class='line-number'>417</span>
<span class='line-number'>418</span>
<span class='line-number'>419</span>
<span class='line-number'>420</span>
<span class='line-number'>421</span>
<span class='line-number'>422</span>
<span class='line-number'>423</span>
<span class='line-number'>424</span>
<span class='line-number'>425</span>
<span class='line-number'>426</span>
<span class='line-number'>427</span>
<span class='line-number'>428</span>
<span class='line-number'>429</span>
<span class='line-number'>430</span>
<span class='line-number'>431</span>
<span class='line-number'>432</span>
<span class='line-number'>433</span>
<span class='line-number'>434</span>
<span class='line-number'>435</span>
<span class='line-number'>436</span>
<span class='line-number'>437</span>
<span class='line-number'>438</span>
<span class='line-number'>439</span>
<span class='line-number'>440</span>
<span class='line-number'>441</span>
<span class='line-number'>442</span>
<span class='line-number'>443</span>
<span class='line-number'>444</span>
<span class='line-number'>445</span>
<span class='line-number'>446</span>
<span class='line-number'>447</span>
<span class='line-number'>448</span>
<span class='line-number'>449</span>
<span class='line-number'>450</span>
<span class='line-number'>451</span>
<span class='line-number'>452</span>
<span class='line-number'>453</span>
<span class='line-number'>454</span>
<span class='line-number'>455</span>
<span class='line-number'>456</span>
<span class='line-number'>457</span>
<span class='line-number'>458</span>
<span class='line-number'>459</span>
<span class='line-number'>460</span>
<span class='line-number'>461</span>
<span class='line-number'>462</span>
<span class='line-number'>463</span>
<span class='line-number'>464</span>
<span class='line-number'>465</span>
<span class='line-number'>466</span>
<span class='line-number'>467</span>
<span class='line-number'>468</span>
<span class='line-number'>469</span>
<span class='line-number'>470</span>
<span class='line-number'>471</span>
<span class='line-number'>472</span>
<span class='line-number'>473</span>
<span class='line-number'>474</span>
<span class='line-number'>475</span>
<span class='line-number'>476</span>
<span class='line-number'>477</span>
<span class='line-number'>478</span>
<span class='line-number'>479</span>
<span class='line-number'>480</span>
<span class='line-number'>481</span>
<span class='line-number'>482</span>
<span class='line-number'>483</span>
<span class='line-number'>484</span>
<span class='line-number'>485</span>
<span class='line-number'>486</span>
<span class='line-number'>487</span>
<span class='line-number'>488</span>
<span class='line-number'>489</span>
<span class='line-number'>490</span>
<span class='line-number'>491</span>
<span class='line-number'>492</span>
<span class='line-number'>493</span>
<span class='line-number'>494</span>
<span class='line-number'>495</span>
<span class='line-number'>496</span>
<span class='line-number'>497</span>
<span class='line-number'>498</span>
<span class='line-number'>499</span>
<span class='line-number'>500</span>
<span class='line-number'>501</span>
<span class='line-number'>502</span>
<span class='line-number'>503</span>
<span class='line-number'>504</span>
<span class='line-number'>505</span>
<span class='line-number'>506</span>
<span class='line-number'>507</span>
<span class='line-number'>508</span>
<span class='line-number'>509</span>
<span class='line-number'>510</span>
<span class='line-number'>511</span>
<span class='line-number'>512</span>
<span class='line-number'>513</span>
<span class='line-number'>514</span>
<span class='line-number'>515</span>
<span class='line-number'>516</span>
<span class='line-number'>517</span>
<span class='line-number'>518</span>
<span class='line-number'>519</span>
<span class='line-number'>520</span>
<span class='line-number'>521</span>
<span class='line-number'>522</span>
<span class='line-number'>523</span>
<span class='line-number'>524</span>
<span class='line-number'>525</span>
<span class='line-number'>526</span>
<span class='line-number'>527</span>
<span class='line-number'>528</span>
<span class='line-number'>529</span>
<span class='line-number'>530</span>
<span class='line-number'>531</span>
<span class='line-number'>532</span>
<span class='line-number'>533</span>
<span class='line-number'>534</span>
<span class='line-number'>535</span>
<span class='line-number'>536</span>
<span class='line-number'>537</span>
<span class='line-number'>538</span>
<span class='line-number'>539</span>
<span class='line-number'>540</span>
<span class='line-number'>541</span>
<span class='line-number'>542</span>
<span class='line-number'>543</span>
<span class='line-number'>544</span>
<span class='line-number'>545</span>
<span class='line-number'>546</span>
<span class='line-number'>547</span>
<span class='line-number'>548</span>
<span class='line-number'>549</span>
<span class='line-number'>550</span>
<span class='line-number'>551</span>
<span class='line-number'>552</span>
<span class='line-number'>553</span>
<span class='line-number'>554</span>
<span class='line-number'>555</span>
<span class='line-number'>556</span>
<span class='line-number'>557</span>
<span class='line-number'>558</span>
<span class='line-number'>559</span>
<span class='line-number'>560</span>
<span class='line-number'>561</span>
<span class='line-number'>562</span>
<span class='line-number'>563</span>
<span class='line-number'>564</span>
<span class='line-number'>565</span>
<span class='line-number'>566</span>
<span class='line-number'>567</span>
<span class='line-number'>568</span>
<span class='line-number'>569</span>
<span class='line-number'>570</span>
<span class='line-number'>571</span>
<span class='line-number'>572</span>
<span class='line-number'>573</span>
<span class='line-number'>574</span>
<span class='line-number'>575</span>
<span class='line-number'>576</span>
<span class='line-number'>577</span>
<span class='line-number'>578</span>
<span class='line-number'>579</span>
<span class='line-number'>580</span>
<span class='line-number'>581</span>
<span class='line-number'>582</span>
<span class='line-number'>583</span>
<span class='line-number'>584</span>
<span class='line-number'>585</span>
<span class='line-number'>586</span>
<span class='line-number'>587</span>
<span class='line-number'>588</span>
<span class='line-number'>589</span>
<span class='line-number'>590</span>
<span class='line-number'>591</span>
<span class='line-number'>592</span>
<span class='line-number'>593</span>
<span class='line-number'>594</span>
<span class='line-number'>595</span>
<span class='line-number'>596</span>
<span class='line-number'>597</span>
<span class='line-number'>598</span>
<span class='line-number'>599</span>
<span class='line-number'>600</span>
<span class='line-number'>601</span>
<span class='line-number'>602</span>
<span class='line-number'>603</span>
<span class='line-number'>604</span>
<span class='line-number'>605</span>
<span class='line-number'>606</span>
<span class='line-number'>607</span>
<span class='line-number'>608</span>
<span class='line-number'>609</span>
<span class='line-number'>610</span>
<span class='line-number'>611</span>
<span class='line-number'>612</span>
<span class='line-number'>613</span>
<span class='line-number'>614</span>
<span class='line-number'>615</span>
<span class='line-number'>616</span>
<span class='line-number'>617</span>
<span class='line-number'>618</span>
<span class='line-number'>619</span>
<span class='line-number'>620</span>
<span class='line-number'>621</span>
<span class='line-number'>622</span>
<span class='line-number'>623</span>
<span class='line-number'>624</span>
<span class='line-number'>625</span>
<span class='line-number'>626</span>
<span class='line-number'>627</span>
<span class='line-number'>628</span>
<span class='line-number'>629</span>
<span class='line-number'>630</span>
<span class='line-number'>631</span>
<span class='line-number'>632</span>
<span class='line-number'>633</span>
<span class='line-number'>634</span>
<span class='line-number'>635</span>
<span class='line-number'>636</span>
<span class='line-number'>637</span>
<span class='line-number'>638</span>
<span class='line-number'>639</span>
<span class='line-number'>640</span>
<span class='line-number'>641</span>
<span class='line-number'>642</span>
<span class='line-number'>643</span>
<span class='line-number'>644</span>
<span class='line-number'>645</span>
<span class='line-number'>646</span>
<span class='line-number'>647</span>
<span class='line-number'>648</span>
<span class='line-number'>649</span>
<span class='line-number'>650</span>
<span class='line-number'>651</span>
<span class='line-number'>652</span>
<span class='line-number'>653</span>
<span class='line-number'>654</span>
<span class='line-number'>655</span>
<span class='line-number'>656</span>
<span class='line-number'>657</span>
<span class='line-number'>658</span>
<span class='line-number'>659</span>
<span class='line-number'>660</span>
<span class='line-number'>661</span>
<span class='line-number'>662</span>
<span class='line-number'>663</span>
<span class='line-number'>664</span>
<span class='line-number'>665</span>
<span class='line-number'>666</span>
<span class='line-number'>667</span>
<span class='line-number'>668</span>
<span class='line-number'>669</span>
<span class='line-number'>670</span>
<span class='line-number'>671</span>
<span class='line-number'>672</span>
<span class='line-number'>673</span>
<span class='line-number'>674</span>
<span class='line-number'>675</span>
<span class='line-number'>676</span>
<span class='line-number'>677</span>
<span class='line-number'>678</span>
<span class='line-number'>679</span>
<span class='line-number'>680</span>
<span class='line-number'>681</span>
<span class='line-number'>682</span>
<span class='line-number'>683</span>
<span class='line-number'>684</span>
<span class='line-number'>685</span>
<span class='line-number'>686</span>
<span class='line-number'>687</span>
<span class='line-number'>688</span>
<span class='line-number'>689</span>
<span class='line-number'>690</span>
<span class='line-number'>691</span>
<span class='line-number'>692</span>
<span class='line-number'>693</span>
<span class='line-number'>694</span>
<span class='line-number'>695</span>
<span class='line-number'>696</span>
<span class='line-number'>697</span>
<span class='line-number'>698</span>
<span class='line-number'>699</span>
<span class='line-number'>700</span>
<span class='line-number'>701</span>
<span class='line-number'>702</span>
<span class='line-number'>703</span>
<span class='line-number'>704</span>
<span class='line-number'>705</span>
<span class='line-number'>706</span>
<span class='line-number'>707</span>
<span class='line-number'>708</span>
<span class='line-number'>709</span>
<span class='line-number'>710</span>
<span class='line-number'>711</span>
<span class='line-number'>712</span>
<span class='line-number'>713</span>
<span class='line-number'>714</span>
<span class='line-number'>715</span>
<span class='line-number'>716</span>
<span class='line-number'>717</span>
<span class='line-number'>718</span>
<span class='line-number'>719</span>
<span class='line-number'>720</span>
<span class='line-number'>721</span>
<span class='line-number'>722</span>
<span class='line-number'>723</span>
<span class='line-number'>724</span>
<span class='line-number'>725</span>
<span class='line-number'>726</span>
<span class='line-number'>727</span>
<span class='line-number'>728</span>
<span class='line-number'>729</span>
<span class='line-number'>730</span>
<span class='line-number'>731</span>
<span class='line-number'>732</span>
<span class='line-number'>733</span>
<span class='line-number'>734</span>
<span class='line-number'>735</span>
<span class='line-number'>736</span>
<span class='line-number'>737</span>
<span class='line-number'>738</span>
<span class='line-number'>739</span>
<span class='line-number'>740</span>
<span class='line-number'>741</span>
<span class='line-number'>742</span>
<span class='line-number'>743</span>
<span class='line-number'>744</span>
<span class='line-number'>745</span>
<span class='line-number'>746</span>
<span class='line-number'>747</span>
<span class='line-number'>748</span>
<span class='line-number'>749</span>
<span class='line-number'>750</span>
<span class='line-number'>751</span>
<span class='line-number'>752</span>
<span class='line-number'>753</span>
<span class='line-number'>754</span>
<span class='line-number'>755</span>
<span class='line-number'>756</span>
<span class='line-number'>757</span>
<span class='line-number'>758</span>
<span class='line-number'>759</span>
<span class='line-number'>760</span>
<span class='line-number'>761</span>
<span class='line-number'>762</span>
<span class='line-number'>763</span>
<span class='line-number'>764</span>
<span class='line-number'>765</span>
<span class='line-number'>766</span>
<span class='line-number'>767</span>
<span class='line-number'>768</span>
<span class='line-number'>769</span>
<span class='line-number'>770</span>
<span class='line-number'>771</span>
<span class='line-number'>772</span>
<span class='line-number'>773</span>
<span class='line-number'>774</span>
<span class='line-number'>775</span>
<span class='line-number'>776</span>
<span class='line-number'>777</span>
<span class='line-number'>778</span>
<span class='line-number'>779</span>
<span class='line-number'>780</span>
<span class='line-number'>781</span>
<span class='line-number'>782</span>
<span class='line-number'>783</span>
<span class='line-number'>784</span>
<span class='line-number'>785</span>
<span class='line-number'>786</span>
<span class='line-number'>787</span>
<span class='line-number'>788</span>
<span class='line-number'>789</span>
<span class='line-number'>790</span>
<span class='line-number'>791</span>
<span class='line-number'>792</span>
<span class='line-number'>793</span>
<span class='line-number'>794</span>
<span class='line-number'>795</span>
<span class='line-number'>796</span>
<span class='line-number'>797</span>
<span class='line-number'>798</span>
<span class='line-number'>799</span>
<span class='line-number'>800</span>
<span class='line-number'>801</span>
<span class='line-number'>802</span>
<span class='line-number'>803</span>
<span class='line-number'>804</span>
<span class='line-number'>805</span>
<span class='line-number'>806</span>
<span class='line-number'>807</span>
<span class='line-number'>808</span>
<span class='line-number'>809</span>
<span class='line-number'>810</span>
<span class='line-number'>811</span>
<span class='line-number'>812</span>
<span class='line-number'>813</span>
<span class='line-number'>814</span>
<span class='line-number'>815</span>
<span class='line-number'>816</span>
<span class='line-number'>817</span>
<span class='line-number'>818</span>
<span class='line-number'>819</span>
<span class='line-number'>820</span>
<span class='line-number'>821</span>
<span class='line-number'>822</span>
<span class='line-number'>823</span>
<span class='line-number'>824</span>
<span class='line-number'>825</span>
<span class='line-number'>826</span>
<span class='line-number'>827</span>
<span class='line-number'>828</span>
<span class='line-number'>829</span>
<span class='line-number'>830</span>
<span class='line-number'>831</span>
<span class='line-number'>832</span>
<span class='line-number'>833</span>
<span class='line-number'>834</span>
<span class='line-number'>835</span>
<span class='line-number'>836</span>
<span class='line-number'>837</span>
<span class='line-number'>838</span>
<span class='line-number'>839</span>
<span class='line-number'>840</span>
<span class='line-number'>841</span>
<span class='line-number'>842</span>
<span class='line-number'>843</span>
<span class='line-number'>844</span>
<span class='line-number'>845</span>
<span class='line-number'>846</span>
<span class='line-number'>847</span>
<span class='line-number'>848</span>
<span class='line-number'>849</span>
<span class='line-number'>850</span>
<span class='line-number'>851</span>
<span class='line-number'>852</span>
<span class='line-number'>853</span>
<span class='line-number'>854</span>
<span class='line-number'>855</span>
<span class='line-number'>856</span>
<span class='line-number'>857</span>
<span class='line-number'>858</span>
<span class='line-number'>859</span>
<span class='line-number'>860</span>
<span class='line-number'>861</span>
<span class='line-number'>862</span>
<span class='line-number'>863</span>
<span class='line-number'>864</span>
<span class='line-number'>865</span>
<span class='line-number'>866</span>
<span class='line-number'>867</span>
<span class='line-number'>868</span>
<span class='line-number'>869</span>
<span class='line-number'>870</span>
<span class='line-number'>871</span>
<span class='line-number'>872</span>
<span class='line-number'>873</span>
<span class='line-number'>874</span>
<span class='line-number'>875</span>
<span class='line-number'>876</span>
<span class='line-number'>877</span>
<span class='line-number'>878</span>
<span class='line-number'>879</span>
<span class='line-number'>880</span>
<span class='line-number'>881</span>
<span class='line-number'>882</span>
<span class='line-number'>883</span>
<span class='line-number'>884</span>
<span class='line-number'>885</span>
<span class='line-number'>886</span>
<span class='line-number'>887</span>
<span class='line-number'>888</span>
<span class='line-number'>889</span>
<span class='line-number'>890</span>
<span class='line-number'>891</span>
<span class='line-number'>892</span>
<span class='line-number'>893</span>
<span class='line-number'>894</span>
<span class='line-number'>895</span>
<span class='line-number'>896</span>
<span class='line-number'>897</span>
<span class='line-number'>898</span>
<span class='line-number'>899</span>
<span class='line-number'>900</span>
<span class='line-number'>901</span>
<span class='line-number'>902</span>
<span class='line-number'>903</span>
<span class='line-number'>904</span>
<span class='line-number'>905</span>
<span class='line-number'>906</span>
<span class='line-number'>907</span>
<span class='line-number'>908</span>
<span class='line-number'>909</span>
<span class='line-number'>910</span>
<span class='line-number'>911</span>
<span class='line-number'>912</span>
<span class='line-number'>913</span>
<span class='line-number'>914</span>
<span class='line-number'>915</span>
<span class='line-number'>916</span>
<span class='line-number'>917</span>
<span class='line-number'>918</span>
<span class='line-number'>919</span>
<span class='line-number'>920</span>
<span class='line-number'>921</span>
<span class='line-number'>922</span>
<span class='line-number'>923</span>
<span class='line-number'>924</span>
<span class='line-number'>925</span>
<span class='line-number'>926</span>
<span class='line-number'>927</span>
<span class='line-number'>928</span>
<span class='line-number'>929</span>
<span class='line-number'>930</span>
<span class='line-number'>931</span>
<span class='line-number'>932</span>
<span class='line-number'>933</span>
<span class='line-number'>934</span>
<span class='line-number'>935</span>
<span class='line-number'>936</span>
<span class='line-number'>937</span>
<span class='line-number'>938</span>
<span class='line-number'>939</span>
<span class='line-number'>940</span>
<span class='line-number'>941</span>
<span class='line-number'>942</span>
<span class='line-number'>943</span>
<span class='line-number'>944</span>
<span class='line-number'>945</span>
<span class='line-number'>946</span>
<span class='line-number'>947</span>
<span class='line-number'>948</span>
<span class='line-number'>949</span>
<span class='line-number'>950</span>
<span class='line-number'>951</span>
<span class='line-number'>952</span>
<span class='line-number'>953</span>
<span class='line-number'>954</span>
<span class='line-number'>955</span>
<span class='line-number'>956</span>
<span class='line-number'>957</span>
<span class='line-number'>958</span>
<span class='line-number'>959</span>
<span class='line-number'>960</span>
<span class='line-number'>961</span>
<span class='line-number'>962</span>
<span class='line-number'>963</span>
<span class='line-number'>964</span>
<span class='line-number'>965</span>
<span class='line-number'>966</span>
<span class='line-number'>967</span>
<span class='line-number'>968</span>
<span class='line-number'>969</span>
<span class='line-number'>970</span>
<span class='line-number'>971</span>
<span class='line-number'>972</span>
<span class='line-number'>973</span>
<span class='line-number'>974</span>
<span class='line-number'>975</span>
<span class='line-number'>976</span>
<span class='line-number'>977</span>
<span class='line-number'>978</span>
<span class='line-number'>979</span>
<span class='line-number'>980</span>
<span class='line-number'>981</span>
<span class='line-number'>982</span>
<span class='line-number'>983</span>
<span class='line-number'>984</span>
<span class='line-number'>985</span>
<span class='line-number'>986</span>
<span class='line-number'>987</span>
<span class='line-number'>988</span>
<span class='line-number'>989</span>
<span class='line-number'>990</span>
<span class='line-number'>991</span>
<span class='line-number'>992</span>
<span class='line-number'>993</span>
<span class='line-number'>994</span>
<span class='line-number'>995</span>
<span class='line-number'>996</span>
<span class='line-number'>997</span>
<span class='line-number'>998</span>
<span class='line-number'>999</span>
<span class='line-number'>1000</span>
<span class='line-number'>1001</span>
<span class='line-number'>1002</span>
<span class='line-number'>1003</span>
<span class='line-number'>1004</span>
<span class='line-number'>1005</span>
<span class='line-number'>1006</span>
<span class='line-number'>1007</span>
<span class='line-number'>1008</span>
<span class='line-number'>1009</span>
<span class='line-number'>1010</span>
<span class='line-number'>1011</span>
<span class='line-number'>1012</span>
<span class='line-number'>1013</span>
<span class='line-number'>1014</span>
<span class='line-number'>1015</span>
<span class='line-number'>1016</span>
<span class='line-number'>1017</span>
<span class='line-number'>1018</span>
<span class='line-number'>1019</span>
<span class='line-number'>1020</span>
<span class='line-number'>1021</span>
<span class='line-number'>1022</span>
<span class='line-number'>1023</span>
<span class='line-number'>1024</span>
<span class='line-number'>1025</span>
<span class='line-number'>1026</span>
<span class='line-number'>1027</span>
<span class='line-number'>1028</span>
<span class='line-number'>1029</span>
<span class='line-number'>1030</span>
<span class='line-number'>1031</span>
<span class='line-number'>1032</span>
<span class='line-number'>1033</span>
<span class='line-number'>1034</span>
<span class='line-number'>1035</span>
<span class='line-number'>1036</span>
<span class='line-number'>1037</span>
<span class='line-number'>1038</span>
<span class='line-number'>1039</span>
<span class='line-number'>1040</span>
<span class='line-number'>1041</span>
<span class='line-number'>1042</span>
<span class='line-number'>1043</span>
<span class='line-number'>1044</span>
<span class='line-number'>1045</span>
<span class='line-number'>1046</span>
<span class='line-number'>1047</span>
<span class='line-number'>1048</span>
<span class='line-number'>1049</span>
<span class='line-number'>1050</span>
<span class='line-number'>1051</span>
<span class='line-number'>1052</span>
<span class='line-number'>1053</span>
<span class='line-number'>1054</span>
<span class='line-number'>1055</span>
<span class='line-number'>1056</span>
<span class='line-number'>1057</span>
<span class='line-number'>1058</span>
<span class='line-number'>1059</span>
<span class='line-number'>1060</span>
<span class='line-number'>1061</span>
<span class='line-number'>1062</span>
<span class='line-number'>1063</span>
<span class='line-number'>1064</span>
<span class='line-number'>1065</span>
<span class='line-number'>1066</span>
<span class='line-number'>1067</span>
<span class='line-number'>1068</span>
<span class='line-number'>1069</span>
<span class='line-number'>1070</span>
<span class='line-number'>1071</span>
<span class='line-number'>1072</span>
<span class='line-number'>1073</span>
<span class='line-number'>1074</span>
<span class='line-number'>1075</span>
<span class='line-number'>1076</span>
<span class='line-number'>1077</span>
<span class='line-number'>1078</span>
<span class='line-number'>1079</span>
<span class='line-number'>1080</span>
<span class='line-number'>1081</span>
<span class='line-number'>1082</span>
<span class='line-number'>1083</span>
<span class='line-number'>1084</span>
<span class='line-number'>1085</span>
<span class='line-number'>1086</span>
<span class='line-number'>1087</span>
<span class='line-number'>1088</span>
<span class='line-number'>1089</span>
<span class='line-number'>1090</span>
<span class='line-number'>1091</span>
<span class='line-number'>1092</span>
<span class='line-number'>1093</span>
<span class='line-number'>1094</span>
<span class='line-number'>1095</span>
<span class='line-number'>1096</span>
<span class='line-number'>1097</span>
<span class='line-number'>1098</span>
<span class='line-number'>1099</span>
<span class='line-number'>1100</span>
<span class='line-number'>1101</span>
<span class='line-number'>1102</span>
<span class='line-number'>1103</span>
<span class='line-number'>1104</span>
<span class='line-number'>1105</span>
<span class='line-number'>1106</span>
<span class='line-number'>1107</span>
<span class='line-number'>1108</span>
<span class='line-number'>1109</span>
<span class='line-number'>1110</span>
<span class='line-number'>1111</span>
<span class='line-number'>1112</span>
<span class='line-number'>1113</span>
<span class='line-number'>1114</span>
<span class='line-number'>1115</span>
<span class='line-number'>1116</span>
<span class='line-number'>1117</span>
<span class='line-number'>1118</span>
<span class='line-number'>1119</span>
<span class='line-number'>1120</span>
<span class='line-number'>1121</span>
<span class='line-number'>1122</span>
<span class='line-number'>1123</span>
<span class='line-number'>1124</span>
<span class='line-number'>1125</span>
<span class='line-number'>1126</span>
<span class='line-number'>1127</span>
<span class='line-number'>1128</span>
<span class='line-number'>1129</span>
<span class='line-number'>1130</span>
<span class='line-number'>1131</span>
<span class='line-number'>1132</span>
<span class='line-number'>1133</span>
<span class='line-number'>1134</span>
<span class='line-number'>1135</span>
<span class='line-number'>1136</span>
<span class='line-number'>1137</span>
<span class='line-number'>1138</span>
<span class='line-number'>1139</span>
<span class='line-number'>1140</span>
<span class='line-number'>1141</span>
<span class='line-number'>1142</span>
<span class='line-number'>1143</span>
<span class='line-number'>1144</span>
<span class='line-number'>1145</span>
<span class='line-number'>1146</span>
<span class='line-number'>1147</span>
<span class='line-number'>1148</span>
<span class='line-number'>1149</span>
<span class='line-number'>1150</span>
<span class='line-number'>1151</span>
<span class='line-number'>1152</span>
<span class='line-number'>1153</span>
<span class='line-number'>1154</span>
<span class='line-number'>1155</span>
<span class='line-number'>1156</span>
<span class='line-number'>1157</span>
<span class='line-number'>1158</span>
<span class='line-number'>1159</span>
<span class='line-number'>1160</span>
<span class='line-number'>1161</span>
<span class='line-number'>1162</span>
<span class='line-number'>1163</span>
<span class='line-number'>1164</span>
<span class='line-number'>1165</span>
<span class='line-number'>1166</span>
<span class='line-number'>1167</span>
<span class='line-number'>1168</span>
<span class='line-number'>1169</span>
<span class='line-number'>1170</span>
<span class='line-number'>1171</span>
<span class='line-number'>1172</span>
<span class='line-number'>1173</span>
<span class='line-number'>1174</span>
<span class='line-number'>1175</span>
<span class='line-number'>1176</span>
<span class='line-number'>1177</span>
<span class='line-number'>1178</span>
<span class='line-number'>1179</span>
<span class='line-number'>1180</span>
<span class='line-number'>1181</span>
<span class='line-number'>1182</span>
<span class='line-number'>1183</span>
<span class='line-number'>1184</span>
<span class='line-number'>1185</span>
<span class='line-number'>1186</span>
<span class='line-number'>1187</span>
<span class='line-number'>1188</span>
<span class='line-number'>1189</span>
<span class='line-number'>1190</span>
<span class='line-number'>1191</span>
<span class='line-number'>1192</span>
<span class='line-number'>1193</span>
<span class='line-number'>1194</span>
<span class='line-number'>1195</span>
<span class='line-number'>1196</span>
<span class='line-number'>1197</span>
<span class='line-number'>1198</span>
<span class='line-number'>1199</span>
<span class='line-number'>1200</span>
<span class='line-number'>1201</span>
<span class='line-number'>1202</span>
<span class='line-number'>1203</span>
<span class='line-number'>1204</span>
<span class='line-number'>1205</span>
<span class='line-number'>1206</span>
<span class='line-number'>1207</span>
<span class='line-number'>1208</span>
<span class='line-number'>1209</span>
<span class='line-number'>1210</span>
<span class='line-number'>1211</span>
<span class='line-number'>1212</span>
<span class='line-number'>1213</span>
<span class='line-number'>1214</span>
<span class='line-number'>1215</span>
<span class='line-number'>1216</span>
<span class='line-number'>1217</span>
<span class='line-number'>1218</span>
<span class='line-number'>1219</span>
<span class='line-number'>1220</span>
<span class='line-number'>1221</span>
<span class='line-number'>1222</span>
<span class='line-number'>1223</span>
<span class='line-number'>1224</span>
<span class='line-number'>1225</span>
<span class='line-number'>1226</span>
<span class='line-number'>1227</span>
<span class='line-number'>1228</span>
<span class='line-number'>1229</span>
<span class='line-number'>1230</span>
<span class='line-number'>1231</span>
<span class='line-number'>1232</span>
<span class='line-number'>1233</span>
<span class='line-number'>1234</span>
<span class='line-number'>1235</span>
<span class='line-number'>1236</span>
<span class='line-number'>1237</span>
<span class='line-number'>1238</span>
<span class='line-number'>1239</span>
<span class='line-number'>1240</span>
<span class='line-number'>1241</span>
<span class='line-number'>1242</span>
<span class='line-number'>1243</span>
<span class='line-number'>1244</span>
<span class='line-number'>1245</span>
<span class='line-number'>1246</span>
<span class='line-number'>1247</span>
<span class='line-number'>1248</span>
<span class='line-number'>1249</span>
<span class='line-number'>1250</span>
<span class='line-number'>1251</span>
<span class='line-number'>1252</span>
<span class='line-number'>1253</span>
<span class='line-number'>1254</span>
<span class='line-number'>1255</span>
<span class='line-number'>1256</span>
<span class='line-number'>1257</span>
<span class='line-number'>1258</span>
<span class='line-number'>1259</span>
<span class='line-number'>1260</span>
<span class='line-number'>1261</span>
<span class='line-number'>1262</span>
<span class='line-number'>1263</span>
<span class='line-number'>1264</span>
<span class='line-number'>1265</span>
<span class='line-number'>1266</span>
<span class='line-number'>1267</span>
<span class='line-number'>1268</span>
<span class='line-number'>1269</span>
<span class='line-number'>1270</span>
<span class='line-number'>1271</span>
<span class='line-number'>1272</span>
<span class='line-number'>1273</span>
<span class='line-number'>1274</span>
<span class='line-number'>1275</span>
<span class='line-number'>1276</span>
<span class='line-number'>1277</span>
<span class='line-number'>1278</span>
<span class='line-number'>1279</span>
<span class='line-number'>1280</span>
<span class='line-number'>1281</span>
<span class='line-number'>1282</span>
<span class='line-number'>1283</span>
<span class='line-number'>1284</span>
<span class='line-number'>1285</span>
<span class='line-number'>1286</span>
<span class='line-number'>1287</span>
<span class='line-number'>1288</span>
<span class='line-number'>1289</span>
<span class='line-number'>1290</span>
<span class='line-number'>1291</span>
<span class='line-number'>1292</span>
<span class='line-number'>1293</span>
<span class='line-number'>1294</span>
<span class='line-number'>1295</span>
<span class='line-number'>1296</span>
<span class='line-number'>1297</span>
<span class='line-number'>1298</span>
<span class='line-number'>1299</span>
<span class='line-number'>1300</span>
<span class='line-number'>1301</span>
<span class='line-number'>1302</span>
<span class='line-number'>1303</span>
<span class='line-number'>1304</span>
<span class='line-number'>1305</span>
<span class='line-number'>1306</span>
<span class='line-number'>1307</span>
<span class='line-number'>1308</span>
<span class='line-number'>1309</span>
<span class='line-number'>1310</span>
<span class='line-number'>1311</span>
<span class='line-number'>1312</span>
<span class='line-number'>1313</span>
<span class='line-number'>1314</span>
<span class='line-number'>1315</span>
<span class='line-number'>1316</span>
<span class='line-number'>1317</span>
<span class='line-number'>1318</span>
<span class='line-number'>1319</span>
<span class='line-number'>1320</span>
<span class='line-number'>1321</span>
<span class='line-number'>1322</span>
<span class='line-number'>1323</span>
<span class='line-number'>1324</span>
<span class='line-number'>1325</span>
<span class='line-number'>1326</span>
<span class='line-number'>1327</span>
<span class='line-number'>1328</span>
<span class='line-number'>1329</span>
<span class='line-number'>1330</span>
<span class='line-number'>1331</span>
<span class='line-number'>1332</span>
<span class='line-number'>1333</span>
<span class='line-number'>1334</span>
<span class='line-number'>1335</span>
<span class='line-number'>1336</span>
<span class='line-number'>1337</span>
<span class='line-number'>1338</span>
<span class='line-number'>1339</span>
<span class='line-number'>1340</span>
<span class='line-number'>1341</span>
<span class='line-number'>1342</span>
<span class='line-number'>1343</span>
<span class='line-number'>1344</span>
<span class='line-number'>1345</span>
<span class='line-number'>1346</span>
<span class='line-number'>1347</span>
<span class='line-number'>1348</span>
<span class='line-number'>1349</span>
<span class='line-number'>1350</span>
<span class='line-number'>1351</span>
<span class='line-number'>1352</span>
<span class='line-number'>1353</span>
<span class='line-number'>1354</span>
<span class='line-number'>1355</span>
<span class='line-number'>1356</span>
<span class='line-number'>1357</span>
<span class='line-number'>1358</span>
<span class='line-number'>1359</span>
<span class='line-number'>1360</span>
<span class='line-number'>1361</span>
<span class='line-number'>1362</span>
<span class='line-number'>1363</span>
<span class='line-number'>1364</span>
<span class='line-number'>1365</span>
<span class='line-number'>1366</span>
<span class='line-number'>1367</span>
<span class='line-number'>1368</span>
<span class='line-number'>1369</span>
<span class='line-number'>1370</span>
<span class='line-number'>1371</span>
<span class='line-number'>1372</span>
<span class='line-number'>1373</span>
<span class='line-number'>1374</span>
<span class='line-number'>1375</span>
<span class='line-number'>1376</span>
<span class='line-number'>1377</span>
<span class='line-number'>1378</span>
<span class='line-number'>1379</span>
<span class='line-number'>1380</span>
<span class='line-number'>1381</span>
<span class='line-number'>1382</span>
<span class='line-number'>1383</span>
<span class='line-number'>1384</span>
<span class='line-number'>1385</span>
<span class='line-number'>1386</span>
<span class='line-number'>1387</span>
<span class='line-number'>1388</span>
<span class='line-number'>1389</span>
<span class='line-number'>1390</span>
<span class='line-number'>1391</span>
<span class='line-number'>1392</span>
<span class='line-number'>1393</span>
<span class='line-number'>1394</span>
<span class='line-number'>1395</span>
<span class='line-number'>1396</span>
<span class='line-number'>1397</span>
<span class='line-number'>1398</span>
<span class='line-number'>1399</span>
<span class='line-number'>1400</span>
<span class='line-number'>1401</span>
<span class='line-number'>1402</span>
<span class='line-number'>1403</span>
<span class='line-number'>1404</span>
<span class='line-number'>1405</span>
<span class='line-number'>1406</span>
<span class='line-number'>1407</span>
<span class='line-number'>1408</span>
<span class='line-number'>1409</span>
<span class='line-number'>1410</span>
<span class='line-number'>1411</span>
<span class='line-number'>1412</span>
<span class='line-number'>1413</span>
<span class='line-number'>1414</span>
<span class='line-number'>1415</span>
<span class='line-number'>1416</span>
<span class='line-number'>1417</span>
<span class='line-number'>1418</span>
<span class='line-number'>1419</span>
<span class='line-number'>1420</span>
<span class='line-number'>1421</span>
<span class='line-number'>1422</span>
<span class='line-number'>1423</span>
<span class='line-number'>1424</span>
<span class='line-number'>1425</span>
<span class='line-number'>1426</span>
<span class='line-number'>1427</span>
<span class='line-number'>1428</span>
<span class='line-number'>1429</span>
<span class='line-number'>1430</span>
<span class='line-number'>1431</span>
<span class='line-number'>1432</span>
<span class='line-number'>1433</span>
<span class='line-number'>1434</span>
<span class='line-number'>1435</span>
<span class='line-number'>1436</span>
<span class='line-number'>1437</span>
<span class='line-number'>1438</span>
<span class='line-number'>1439</span>
<span class='line-number'>1440</span>
<span class='line-number'>1441</span>
<span class='line-number'>1442</span>
<span class='line-number'>1443</span>
<span class='line-number'>1444</span>
<span class='line-number'>1445</span>
<span class='line-number'>1446</span>
<span class='line-number'>1447</span>
<span class='line-number'>1448</span>
<span class='line-number'>1449</span>
<span class='line-number'>1450</span>
<span class='line-number'>1451</span>
<span class='line-number'>1452</span>
<span class='line-number'>1453</span>
<span class='line-number'>1454</span>
<span class='line-number'>1455</span>
<span class='line-number'>1456</span>
<span class='line-number'>1457</span>
<span class='line-number'>1458</span>
<span class='line-number'>1459</span>
<span class='line-number'>1460</span>
<span class='line-number'>1461</span>
<span class='line-number'>1462</span>
<span class='line-number'>1463</span>
<span class='line-number'>1464</span>
<span class='line-number'>1465</span>
<span class='line-number'>1466</span>
<span class='line-number'>1467</span>
<span class='line-number'>1468</span>
<span class='line-number'>1469</span>
<span class='line-number'>1470</span>
<span class='line-number'>1471</span>
<span class='line-number'>1472</span>
<span class='line-number'>1473</span>
<span class='line-number'>1474</span>
<span class='line-number'>1475</span>
<span class='line-number'>1476</span>
<span class='line-number'>1477</span>
<span class='line-number'>1478</span>
<span class='line-number'>1479</span>
<span class='line-number'>1480</span>
<span class='line-number'>1481</span>
<span class='line-number'>1482</span>
<span class='line-number'>1483</span>
<span class='line-number'>1484</span>
<span class='line-number'>1485</span>
<span class='line-number'>1486</span>
<span class='line-number'>1487</span>
<span class='line-number'>1488</span>
<span class='line-number'>1489</span>
<span class='line-number'>1490</span>
<span class='line-number'>1491</span>
<span class='line-number'>1492</span>
<span class='line-number'>1493</span>
<span class='line-number'>1494</span>
<span class='line-number'>1495</span>
<span class='line-number'>1496</span>
<span class='line-number'>1497</span>
<span class='line-number'>1498</span>
<span class='line-number'>1499</span>
<span class='line-number'>1500</span>
<span class='line-number'>1501</span>
<span class='line-number'>1502</span>
<span class='line-number'>1503</span>
<span class='line-number'>1504</span>
<span class='line-number'>1505</span>
<span class='line-number'>1506</span>
<span class='line-number'>1507</span>
<span class='line-number'>1508</span>
<span class='line-number'>1509</span>
<span class='line-number'>1510</span>
<span class='line-number'>1511</span>
<span class='line-number'>1512</span>
<span class='line-number'>1513</span>
<span class='line-number'>1514</span>
<span class='line-number'>1515</span>
<span class='line-number'>1516</span>
<span class='line-number'>1517</span>
<span class='line-number'>1518</span>
<span class='line-number'>1519</span>
<span class='line-number'>1520</span>
<span class='line-number'>1521</span>
<span class='line-number'>1522</span>
<span class='line-number'>1523</span>
<span class='line-number'>1524</span>
<span class='line-number'>1525</span>
<span class='line-number'>1526</span>
<span class='line-number'>1527</span>
<span class='line-number'>1528</span>
<span class='line-number'>1529</span>
<span class='line-number'>1530</span>
<span class='line-number'>1531</span>
<span class='line-number'>1532</span>
<span class='line-number'>1533</span>
<span class='line-number'>1534</span>
<span class='line-number'>1535</span>
<span class='line-number'>1536</span>
<span class='line-number'>1537</span>
<span class='line-number'>1538</span>
<span class='line-number'>1539</span>
<span class='line-number'>1540</span>
<span class='line-number'>1541</span>
<span class='line-number'>1542</span>
<span class='line-number'>1543</span>
<span class='line-number'>1544</span>
<span class='line-number'>1545</span>
<span class='line-number'>1546</span>
<span class='line-number'>1547</span>
<span class='line-number'>1548</span>
<span class='line-number'>1549</span>
<span class='line-number'>1550</span>
<span class='line-number'>1551</span>
<span class='line-number'>1552</span>
<span class='line-number'>1553</span>
<span class='line-number'>1554</span>
<span class='line-number'>1555</span>
<span class='line-number'>1556</span>
<span class='line-number'>1557</span>
<span class='line-number'>1558</span>
<span class='line-number'>1559</span>
<span class='line-number'>1560</span>
<span class='line-number'>1561</span>
<span class='line-number'>1562</span>
<span class='line-number'>1563</span>
<span class='line-number'>1564</span>
<span class='line-number'>1565</span>
<span class='line-number'>1566</span>
<span class='line-number'>1567</span>
<span class='line-number'>1568</span>
<span class='line-number'>1569</span>
<span class='line-number'>1570</span>
<span class='line-number'>1571</span>
<span class='line-number'>1572</span>
<span class='line-number'>1573</span>
<span class='line-number'>1574</span>
<span class='line-number'>1575</span>
<span class='line-number'>1576</span>
<span class='line-number'>1577</span>
<span class='line-number'>1578</span>
<span class='line-number'>1579</span>
<span class='line-number'>1580</span>
<span class='line-number'>1581</span>
<span class='line-number'>1582</span>
<span class='line-number'>1583</span>
<span class='line-number'>1584</span>
<span class='line-number'>1585</span>
<span class='line-number'>1586</span>
<span class='line-number'>1587</span>
<span class='line-number'>1588</span>
<span class='line-number'>1589</span>
<span class='line-number'>1590</span>
<span class='line-number'>1591</span>
<span class='line-number'>1592</span>
<span class='line-number'>1593</span>
<span class='line-number'>1594</span>
<span class='line-number'>1595</span>
<span class='line-number'>1596</span>
<span class='line-number'>1597</span>
<span class='line-number'>1598</span>
<span class='line-number'>1599</span>
<span class='line-number'>1600</span>
<span class='line-number'>1601</span>
<span class='line-number'>1602</span>
<span class='line-number'>1603</span>
<span class='line-number'>1604</span>
<span class='line-number'>1605</span>
<span class='line-number'>1606</span>
<span class='line-number'>1607</span>
<span class='line-number'>1608</span>
<span class='line-number'>1609</span>
<span class='line-number'>1610</span>
<span class='line-number'>1611</span>
<span class='line-number'>1612</span>
<span class='line-number'>1613</span>
<span class='line-number'>1614</span>
<span class='line-number'>1615</span>
<span class='line-number'>1616</span>
<span class='line-number'>1617</span>
<span class='line-number'>1618</span>
<span class='line-number'>1619</span>
<span class='line-number'>1620</span>
<span class='line-number'>1621</span>
<span class='line-number'>1622</span>
<span class='line-number'>1623</span>
<span class='line-number'>1624</span>
<span class='line-number'>1625</span>
<span class='line-number'>1626</span>
<span class='line-number'>1627</span>
<span class='line-number'>1628</span>
<span class='line-number'>1629</span>
<span class='line-number'>1630</span>
<span class='line-number'>1631</span>
<span class='line-number'>1632</span>
<span class='line-number'>1633</span>
<span class='line-number'>1634</span>
<span class='line-number'>1635</span>
<span class='line-number'>1636</span>
<span class='line-number'>1637</span>
<span class='line-number'>1638</span>
<span class='line-number'>1639</span>
<span class='line-number'>1640</span>
<span class='line-number'>1641</span>
<span class='line-number'>1642</span>
<span class='line-number'>1643</span>
<span class='line-number'>1644</span>
<span class='line-number'>1645</span>
<span class='line-number'>1646</span>
<span class='line-number'>1647</span>
<span class='line-number'>1648</span>
<span class='line-number'>1649</span>
<span class='line-number'>1650</span>
<span class='line-number'>1651</span>
<span class='line-number'>1652</span>
<span class='line-number'>1653</span>
<span class='line-number'>1654</span>
<span class='line-number'>1655</span>
<span class='line-number'>1656</span>
<span class='line-number'>1657</span>
<span class='line-number'>1658</span>
<span class='line-number'>1659</span>
<span class='line-number'>1660</span>
<span class='line-number'>1661</span>
<span class='line-number'>1662</span>
<span class='line-number'>1663</span>
<span class='line-number'>1664</span>
<span class='line-number'>1665</span>
<span class='line-number'>1666</span>
<span class='line-number'>1667</span>
<span class='line-number'>1668</span>
<span class='line-number'>1669</span>
<span class='line-number'>1670</span>
<span class='line-number'>1671</span>
<span class='line-number'>1672</span>
<span class='line-number'>1673</span>
<span class='line-number'>1674</span>
<span class='line-number'>1675</span>
<span class='line-number'>1676</span>
<span class='line-number'>1677</span>
<span class='line-number'>1678</span>
<span class='line-number'>1679</span>
<span class='line-number'>1680</span>
<span class='line-number'>1681</span>
<span class='line-number'>1682</span>
<span class='line-number'>1683</span>
<span class='line-number'>1684</span>
<span class='line-number'>1685</span>
<span class='line-number'>1686</span>
<span class='line-number'>1687</span>
<span class='line-number'>1688</span>
<span class='line-number'>1689</span>
<span class='line-number'>1690</span>
<span class='line-number'>1691</span>
<span class='line-number'>1692</span>
<span class='line-number'>1693</span>
<span class='line-number'>1694</span>
<span class='line-number'>1695</span>
<span class='line-number'>1696</span>
<span class='line-number'>1697</span>
<span class='line-number'>1698</span>
<span class='line-number'>1699</span>
<span class='line-number'>1700</span>
<span class='line-number'>1701</span>
<span class='line-number'>1702</span>
<span class='line-number'>1703</span>
<span class='line-number'>1704</span>
<span class='line-number'>1705</span>
<span class='line-number'>1706</span>
<span class='line-number'>1707</span>
<span class='line-number'>1708</span>
<span class='line-number'>1709</span>
<span class='line-number'>1710</span>
<span class='line-number'>1711</span>
<span class='line-number'>1712</span>
<span class='line-number'>1713</span>
<span class='line-number'>1714</span>
<span class='line-number'>1715</span>
<span class='line-number'>1716</span>
<span class='line-number'>1717</span>
<span class='line-number'>1718</span>
<span class='line-number'>1719</span>
<span class='line-number'>1720</span>
<span class='line-number'>1721</span>
<span class='line-number'>1722</span>
<span class='line-number'>1723</span>
<span class='line-number'>1724</span>
<span class='line-number'>1725</span>
<span class='line-number'>1726</span>
<span class='line-number'>1727</span>
<span class='line-number'>1728</span>
<span class='line-number'>1729</span>
<span class='line-number'>1730</span>
<span class='line-number'>1731</span>
<span class='line-number'>1732</span>
<span class='line-number'>1733</span>
<span class='line-number'>1734</span>
<span class='line-number'>1735</span>
<span class='line-number'>1736</span>
<span class='line-number'>1737</span>
<span class='line-number'>1738</span>
<span class='line-number'>1739</span>
<span class='line-number'>1740</span>
<span class='line-number'>1741</span>
<span class='line-number'>1742</span>
<span class='line-number'>1743</span>
<span class='line-number'>1744</span>
<span class='line-number'>1745</span>
<span class='line-number'>1746</span>
<span class='line-number'>1747</span>
<span class='line-number'>1748</span>
<span class='line-number'>1749</span>
<span class='line-number'>1750</span>
<span class='line-number'>1751</span>
<span class='line-number'>1752</span>
<span class='line-number'>1753</span>
<span class='line-number'>1754</span>
<span class='line-number'>1755</span>
<span class='line-number'>1756</span>
<span class='line-number'>1757</span>
<span class='line-number'>1758</span>
<span class='line-number'>1759</span>
<span class='line-number'>1760</span>
<span class='line-number'>1761</span>
<span class='line-number'>1762</span>
<span class='line-number'>1763</span>
<span class='line-number'>1764</span>
<span class='line-number'>1765</span>
<span class='line-number'>1766</span>
<span class='line-number'>1767</span>
<span class='line-number'>1768</span>
<span class='line-number'>1769</span>
<span class='line-number'>1770</span>
<span class='line-number'>1771</span>
<span class='line-number'>1772</span>
<span class='line-number'>1773</span>
<span class='line-number'>1774</span>
<span class='line-number'>1775</span>
<span class='line-number'>1776</span>
<span class='line-number'>1777</span>
<span class='line-number'>1778</span>
<span class='line-number'>1779</span>
<span class='line-number'>1780</span>
<span class='line-number'>1781</span>
<span class='line-number'>1782</span>
<span class='line-number'>1783</span>
<span class='line-number'>1784</span>
<span class='line-number'>1785</span>
<span class='line-number'>1786</span>
<span class='line-number'>1787</span>
<span class='line-number'>1788</span>
<span class='line-number'>1789</span>
<span class='line-number'>1790</span>
<span class='line-number'>1791</span>
<span class='line-number'>1792</span>
<span class='line-number'>1793</span>
<span class='line-number'>1794</span>
<span class='line-number'>1795</span>
<span class='line-number'>1796</span>
<span class='line-number'>1797</span>
<span class='line-number'>1798</span>
<span class='line-number'>1799</span>
<span class='line-number'>1800</span>
<span class='line-number'>1801</span>
<span class='line-number'>1802</span>
<span class='line-number'>1803</span>
<span class='line-number'>1804</span>
<span class='line-number'>1805</span>
<span class='line-number'>1806</span>
<span class='line-number'>1807</span>
<span class='line-number'>1808</span>
<span class='line-number'>1809</span>
<span class='line-number'>1810</span>
<span class='line-number'>1811</span>
<span class='line-number'>1812</span>
<span class='line-number'>1813</span>
<span class='line-number'>1814</span>
<span class='line-number'>1815</span>
<span class='line-number'>1816</span>
<span class='line-number'>1817</span>
<span class='line-number'>1818</span>
<span class='line-number'>1819</span>
<span class='line-number'>1820</span>
<span class='line-number'>1821</span>
<span class='line-number'>1822</span>
<span class='line-number'>1823</span>
<span class='line-number'>1824</span>
<span class='line-number'>1825</span>
<span class='line-number'>1826</span>
<span class='line-number'>1827</span>
<span class='line-number'>1828</span>
<span class='line-number'>1829</span>
<span class='line-number'>1830</span>
<span class='line-number'>1831</span>
<span class='line-number'>1832</span>
<span class='line-number'>1833</span>
<span class='line-number'>1834</span>
<span class='line-number'>1835</span>
<span class='line-number'>1836</span>
<span class='line-number'>1837</span>
<span class='line-number'>1838</span>
<span class='line-number'>1839</span>
<span class='line-number'>1840</span>
<span class='line-number'>1841</span>
<span class='line-number'>1842</span>
<span class='line-number'>1843</span>
<span class='line-number'>1844</span>
<span class='line-number'>1845</span>
<span class='line-number'>1846</span>
<span class='line-number'>1847</span>
<span class='line-number'>1848</span>
<span class='line-number'>1849</span>
<span class='line-number'>1850</span>
<span class='line-number'>1851</span>
<span class='line-number'>1852</span>
<span class='line-number'>1853</span>
<span class='line-number'>1854</span>
<span class='line-number'>1855</span>
<span class='line-number'>1856</span>
<span class='line-number'>1857</span>
<span class='line-number'>1858</span>
<span class='line-number'>1859</span>
<span class='line-number'>1860</span>
<span class='line-number'>1861</span>
<span class='line-number'>1862</span>
<span class='line-number'>1863</span>
<span class='line-number'>1864</span>
<span class='line-number'>1865</span>
<span class='line-number'>1866</span>
<span class='line-number'>1867</span>
<span class='line-number'>1868</span>
<span class='line-number'>1869</span>
<span class='line-number'>1870</span>
<span class='line-number'>1871</span>
<span class='line-number'>1872</span>
<span class='line-number'>1873</span>
<span class='line-number'>1874</span>
<span class='line-number'>1875</span>
<span class='line-number'>1876</span>
<span class='line-number'>1877</span>
<span class='line-number'>1878</span>
<span class='line-number'>1879</span>
<span class='line-number'>1880</span>
<span class='line-number'>1881</span>
<span class='line-number'>1882</span>
<span class='line-number'>1883</span>
<span class='line-number'>1884</span>
<span class='line-number'>1885</span>
<span class='line-number'>1886</span>
<span class='line-number'>1887</span>
<span class='line-number'>1888</span>
<span class='line-number'>1889</span>
<span class='line-number'>1890</span>
<span class='line-number'>1891</span>
<span class='line-number'>1892</span>
<span class='line-number'>1893</span>
<span class='line-number'>1894</span>
<span class='line-number'>1895</span>
<span class='line-number'>1896</span>
<span class='line-number'>1897</span>
<span class='line-number'>1898</span>
<span class='line-number'>1899</span>
<span class='line-number'>1900</span>
<span class='line-number'>1901</span>
<span class='line-number'>1902</span>
<span class='line-number'>1903</span>
<span class='line-number'>1904</span>
<span class='line-number'>1905</span>
<span class='line-number'>1906</span>
<span class='line-number'>1907</span>
<span class='line-number'>1908</span>
<span class='line-number'>1909</span>
<span class='line-number'>1910</span>
<span class='line-number'>1911</span>
<span class='line-number'>1912</span>
<span class='line-number'>1913</span>
<span class='line-number'>1914</span>
<span class='line-number'>1915</span>
<span class='line-number'>1916</span>
<span class='line-number'>1917</span>
<span class='line-number'>1918</span>
<span class='line-number'>1919</span>
<span class='line-number'>1920</span>
<span class='line-number'>1921</span>
<span class='line-number'>1922</span>
<span class='line-number'>1923</span>
<span class='line-number'>1924</span>
<span class='line-number'>1925</span>
<span class='line-number'>1926</span>
<span class='line-number'>1927</span>
<span class='line-number'>1928</span>
<span class='line-number'>1929</span>
<span class='line-number'>1930</span>
<span class='line-number'>1931</span>
<span class='line-number'>1932</span>
<span class='line-number'>1933</span>
<span class='line-number'>1934</span>
<span class='line-number'>1935</span>
<span class='line-number'>1936</span>
<span class='line-number'>1937</span>
<span class='line-number'>1938</span>
<span class='line-number'>1939</span>
<span class='line-number'>1940</span>
<span class='line-number'>1941</span>
<span class='line-number'>1942</span>
<span class='line-number'>1943</span>
<span class='line-number'>1944</span>
<span class='line-number'>1945</span>
<span class='line-number'>1946</span>
<span class='line-number'>1947</span>
<span class='line-number'>1948</span>
<span class='line-number'>1949</span>
<span class='line-number'>1950</span>
<span class='line-number'>1951</span>
<span class='line-number'>1952</span>
<span class='line-number'>1953</span>
<span class='line-number'>1954</span>
<span class='line-number'>1955</span>
<span class='line-number'>1956</span>
<span class='line-number'>1957</span>
<span class='line-number'>1958</span>
<span class='line-number'>1959</span>
<span class='line-number'>1960</span>
<span class='line-number'>1961</span>
<span class='line-number'>1962</span>
<span class='line-number'>1963</span>
<span class='line-number'>1964</span>
<span class='line-number'>1965</span>
<span class='line-number'>1966</span>
<span class='line-number'>1967</span>
<span class='line-number'>1968</span>
<span class='line-number'>1969</span>
<span class='line-number'>1970</span>
<span class='line-number'>1971</span>
<span class='line-number'>1972</span>
<span class='line-number'>1973</span>
<span class='line-number'>1974</span>
<span class='line-number'>1975</span>
<span class='line-number'>1976</span>
<span class='line-number'>1977</span>
<span class='line-number'>1978</span>
<span class='line-number'>1979</span>
<span class='line-number'>1980</span>
<span class='line-number'>1981</span>
<span class='line-number'>1982</span>
<span class='line-number'>1983</span>
<span class='line-number'>1984</span>
<span class='line-number'>1985</span>
<span class='line-number'>1986</span>
<span class='line-number'>1987</span>
<span class='line-number'>1988</span>
<span class='line-number'>1989</span>
<span class='line-number'>1990</span>
<span class='line-number'>1991</span>
<span class='line-number'>1992</span>
<span class='line-number'>1993</span>
<span class='line-number'>1994</span>
<span class='line-number'>1995</span>
<span class='line-number'>1996</span>
<span class='line-number'>1997</span>
<span class='line-number'>1998</span>
<span class='line-number'>1999</span>
<span class='line-number'>2000</span>
<span class='line-number'>2001</span>
<span class='line-number'>2002</span>
<span class='line-number'>2003</span>
<span class='line-number'>2004</span>
<span class='line-number'>2005</span>
<span class='line-number'>2006</span>
<span class='line-number'>2007</span>
<span class='line-number'>2008</span>
<span class='line-number'>2009</span>
<span class='line-number'>2010</span>
<span class='line-number'>2011</span>
<span class='line-number'>2012</span>
<span class='line-number'>2013</span>
<span class='line-number'>2014</span>
<span class='line-number'>2015</span>
<span class='line-number'>2016</span>
<span class='line-number'>2017</span>
<span class='line-number'>2018</span>
<span class='line-number'>2019</span>
<span class='line-number'>2020</span>
<span class='line-number'>2021</span>
<span class='line-number'>2022</span>
<span class='line-number'>2023</span>
<span class='line-number'>2024</span>
<span class='line-number'>2025</span>
<span class='line-number'>2026</span>
<span class='line-number'>2027</span>
<span class='line-number'>2028</span>
<span class='line-number'>2029</span>
<span class='line-number'>2030</span>
<span class='line-number'>2031</span>
<span class='line-number'>2032</span>
<span class='line-number'>2033</span>
<span class='line-number'>2034</span>
<span class='line-number'>2035</span>
<span class='line-number'>2036</span>
<span class='line-number'>2037</span>
<span class='line-number'>2038</span>
<span class='line-number'>2039</span>
<span class='line-number'>2040</span>
<span class='line-number'>2041</span>
<span class='line-number'>2042</span>
<span class='line-number'>2043</span>
<span class='line-number'>2044</span>
<span class='line-number'>2045</span>
<span class='line-number'>2046</span>
<span class='line-number'>2047</span>
<span class='line-number'>2048</span>
<span class='line-number'>2049</span>
<span class='line-number'>2050</span>
<span class='line-number'>2051</span>
<span class='line-number'>2052</span>
<span class='line-number'>2053</span>
<span class='line-number'>2054</span>
<span class='line-number'>2055</span>
<span class='line-number'>2056</span>
<span class='line-number'>2057</span>
<span class='line-number'>2058</span>
<span class='line-number'>2059</span>
<span class='line-number'>2060</span>
<span class='line-number'>2061</span>
<span class='line-number'>2062</span>
<span class='line-number'>2063</span>
<span class='line-number'>2064</span>
<span class='line-number'>2065</span>
<span class='line-number'>2066</span>
<span class='line-number'>2067</span>
<span class='line-number'>2068</span>
<span class='line-number'>2069</span>
<span class='line-number'>2070</span>
<span class='line-number'>2071</span>
<span class='line-number'>2072</span>
<span class='line-number'>2073</span>
<span class='line-number'>2074</span>
<span class='line-number'>2075</span>
<span class='line-number'>2076</span>
<span class='line-number'>2077</span>
<span class='line-number'>2078</span>
<span class='line-number'>2079</span>
<span class='line-number'>2080</span>
<span class='line-number'>2081</span>
<span class='line-number'>2082</span>
<span class='line-number'>2083</span>
<span class='line-number'>2084</span>
<span class='line-number'>2085</span>
<span class='line-number'>2086</span>
<span class='line-number'>2087</span>
<span class='line-number'>2088</span>
<span class='line-number'>2089</span>
<span class='line-number'>2090</span>
<span class='line-number'>2091</span>
<span class='line-number'>2092</span>
<span class='line-number'>2093</span>
<span class='line-number'>2094</span>
<span class='line-number'>2095</span>
<span class='line-number'>2096</span>
<span class='line-number'>2097</span>
<span class='line-number'>2098</span>
<span class='line-number'>2099</span>
<span class='line-number'>2100</span>
<span class='line-number'>2101</span>
<span class='line-number'>2102</span>
<span class='line-number'>2103</span>
<span class='line-number'>2104</span>
<span class='line-number'>2105</span>
<span class='line-number'>2106</span>
<span class='line-number'>2107</span>
<span class='line-number'>2108</span>
<span class='line-number'>2109</span>
<span class='line-number'>2110</span>
<span class='line-number'>2111</span>
<span class='line-number'>2112</span>
<span class='line-number'>2113</span>
<span class='line-number'>2114</span>
<span class='line-number'>2115</span>
<span class='line-number'>2116</span>
<span class='line-number'>2117</span>
<span class='line-number'>2118</span>
<span class='line-number'>2119</span>
<span class='line-number'>2120</span>
<span class='line-number'>2121</span>
<span class='line-number'>2122</span>
<span class='line-number'>2123</span>
<span class='line-number'>2124</span>
<span class='line-number'>2125</span>
<span class='line-number'>2126</span>
<span class='line-number'>2127</span>
<span class='line-number'>2128</span>
<span class='line-number'>2129</span>
<span class='line-number'>2130</span>
<span class='line-number'>2131</span>
<span class='line-number'>2132</span>
<span class='line-number'>2133</span>
<span class='line-number'>2134</span>
<span class='line-number'>2135</span>
<span class='line-number'>2136</span>
<span class='line-number'>2137</span>
<span class='line-number'>2138</span>
<span class='line-number'>2139</span>
<span class='line-number'>2140</span>
<span class='line-number'>2141</span>
<span class='line-number'>2142</span>
<span class='line-number'>2143</span>
<span class='line-number'>2144</span>
<span class='line-number'>2145</span>
<span class='line-number'>2146</span>
<span class='line-number'>2147</span>
<span class='line-number'>2148</span>
<span class='line-number'>2149</span>
<span class='line-number'>2150</span>
<span class='line-number'>2151</span>
<span class='line-number'>2152</span>
<span class='line-number'>2153</span>
<span class='line-number'>2154</span>
<span class='line-number'>2155</span>
<span class='line-number'>2156</span>
<span class='line-number'>2157</span>
<span class='line-number'>2158</span>
<span class='line-number'>2159</span>
<span class='line-number'>2160</span>
<span class='line-number'>2161</span>
<span class='line-number'>2162</span>
<span class='line-number'>2163</span>
<span class='line-number'>2164</span>
<span class='line-number'>2165</span>
<span class='line-number'>2166</span>
<span class='line-number'>2167</span>
<span class='line-number'>2168</span>
<span class='line-number'>2169</span>
<span class='line-number'>2170</span>
<span class='line-number'>2171</span>
<span class='line-number'>2172</span>
<span class='line-number'>2173</span>
<span class='line-number'>2174</span>
<span class='line-number'>2175</span>
<span class='line-number'>2176</span>
<span class='line-number'>2177</span>
<span class='line-number'>2178</span>
<span class='line-number'>2179</span>
<span class='line-number'>2180</span>
<span class='line-number'>2181</span>
<span class='line-number'>2182</span>
<span class='line-number'>2183</span>
<span class='line-number'>2184</span>
<span class='line-number'>2185</span>
<span class='line-number'>2186</span>
<span class='line-number'>2187</span>
<span class='line-number'>2188</span>
<span class='line-number'>2189</span>
<span class='line-number'>2190</span>
<span class='line-number'>2191</span>
<span class='line-number'>2192</span>
<span class='line-number'>2193</span>
<span class='line-number'>2194</span>
<span class='line-number'>2195</span>
<span class='line-number'>2196</span>
<span class='line-number'>2197</span>
<span class='line-number'>2198</span>
<span class='line-number'>2199</span>
<span class='line-number'>2200</span>
<span class='line-number'>2201</span>
<span class='line-number'>2202</span>
<span class='line-number'>2203</span>
<span class='line-number'>2204</span>
<span class='line-number'>2205</span>
<span class='line-number'>2206</span>
<span class='line-number'>2207</span>
<span class='line-number'>2208</span>
<span class='line-number'>2209</span>
<span class='line-number'>2210</span>
<span class='line-number'>2211</span>
<span class='line-number'>2212</span>
<span class='line-number'>2213</span>
<span class='line-number'>2214</span>
<span class='line-number'>2215</span>
<span class='line-number'>2216</span>
<span class='line-number'>2217</span>
<span class='line-number'>2218</span>
<span class='line-number'>2219</span>
<span class='line-number'>2220</span>
<span class='line-number'>2221</span>
<span class='line-number'>2222</span>
<span class='line-number'>2223</span>
<span class='line-number'>2224</span>
<span class='line-number'>2225</span>
<span class='line-number'>2226</span>
<span class='line-number'>2227</span>
<span class='line-number'>2228</span>
<span class='line-number'>2229</span>
<span class='line-number'>2230</span>
<span class='line-number'>2231</span>
<span class='line-number'>2232</span>
<span class='line-number'>2233</span>
<span class='line-number'>2234</span>
<span class='line-number'>2235</span>
<span class='line-number'>2236</span>
<span class='line-number'>2237</span>
<span class='line-number'>2238</span>
<span class='line-number'>2239</span>
<span class='line-number'>2240</span>
<span class='line-number'>2241</span>
<span class='line-number'>2242</span>
<span class='line-number'>2243</span>
<span class='line-number'>2244</span>
<span class='line-number'>2245</span>
<span class='line-number'>2246</span>
<span class='line-number'>2247</span>
<span class='line-number'>2248</span>
<span class='line-number'>2249</span>
<span class='line-number'>2250</span>
<span class='line-number'>2251</span>
<span class='line-number'>2252</span>
<span class='line-number'>2253</span>
<span class='line-number'>2254</span>
<span class='line-number'>2255</span>
<span class='line-number'>2256</span>
<span class='line-number'>2257</span>
<span class='line-number'>2258</span>
<span class='line-number'>2259</span>
<span class='line-number'>2260</span>
<span class='line-number'>2261</span>
<span class='line-number'>2262</span>
<span class='line-number'>2263</span>
<span class='line-number'>2264</span>
<span class='line-number'>2265</span>
<span class='line-number'>2266</span>
<span class='line-number'>2267</span>
<span class='line-number'>2268</span>
<span class='line-number'>2269</span>
<span class='line-number'>2270</span>
<span class='line-number'>2271</span>
<span class='line-number'>2272</span>
<span class='line-number'>2273</span>
<span class='line-number'>2274</span>
<span class='line-number'>2275</span>
<span class='line-number'>2276</span>
<span class='line-number'>2277</span>
<span class='line-number'>2278</span>
<span class='line-number'>2279</span>
<span class='line-number'>2280</span>
<span class='line-number'>2281</span>
<span class='line-number'>2282</span>
<span class='line-number'>2283</span>
<span class='line-number'>2284</span>
<span class='line-number'>2285</span>
<span class='line-number'>2286</span>
<span class='line-number'>2287</span>
<span class='line-number'>2288</span>
<span class='line-number'>2289</span>
<span class='line-number'>2290</span>
<span class='line-number'>2291</span>
<span class='line-number'>2292</span>
<span class='line-number'>2293</span>
<span class='line-number'>2294</span>
<span class='line-number'>2295</span>
<span class='line-number'>2296</span>
<span class='line-number'>2297</span>
<span class='line-number'>2298</span>
<span class='line-number'>2299</span>
<span class='line-number'>2300</span>
<span class='line-number'>2301</span>
<span class='line-number'>2302</span>
<span class='line-number'>2303</span>
<span class='line-number'>2304</span>
<span class='line-number'>2305</span>
<span class='line-number'>2306</span>
<span class='line-number'>2307</span>
<span class='line-number'>2308</span>
<span class='line-number'>2309</span>
<span class='line-number'>2310</span>
<span class='line-number'>2311</span>
<span class='line-number'>2312</span>
<span class='line-number'>2313</span>
<span class='line-number'>2314</span>
<span class='line-number'>2315</span>
<span class='line-number'>2316</span>
<span class='line-number'>2317</span>
<span class='line-number'>2318</span>
<span class='line-number'>2319</span>
<span class='line-number'>2320</span>
<span class='line-number'>2321</span>
<span class='line-number'>2322</span>
<span class='line-number'>2323</span>
<span class='line-number'>2324</span>
<span class='line-number'>2325</span>
<span class='line-number'>2326</span>
<span class='line-number'>2327</span>
<span class='line-number'>2328</span>
<span class='line-number'>2329</span>
<span class='line-number'>2330</span>
<span class='line-number'>2331</span>
<span class='line-number'>2332</span>
<span class='line-number'>2333</span>
<span class='line-number'>2334</span>
<span class='line-number'>2335</span>
<span class='line-number'>2336</span>
<span class='line-number'>2337</span>
<span class='line-number'>2338</span>
<span class='line-number'>2339</span>
<span class='line-number'>2340</span>
<span class='line-number'>2341</span>
<span class='line-number'>2342</span>
<span class='line-number'>2343</span>
<span class='line-number'>2344</span>
<span class='line-number'>2345</span>
<span class='line-number'>2346</span>
<span class='line-number'>2347</span>
<span class='line-number'>2348</span>
<span class='line-number'>2349</span>
<span class='line-number'>2350</span>
<span class='line-number'>2351</span>
<span class='line-number'>2352</span>
<span class='line-number'>2353</span>
<span class='line-number'>2354</span>
<span class='line-number'>2355</span>
<span class='line-number'>2356</span>
<span class='line-number'>2357</span>
<span class='line-number'>2358</span>
<span class='line-number'>2359</span>
<span class='line-number'>2360</span>
<span class='line-number'>2361</span>
<span class='line-number'>2362</span>
<span class='line-number'>2363</span>
<span class='line-number'>2364</span>
<span class='line-number'>2365</span>
<span class='line-number'>2366</span>
<span class='line-number'>2367</span>
<span class='line-number'>2368</span>
<span class='line-number'>2369</span>
<span class='line-number'>2370</span>
<span class='line-number'>2371</span>
<span class='line-number'>2372</span>
<span class='line-number'>2373</span>
<span class='line-number'>2374</span>
<span class='line-number'>2375</span>
<span class='line-number'>2376</span>
<span class='line-number'>2377</span>
<span class='line-number'>2378</span>
<span class='line-number'>2379</span>
<span class='line-number'>2380</span>
<span class='line-number'>2381</span>
<span class='line-number'>2382</span>
<span class='line-number'>2383</span>
<span class='line-number'>2384</span>
<span class='line-number'>2385</span>
<span class='line-number'>2386</span>
<span class='line-number'>2387</span>
<span class='line-number'>2388</span>
<span class='line-number'>2389</span>
<span class='line-number'>2390</span>
<span class='line-number'>2391</span>
<span class='line-number'>2392</span>
<span class='line-number'>2393</span>
<span class='line-number'>2394</span>
<span class='line-number'>2395</span>
<span class='line-number'>2396</span>
<span class='line-number'>2397</span>
<span class='line-number'>2398</span>
<span class='line-number'>2399</span>
<span class='line-number'>2400</span>
<span class='line-number'>2401</span>
<span class='line-number'>2402</span>
<span class='line-number'>2403</span>
<span class='line-number'>2404</span>
<span class='line-number'>2405</span>
<span class='line-number'>2406</span>
<span class='line-number'>2407</span>
<span class='line-number'>2408</span>
<span class='line-number'>2409</span>
<span class='line-number'>2410</span>
<span class='line-number'>2411</span>
<span class='line-number'>2412</span>
<span class='line-number'>2413</span>
<span class='line-number'>2414</span>
<span class='line-number'>2415</span>
<span class='line-number'>2416</span>
<span class='line-number'>2417</span>
<span class='line-number'>2418</span>
<span class='line-number'>2419</span>
<span class='line-number'>2420</span>
<span class='line-number'>2421</span>
<span class='line-number'>2422</span>
<span class='line-number'>2423</span>
<span class='line-number'>2424</span>
<span class='line-number'>2425</span>
</pre></td><td class='code'><pre><code class='fortran'><span class='line'><span class="k">module </span><span class="nv">decomp_2d_poisson</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">use </span><span class="nv">decomp_2d</span>
</span><span class='line'>  <span class="k">use </span><span class="nv">decomp_2d_fft</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">use </span><span class="nv">param</span>
</span><span class='line'>  <span class="k">use </span><span class="nv">variables</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">implicit none</span>
</span><span class='line'>
</span><span class='line'><span class="k">  private</span>        <span class="c">! Make everything private unless declared public</span>
</span><span class='line'>
</span><span class='line'><span class="c">!  real(mytype), private, parameter :: PI = 3.14159265358979323846_mytype</span>
</span><span class='line'><span class="c">!                                   This 0.0_mytype!!!!!!!!!!!!!1111</span>
</span><span class='line'>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DOUBLE_PREC</span>
</span><span class='line'>  <span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="nb">epsilon</span> <span class="o">=</span> <span class="mf">1.e-16</span>
</span><span class='line'><span class="err">#</span><span class="k">else</span>
</span><span class='line'><span class="k">  </span><span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="nb">epsilon</span> <span class="o">=</span> <span class="mf">1.e-8</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">! boundary conditions</span>
</span><span class='line'>  <span class="kt">integer</span><span class="p">,</span> <span class="k">save</span> <span class="kd">::</span> <span class="nv">bcx</span><span class="p">,</span> <span class="nv">bcy</span><span class="p">,</span> <span class="nv">bcz</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">! decomposition object for physical space</span>
</span><span class='line'>  <span class="k">TYPE</span><span class="p">(</span><span class="nv">DECOMP_INFO</span><span class="p">),</span> <span class="k">save</span> <span class="kd">::</span> <span class="nv">ph</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">! decomposition object for spectral space</span>
</span><span class='line'>  <span class="k">TYPE</span><span class="p">(</span><span class="nv">DECOMP_INFO</span><span class="p">),</span> <span class="k">save</span> <span class="kd">::</span> <span class="nv">sp</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">! store sine/cosine factors</span>
</span><span class='line'>  <span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span> <span class="k">save</span><span class="p">,</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:)</span> <span class="kd">::</span> <span class="nv">az</span><span class="p">,</span><span class="nv">bz</span>
</span><span class='line'>  <span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span> <span class="k">save</span><span class="p">,</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:)</span> <span class="kd">::</span> <span class="nv">ay</span><span class="p">,</span><span class="nv">by</span>
</span><span class='line'>  <span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span> <span class="k">save</span><span class="p">,</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:)</span> <span class="kd">::</span> <span class="nv">ax</span><span class="p">,</span><span class="nv">bx</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">! wave numbers</span>
</span><span class='line'>  <span class="kt">complex</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span> <span class="k">save</span><span class="p">,</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,:,:)</span> <span class="kd">::</span> <span class="nv">kxyz</span>
</span><span class='line'>  <span class="c">!wave numbers for stretching in a pentadiagonal matrice</span>
</span><span class='line'>  <span class="kt">complex</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span> <span class="k">save</span><span class="p">,</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,:,:,:)</span> <span class="kd">::</span> <span class="nv">a</span><span class="p">,</span><span class="nv">a2</span><span class="p">,</span><span class="nv">a3</span>
</span><span class='line'>  <span class="c">! work arrays,</span>
</span><span class='line'>  <span class="c">! naming convention: cw (complex); rw (real);</span>
</span><span class='line'>  <span class="c">!                    1 = X-pencil; 2 = Y-pencil; 3 = Z-pencil</span>
</span><span class='line'>  <span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,:,:)</span> <span class="kd">::</span> <span class="nv">rw1</span><span class="p">,</span><span class="nv">rw1b</span><span class="p">,</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">rw2b</span><span class="p">,</span><span class="nv">rw3</span>
</span><span class='line'>  <span class="kt">complex</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,:,:)</span> <span class="kd">::</span> <span class="nv">cw1</span><span class="p">,</span><span class="nv">cw1b</span><span class="p">,</span><span class="nv">cw2</span><span class="p">,</span><span class="nv">cw22</span><span class="p">,</span><span class="nv">cw2b</span><span class="p">,</span><span class="nv">cw2c</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">! underlying FFT library only needs to be initialised once</span>
</span><span class='line'>  <span class="kt">logical</span><span class="p">,</span> <span class="k">save</span> <span class="kd">::</span> <span class="nv">fft_initialised</span> <span class="o">=</span> <span class="nb">.false.</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="kd">::</span> <span class="nv">decomp_2d_poisson_stg</span><span class="p">,</span> <span class="nv">decomp_2d_poisson_init</span><span class="p">,</span> <span class="p">&amp;</span>
</span><span class='line'>       <span class="nv">decomp_2d_poisson_finalize</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">! For staggered mesh where main variables are defined in the centre of</span>
</span><span class='line'>  <span class="c">! control volumes while boundary conditions are defined on interfaces</span>
</span><span class='line'>  <span class="k">interface </span><span class="nv">decomp_2d_poisson_stg</span>
</span><span class='line'>     <span class="k">module </span><span class="nv">procedure</span> <span class="nv">poisson</span>
</span><span class='line'>  <span class="k">end interface</span>
</span><span class='line'><span class="k">contains</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="c">! Initialise Poisson solver for given boundary conditions</span>
</span><span class='line'>  <span class="c">!                               given</span>
</span><span class='line'>  <span class="c">!                               given</span>
</span><span class='line'>  <span class="c">!   just for init</span>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="k">subroutine </span><span class="nv">decomp_2d_poisson_init</span><span class="p">(</span><span class="nv">bcx1</span><span class="p">,</span> <span class="nv">bcy1</span><span class="p">,</span> <span class="nv">bcz1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">implicit none</span>
</span><span class='line'>
</span><span class='line'><span class="k">    </span><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">bcx1</span><span class="p">,</span> <span class="nv">bcy1</span><span class="p">,</span> <span class="nv">bcz1</span>
</span><span class='line'>    <span class="kt">integer</span> <span class="kd">::</span> <span class="nv">nx</span><span class="p">,</span> <span class="nv">ny</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">i</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">bcx</span> <span class="o">=</span> <span class="nv">bcx1</span>
</span><span class='line'>    <span class="nv">bcy</span> <span class="o">=</span> <span class="nv">bcy1</span>
</span><span class='line'>    <span class="nv">bcz</span> <span class="o">=</span> <span class="nv">bcz1</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">nx</span> <span class="o">=</span> <span class="nv">nx_global</span>
</span><span class='line'>    <span class="nv">ny</span> <span class="o">=</span> <span class="nv">ny_global</span>
</span><span class='line'>    <span class="nv">nz</span> <span class="o">=</span> <span class="nv">nz_global</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! pressure-grid having 1 fewer point for non-periodic directions</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nv">bcx</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="nv">nx</span><span class="o">=</span><span class="nv">nx</span><span class="o">-</span><span class="mi">1</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nv">bcy</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="nv">ny</span><span class="o">=</span><span class="nv">ny</span><span class="o">-</span><span class="mi">1</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nv">bcz</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="nv">nz</span><span class="o">=</span><span class="nv">nz</span><span class="o">-</span><span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">allocate</span><span class="p">(</span><span class="nv">ax</span><span class="p">(</span><span class="nv">nx</span><span class="p">),</span><span class="nv">bx</span><span class="p">(</span><span class="nv">nx</span><span class="p">))</span>
</span><span class='line'>    <span class="k">allocate</span><span class="p">(</span><span class="nv">ay</span><span class="p">(</span><span class="nv">ny</span><span class="p">),</span><span class="nv">by</span><span class="p">(</span><span class="nv">ny</span><span class="p">))</span>
</span><span class='line'>    <span class="k">allocate</span><span class="p">(</span><span class="nv">az</span><span class="p">(</span><span class="nv">nz</span><span class="p">),</span><span class="nv">bz</span><span class="p">(</span><span class="nv">nz</span><span class="p">))</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">abxyz</span><span class="p">(</span><span class="nv">ax</span><span class="p">,</span><span class="nv">ay</span><span class="p">,</span><span class="nv">az</span><span class="p">,</span><span class="nv">bx</span><span class="p">,</span><span class="nv">by</span><span class="p">,</span><span class="nv">bz</span><span class="p">,</span><span class="nv">nx</span><span class="p">,</span><span class="nv">ny</span><span class="p">,</span><span class="nv">nz</span><span class="p">,</span><span class="nv">bcx</span><span class="p">,</span><span class="nv">bcy</span><span class="p">,</span><span class="nv">bcz</span><span class="p">)</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!1</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!Initialise the ax bx</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!Initialise the ay by</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!Initialise the az bz</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!1</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="k">call </span><span class="nv">decomp_info_init</span><span class="p">(</span><span class="nv">nx</span><span class="p">,</span> <span class="nv">ny</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">decomp_info_init</span><span class="p">(</span><span class="nv">nx</span><span class="p">,</span> <span class="nv">ny</span><span class="p">,</span> <span class="nv">nz</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nv">sp</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! allocate work space</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nv">bcx</span><span class="o">==</span><span class="mi">0</span> <span class="ow">.and.</span> <span class="nv">bcy</span><span class="o">==</span><span class="mi">0</span> <span class="ow">.and.</span> <span class="nv">bcz</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       allocate</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>            <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">kxyz</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>            <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">a</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">5</span><span class="p">))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">a2</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">5</span><span class="p">))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">a3</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ny</span><span class="p">,</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">5</span><span class="p">))</span>
</span><span class='line'>       <span class="c">! (000)  ^c  ^kxyz ^a</span>
</span><span class='line'>    <span class="k">else if</span> <span class="p">(</span><span class="nv">bcx</span><span class="o">==</span><span class="mi">1</span> <span class="ow">.and.</span> <span class="nv">bcy</span><span class="o">==</span><span class="mi">0</span> <span class="ow">.and.</span> <span class="nv">bcz</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       allocate</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                 <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                 <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">rw1</span><span class="p">(</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>            <span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">rw1b</span><span class="p">(</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>            <span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">rw2</span><span class="p">(</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>            <span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">kxyz</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>            <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">a</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">5</span><span class="p">))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">a2</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">5</span><span class="p">))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">a3</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ny</span><span class="p">,</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">5</span><span class="p">))</span>
</span><span class='line'>       <span class="c">!(100)      consist :: cw1 cw1b   rw1   rw1b   rw2    ^a</span>
</span><span class='line'>    <span class="k">else if</span> <span class="p">(</span><span class="nv">bcx</span><span class="o">==</span><span class="mi">0</span> <span class="ow">.and.</span> <span class="nv">bcy</span><span class="o">==</span><span class="mi">1</span> <span class="ow">.and.</span> <span class="nv">bcz</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       allocate</span><span class="p">(</span><span class="nv">rw2</span><span class="p">(</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>            <span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">rw2b</span><span class="p">(</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>            <span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                 <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                 <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>            <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                 <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">cw2c</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                 <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">kxyz</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>            <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">a</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">5</span><span class="p">))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">a2</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">5</span><span class="p">))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">a3</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ny</span><span class="p">,</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">5</span><span class="p">))</span>
</span><span class='line'>       <span class="c">!(010)  rw2 rw2b cw2 cw22 cw2b cw2c kxyz  ^a</span>
</span><span class='line'>    <span class="k">else if</span> <span class="p">(</span><span class="nv">bcx</span><span class="o">==</span><span class="mi">1</span> <span class="ow">.and.</span> <span class="nv">bcy</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       allocate</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                 <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                 <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                 <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>            <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                 <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">cw2c</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                 <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">rw1</span><span class="p">(</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>            <span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">rw1b</span><span class="p">(</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>            <span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">rw2</span><span class="p">(</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>            <span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">rw2b</span><span class="p">(</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>            <span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>        <span class="c">!(11*) cw1 cw1b cw2 cw2b  cw2c  rw1 rw1b rw2b</span>
</span><span class='line'>       <span class="k">if</span> <span class="p">(</span><span class="nv">bcz</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then  </span>
</span><span class='line'><span class="k">          allocate</span><span class="p">(</span><span class="nv">rw3</span><span class="p">(</span><span class="nv">ph</span><span class="p">%</span><span class="nv">zsz</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">zsz</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">zsz</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">end if</span>
</span><span class='line'><span class="k">       allocate</span><span class="p">(</span><span class="nv">kxyz</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>            <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">a</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">5</span><span class="p">))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">a2</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">5</span><span class="p">))</span>
</span><span class='line'>       <span class="k">allocate</span><span class="p">(</span><span class="nv">a3</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">nym</span><span class="p">,</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">5</span><span class="p">))</span>
</span><span class='line'>       <span class="c">!(111) rw3  kxyz  ^a</span>
</span><span class='line'>    <span class="k">end if</span>
</span><span class='line'>
</span><span class='line'><span class="k">    call </span><span class="nv">waves</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span>
</span><span class='line'><span class="k">  end subroutine </span><span class="nv">decomp_2d_poisson_init</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="c">! Release memory used by Poisson solver</span>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="k">subroutine </span><span class="nv">decomp_2d_poisson_finalize</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">implicit none</span>
</span><span class='line'>
</span><span class='line'><span class="k">    deallocate</span><span class="p">(</span><span class="nv">ax</span><span class="p">,</span><span class="nv">bx</span><span class="p">,</span><span class="nv">ay</span><span class="p">,</span><span class="nv">by</span><span class="p">,</span><span class="nv">az</span><span class="p">,</span><span class="nv">bz</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">call </span><span class="nv">decomp_info_finalize</span><span class="p">(</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">decomp_info_finalize</span><span class="p">(</span><span class="nv">sp</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">call </span><span class="nv">decomp_2d_fft_finalize</span>
</span><span class='line'>    <span class="nv">fft_initialised</span> <span class="o">=</span> <span class="nb">.false.</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">deallocate</span><span class="p">(</span><span class="nv">kxyz</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nv">bcx</span><span class="o">==</span><span class="mi">0</span> <span class="ow">.and.</span> <span class="nv">bcy</span><span class="o">==</span><span class="mi">0</span> <span class="ow">.and.</span> <span class="nv">bcz</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       deallocate</span><span class="p">(</span><span class="nv">cw1</span><span class="p">)</span>
</span><span class='line'>       <span class="c">! (000) cw1</span>
</span><span class='line'>    <span class="k">else if</span> <span class="p">(</span><span class="nv">bcx</span><span class="o">==</span><span class="mi">1</span> <span class="ow">.and.</span> <span class="nv">bcy</span><span class="o">==</span><span class="mi">0</span> <span class="ow">.and.</span> <span class="nv">bcz</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       deallocate</span><span class="p">(</span><span class="nv">cw1</span><span class="p">,</span><span class="nv">cw1b</span><span class="p">,</span><span class="nv">rw1</span><span class="p">,</span><span class="nv">rw1b</span><span class="p">,</span><span class="nv">rw2</span><span class="p">)</span>
</span><span class='line'>       <span class="c">! (100)   cw1 cw1b rw1 rw1b rw2</span>
</span><span class='line'>    <span class="k">else if</span> <span class="p">(</span><span class="nv">bcx</span><span class="o">==</span><span class="mi">0</span> <span class="ow">.and.</span> <span class="nv">bcy</span><span class="o">==</span><span class="mi">1</span> <span class="ow">.and.</span> <span class="nv">bcz</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       deallocate</span><span class="p">(</span><span class="nv">cw1</span><span class="p">,</span><span class="nv">cw2</span><span class="p">,</span><span class="nv">cw2b</span><span class="p">,</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">rw2b</span><span class="p">)</span>
</span><span class='line'>       <span class="c">! (010)   cw1 cw2  cw2b  rw2 rw2b</span>
</span><span class='line'>    <span class="k">else if</span> <span class="p">(</span><span class="nv">bcx</span><span class="o">==</span><span class="mi">1</span> <span class="ow">.and.</span> <span class="nv">bcy</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       deallocate</span><span class="p">(</span><span class="nv">cw1</span><span class="p">,</span><span class="nv">cw1b</span><span class="p">,</span><span class="nv">cw2</span><span class="p">,</span><span class="nv">cw2b</span><span class="p">,</span><span class="nv">rw1</span><span class="p">,</span><span class="nv">rw1b</span><span class="p">,</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">rw2b</span><span class="p">)</span>
</span><span class='line'>       <span class="c">! (11*)   cw1,cw1b,cw2,cw2b,rw1,rw1b,rw2,rw2b</span>
</span><span class='line'>       <span class="k">if</span> <span class="p">(</span><span class="nv">bcz</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">          deallocate</span><span class="p">(</span><span class="nv">rw3</span><span class="p">)</span>
</span><span class='line'>        <span class="c">!(111)    rw3</span>
</span><span class='line'>       <span class="k">end if</span>
</span><span class='line'><span class="k">    end if</span>
</span><span class='line'>
</span><span class='line'><span class="k">    return</span>
</span><span class='line'><span class="k">  end subroutine </span><span class="nv">decomp_2d_poisson_finalize</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="c">! Top level wrapper</span>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="k">subroutine </span><span class="nv">poisson</span><span class="p">(</span><span class="nv">rhs</span><span class="p">,</span> <span class="nv">bcx</span><span class="p">,</span> <span class="nv">bcy</span><span class="p">,</span> <span class="nv">bcz</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">implicit none</span>
</span><span class='line'>
</span><span class='line'><span class="k">    </span><span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">intent</span><span class="p">(</span><span class="nv">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">rhs</span>
</span><span class='line'>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">bcx</span><span class="p">,</span> <span class="nv">bcy</span><span class="p">,</span> <span class="nv">bcz</span>  <span class="c">! boundary conditions</span>
</span><span class='line'>    <span class="kt">integer</span> <span class="kd">::</span> <span class="nv">i</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nv">bcx</span><span class="o">==</span><span class="mi">0</span> <span class="ow">.and.</span> <span class="nv">bcy</span><span class="o">==</span><span class="mi">0</span> <span class="ow">.and.</span> <span class="nv">bcz</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       call </span><span class="nv">poisson_000</span><span class="p">(</span><span class="nv">rhs</span><span class="p">)</span>
</span><span class='line'>    <span class="k">else if</span> <span class="p">(</span><span class="nv">bcx</span><span class="o">==</span><span class="mi">1</span> <span class="ow">.and.</span> <span class="nv">bcy</span><span class="o">==</span><span class="mi">0</span> <span class="ow">.and.</span> <span class="nv">bcz</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       call </span><span class="nv">poisson_100</span><span class="p">(</span><span class="nv">rhs</span><span class="p">)</span>
</span><span class='line'>    <span class="k">else if</span> <span class="p">(</span><span class="nv">bcx</span><span class="o">==</span><span class="mi">0</span> <span class="ow">.and.</span> <span class="nv">bcy</span><span class="o">==</span><span class="mi">1</span> <span class="ow">.and.</span> <span class="nv">bcz</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       call </span><span class="nv">poisson_010</span><span class="p">(</span><span class="nv">rhs</span><span class="p">)</span>
</span><span class='line'>    <span class="k">else if</span> <span class="p">(</span><span class="nv">bcx</span><span class="o">==</span><span class="mi">1</span> <span class="ow">.and.</span> <span class="nv">bcy</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>   <span class="c">! 110 &amp; 111</span>
</span><span class='line'>       <span class="k">call </span><span class="nv">poisson_11x</span><span class="p">(</span><span class="nv">rhs</span><span class="p">,</span> <span class="nv">bcz</span><span class="p">)</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'><span class="k">       stop</span> <span class="s1">&#39;boundary condition not supported&#39;</span>
</span><span class='line'>    <span class="k">end if</span>
</span><span class='line'>
</span><span class='line'><span class="k">    return</span>
</span><span class='line'><span class="k">  end subroutine </span><span class="nv">poisson</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="c">! Solving 3D Poisson equation with periodic B.C in all 3 dimensions</span>
</span><span class='line'>  <span class="c">!                                                      3</span>
</span><span class='line'>  <span class="c">!                                                      3</span>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="k">subroutine </span><span class="nv">poisson_000</span><span class="p">(</span><span class="nv">rhs</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">use </span><span class="nv">derivX</span>
</span><span class='line'>    <span class="k">use </span><span class="nv">derivY</span>
</span><span class='line'>    <span class="k">use </span><span class="nv">derivZ</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! right-hand-side of Poisson as input</span>
</span><span class='line'>    <span class="c">! solution of Poisson as output</span>
</span><span class='line'>    <span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">intent</span><span class="p">(</span><span class="nv">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">rhs</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">fft_start</span><span class="p">,</span> <span class="nv">fft_end</span><span class="p">,</span> <span class="nv">fft_size</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">complex</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">xyzk</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">complex</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">ytt</span><span class="p">,</span><span class="nv">xtt</span><span class="p">,</span><span class="nv">ztt</span><span class="p">,</span><span class="nv">yt1</span><span class="p">,</span><span class="nv">xt1</span><span class="p">,</span><span class="nv">yt2</span><span class="p">,</span><span class="nv">xt2</span>
</span><span class='line'>    <span class="kt">complex</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">xtt1</span><span class="p">,</span><span class="nv">ytt1</span><span class="p">,</span><span class="nv">ztt1</span><span class="p">,</span><span class="nv">zt1</span><span class="p">,</span><span class="nv">zt2</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">tmp1</span><span class="p">,</span> <span class="nv">tmp2</span><span class="p">,</span><span class="nv">x</span> <span class="p">,</span><span class="nv">y</span><span class="p">,</span> <span class="nv">z</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">integer</span> <span class="kd">::</span> <span class="nv">nx</span><span class="p">,</span><span class="nv">ny</span><span class="p">,</span><span class="nv">nz</span><span class="p">,</span> <span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">nx</span> <span class="o">=</span> <span class="nv">nx_global</span>
</span><span class='line'>    <span class="nv">ny</span> <span class="o">=</span> <span class="nv">ny_global</span>
</span><span class='line'>    <span class="nv">nz</span> <span class="o">=</span> <span class="nv">nz_global</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="ow">.not.</span> <span class="nv">fft_initialised</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       call </span><span class="nv">decomp_2d_fft_init</span><span class="p">(</span><span class="nv">PHYSICAL_IN_Z</span><span class="p">)</span>
</span><span class='line'>       <span class="nv">fft_initialised</span> <span class="o">=</span> <span class="nb">.true.</span>
</span><span class='line'>    <span class="k">end if</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! compute r2c transform   r2c:real to complex by zhaoliang</span>
</span><span class='line'>    <span class="c">! cw1 is 3dim data structrue</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!! only fft to transform the real data to complex data while (100) twice</span>
</span><span class='line'>    <span class="c">!!!!! one is tranform and then fft  (you can see poisson100</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">decomp_2d_fft_3d</span><span class="p">(</span><span class="nv">rhs</span><span class="p">,</span><span class="nv">cw1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="c">! normalisation</span>
</span><span class='line'>    <span class="c">!  why this below is called normalisation ??????  just divide 3dim grid number</span>
</span><span class='line'>    <span class="nv">cw1</span> <span class="o">=</span> <span class="nv">cw1</span> <span class="o">/</span> <span class="kt">real</span><span class="p">(</span><span class="nv">nx</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span> <span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">ny</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>         <span class="o">/</span> <span class="kt">real</span><span class="p">(</span><span class="nv">nz</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>             <span class="c">! post-processing in spectral space</span>
</span><span class='line'>
</span><span class='line'>             <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>             <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>             <span class="c">!!!!!!!!!!!!!!!!!post-processing in 3-direction can be</span>
</span><span class='line'>             <span class="c">!!!!!!!!!!!!!!!!! set in the same cycle,because they are</span>
</span><span class='line'>             <span class="c">!!!!!!!!!!!!!!!!!! similar</span>
</span><span class='line'>             <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>             <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>
</span><span class='line'>             <span class="c">! POST PROCESSING IN Z</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>   <span class="c">!  get the real number of cw1</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>               <span class="c">!  get the imagenumber of cw1</span>
</span><span class='line'>             <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">bz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">+</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">az</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nv">tmp2</span><span class="o">*</span><span class="nv">bz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">-</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">az</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>   <span class="c">! modify the cw1 in the spectral space Z</span>
</span><span class='line'>                                                    <span class="c">!  bz  az</span>
</span><span class='line'>                                                    <span class="c">!  by  ay</span>
</span><span class='line'>                                                    <span class="c">!  bx  ax</span>
</span><span class='line'>
</span><span class='line'>             <span class="c">! POST PROCESSING IN Y</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">+</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nv">tmp2</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">-</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nv">j</span><span class="ow">.gt.</span><span class="p">(</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=-</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>   <span class="c">! why should be axisymmetry!</span>
</span><span class='line'>
</span><span class='line'>             <span class="c">! POST PROCESSING IN X</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">+</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nv">tmp2</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">-</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nv">i</span><span class="ow">.gt.</span><span class="p">(</span><span class="nv">nx</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=-</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>             <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>             <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>             <span class="c">!!!!!!!!!!!!!!! Solve Poisson</span>
</span><span class='line'>             <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>             <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>
</span><span class='line'>             <span class="nv">tmp1</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="nv">kxyz</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span><span class="o">=</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">kxyz</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="c">! CANNOT DO A DIVISION BY ZERO</span>
</span><span class='line'>             <span class="c">!  Yes ! division  by zero is impossible!!!-----------------------------------&lt;</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">((</span><span class="nv">tmp1</span><span class="ow">.lt.</span><span class="nb">epsilon</span><span class="p">)</span><span class="ow">.or.</span><span class="p">(</span><span class="nv">tmp2</span><span class="ow">.lt.</span><span class="nb">epsilon</span><span class="p">))</span> <span class="k">then</span>   <span class="c">!epsilon?  what does it mean?</span>
</span><span class='line'>                <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'><span class="c">!                print *,&#39;DIV 0&#39;,i,j,k,epsilon</span>
</span><span class='line'>             <span class="k">else</span>
</span><span class='line'><span class="k">                </span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="o">-</span><span class="nv">tmp1</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                     <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="nv">tmp2</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'>
</span><span class='line'>           <span class="c">!Print result in spectal space after Poisson</span>
</span><span class='line'>      <span class="c">!     if (abs(out(i,j,k)) &gt; 1.0e-4) then</span>
</span><span class='line'>      <span class="c">!        write(*,*) &#39;AFTER&#39;,i,j,k,out(i,j,k),xyzk</span>
</span><span class='line'>      <span class="c">!     end if</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>             <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>             <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>             <span class="c">! post-processing backward</span>
</span><span class='line'>             <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>             <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>
</span><span class='line'>             <span class="c">! POST PROCESSING IN Z</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">bz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">-</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">az</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="o">-</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">bz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">-</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">az</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>              <span class="c">!                                          bz    az</span>
</span><span class='line'>              <span class="c">!                                          by    ay</span>
</span><span class='line'>              <span class="c">!                                          bx    ax</span>
</span><span class='line'>
</span><span class='line'>             <span class="c">! POST PROCESSING IN Y</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">+</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nv">tmp2</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">-</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nv">j</span><span class="ow">.gt.</span><span class="p">(</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=-</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>             <span class="c">! POST PROCESSING IN X</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">+</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="o">-</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">+</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nv">i</span><span class="ow">.gt.</span><span class="p">(</span><span class="nv">nx</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=-</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! compute c2r transform</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">decomp_2d_fft_3d</span><span class="p">(</span><span class="nv">cw1</span><span class="p">,</span><span class="nv">rhs</span><span class="p">)</span>    <span class="c">!  from complex  to real!</span>
</span><span class='line'>
</span><span class='line'> <span class="c">!   call decomp_2d_fft_finalize</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span>
</span><span class='line'><span class="k">  end subroutine </span><span class="nv">poisson_000</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="k">subroutine </span><span class="nv">poisson_100</span><span class="p">(</span><span class="nv">rhs</span><span class="p">)</span>
</span><span class='line'>      <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>      <span class="c">!!!! get the rhs and then modify rhs ,at last return the rhs</span>
</span><span class='line'>      <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="k">implicit none</span>
</span><span class='line'>
</span><span class='line'><span class="k">    </span><span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">intent</span><span class="p">(</span><span class="nv">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">rhs</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">complex</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">xyzk</span>
</span><span class='line'>    <span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">tmp1</span><span class="p">,</span> <span class="nv">tmp2</span><span class="p">,</span> <span class="nv">tmp3</span><span class="p">,</span> <span class="nv">tmp4</span>
</span><span class='line'>    <span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">xx1</span><span class="p">,</span><span class="nv">xx2</span><span class="p">,</span><span class="nv">xx3</span><span class="p">,</span><span class="nv">xx4</span><span class="p">,</span><span class="nv">xx5</span><span class="p">,</span><span class="nv">xx6</span><span class="p">,</span><span class="nv">xx7</span><span class="p">,</span><span class="nv">xx8</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">integer</span> <span class="kd">::</span> <span class="nv">nx</span><span class="p">,</span><span class="nv">ny</span><span class="p">,</span><span class="nv">nz</span><span class="p">,</span> <span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span> <span class="nv">itmp</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!  8 transform   from x --&gt;y --&gt;z then z--&gt; y ---&gt;x at the beginning</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!from x --&gt;y --&gt;z then z--&gt; y ---&gt;x at the endding</span>
</span><span class='line'>    <span class="c">!!!!!  (100 add 8 more transform than 000) while 000 is 0 transform</span>
</span><span class='line'>    <span class="c">!!!!!  so rhs is in the z pencil ,no there are not z pencil at all!</span>
</span><span class='line'>    <span class="c">!!!!!   the program is  2-dim pm*pn decomp !  so only  xpencil and y pencil</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>
</span><span class='line'>                   <span class="c">!!!!!!!!!!!!!!twice real to complex</span>
</span><span class='line'>                     <span class="c">!!!!!!!!!!! 1: transform rhs-rw2-rw1</span>
</span><span class='line'>                     <span class="c">!!!!!!!!!!! 2: fft       rhs-----rw1</span>
</span><span class='line'>                   <span class="c">!!!!!!!!!!!!!!twice complex to real</span>
</span><span class='line'>                     <span class="c">!!!!!!!!!!! 1: transfrom rw1-rw2--rhs</span>
</span><span class='line'>                     <span class="c">!!!!!!!!!!! 2: fft       rw1------rhs</span>
</span><span class='line'>                   <span class="c">!!!!!!!!!!!!! post-processing operations is under the complex condition</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   input real rhs(:.:,:) in the z pencil</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   2+2 transform    |destination: modify the rhs</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 normalisation</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 FFT forward</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   3 post-processing   z--&gt;y---&gt;x  direction not pencil</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 poisson solver</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   3 post-processing backward  x---&gt;y----&gt;z  direction</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 FFT backward</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   2+2 transform    |destination: modify the rhs</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   output real rhs(:,:,:)  in the z pencil</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>
</span><span class='line'><span class="mi">100</span> <span class="k">format</span><span class="p">(</span><span class="mi">1</span><span class="nv">x</span><span class="p">,</span><span class="nv">a8</span><span class="p">,</span><span class="mi">3</span><span class="nv">I4</span><span class="p">,</span><span class="mi">2</span><span class="nv">F12</span><span class="mf">.6</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">nx</span> <span class="o">=</span> <span class="nv">nx_global</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>    <span class="nv">ny</span> <span class="o">=</span> <span class="nv">ny_global</span>
</span><span class='line'>    <span class="nv">nz</span> <span class="o">=</span> <span class="nv">nz_global</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!1</span>
</span><span class='line'>    <span class="c">! rhs is in Z-pencil(wrong!There isn&#39;t Z pencil)(wrong</span>
</span><span class='line'>      <span class="c">!again, there is Z pencil))but requires global operations in X</span>
</span><span class='line'>    <span class="c">! why should do the transpose!!!!!!!!!!!!!!</span>
</span><span class='line'>       <span class="c">! why in the poisson_000 is not needed!???????????????</span>
</span><span class='line'>    <span class="c">!   two steps to change from z to x</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!1</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">call </span><span class="nv">transpose_z_to_y</span><span class="p">(</span><span class="nv">rhs</span><span class="p">,</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>  <span class="c">! z pencil in y pencil but in the physical space</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!rw2 is the complex 3-dim data the same as rw1</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">transpose_y_to_x</span><span class="p">(</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">rw1</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">nx</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>              <span class="c">!!! rw1  rw1b   1 means  x pencil   </span>
</span><span class='line'>              <span class="c">!!! rw2  rw2b   2 means  y pencil</span>
</span><span class='line'>             <span class="nv">rw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">rw1</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nv">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>  <span class="c">! the odd terms  is for the half before</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">nx</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">nx</span>
</span><span class='line'>             <span class="nv">rw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">rw1</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">nx</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nv">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>  <span class="c">! the reverse terms is for the half after</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>       <span class="nv">enddo</span>
</span><span class='line'>    <span class="k">end do</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!11</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!11</span>
</span><span class='line'>    <span class="c">!!!!3 layers data</span>
</span><span class='line'>    <span class="c">!!!! rw1b is the top lay data  xpencil     physical space</span>
</span><span class='line'>    <span class="c">!!!! rw2  is in the middle lay data   y pencil   physical space</span>
</span><span class='line'>    <span class="c">!!!! rw1 rhs  is in the outer lay data    z pencil  spectral space</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!11</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!11</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">call </span><span class="nv">transpose_x_to_y</span><span class="p">(</span><span class="nv">rw1b</span><span class="p">,</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>    <span class="c">! let x pencil rw1b to y pencil</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">transpose_y_to_z</span><span class="p">(</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">rhs</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>     <span class="c">! let y pencil rw2 to  z pencil&#39;s rhs</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!first time get what we want</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="ow">.not.</span> <span class="nv">fft_initialised</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       call </span><span class="nv">decomp_2d_fft_init</span><span class="p">(</span><span class="nv">PHYSICAL_IN_Z</span><span class="p">,</span><span class="nv">nx</span><span class="p">,</span><span class="nv">ny</span><span class="p">,</span><span class="nv">nz</span><span class="p">)</span>
</span><span class='line'>       <span class="nv">fft_initialised</span> <span class="o">=</span> <span class="nb">.true.</span>
</span><span class='line'>    <span class="k">end if</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">! compute r2c transform</span>
</span><span class='line'>    <span class="c">!           why should force the before pre-posting   ------------------------------&lt;&lt;&lt;&lt;</span>
</span><span class='line'>    <span class="c">!!!!!!!!!the most key operation :::: the fft operator: decomp_2d_fft_3d</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">call </span><span class="nv">decomp_2d_fft_3d</span><span class="p">(</span><span class="nv">rhs</span><span class="p">,</span><span class="nv">cw1</span><span class="p">)</span>  <span class="c">!  from real to complex!  and begin poission solver</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! in the z pencil we did the fft transform</span>
</span><span class='line'>        <span class="c">!!!!!!!!!!!!!!!!!! so cw1 is 3d complex data ,yeah (:,:,:)</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="c">! normalisation</span>
</span><span class='line'>    <span class="nv">cw1</span> <span class="o">=</span> <span class="nv">cw1</span> <span class="o">/</span> <span class="kt">real</span><span class="p">(</span><span class="nv">nx</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span> <span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">ny</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>         <span class="o">/</span> <span class="kt">real</span><span class="p">(</span><span class="nv">nz</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">                write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;START&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! post-processing in spectral space</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! POST PROCESSING IN Z</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">bz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">+</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">az</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nv">tmp2</span><span class="o">*</span><span class="nv">bz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">-</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">az</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;after z&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! POST PROCESSING IN Y</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">+</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nv">tmp2</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">-</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nv">j</span><span class="ow">.gt.</span><span class="p">(</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=-</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;after y&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!because (100)</span>
</span><span class='line'>                   <span class="c">!!!!!!!!!!!!!!!!!!!!!so the post processing in x is different</span>
</span><span class='line'>                   <span class="c">!!!!!!!!!!!!!!!!!!!!!from the  y and z</span>
</span><span class='line'>    <span class="c">! POST PROCESSING IN X</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">cw1b</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="nv">nx</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">tmp3</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">nx</span><span class="o">-</span><span class="nv">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span> <span class="c">!!! the 2~nx</span>
</span><span class='line'>             <span class="nv">tmp4</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">nx</span><span class="o">-</span><span class="nv">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>    <span class="c">!!!!!!!!!!!!     2~nx</span>
</span><span class='line'>             <span class="nv">xx1</span><span class="o">=</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx2</span><span class="o">=</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx3</span><span class="o">=</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx4</span><span class="o">=</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx5</span><span class="o">=</span><span class="nv">tmp3</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx6</span><span class="o">=</span><span class="nv">tmp3</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx7</span><span class="o">=</span><span class="nv">tmp4</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx8</span><span class="o">=</span><span class="nv">tmp4</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">xx1</span><span class="o">+</span><span class="nv">xx4</span><span class="o">+</span><span class="nv">xx5</span><span class="o">-</span><span class="nv">xx8</span><span class="p">,</span><span class="o">-</span><span class="nv">xx2</span><span class="o">+</span><span class="nv">xx3</span><span class="o">+</span><span class="nv">xx6</span><span class="o">+</span><span class="nv">xx7</span><span class="p">,</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>          <span class="k">end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!  While  you set the -Debug in the compile period</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">                write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;after x&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'><span class="c">!!!!!!!!!!!!!!!!!!!!!from now on, the cw1b in x,y,z direction(not pencil)</span>
</span><span class='line'><span class="c">!!!!!!!!!!!!!!!!!!!!is calculated ,so now you can calculate cw1b in the</span>
</span><span class='line'><span class="c">!!!!!!!!!!!!!!!!!!!!!!! poisson condition ,yes poisson solver</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! Solve Poisson</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="c">!tmp1=real(zk2(k)+yk2(j)+xk2(i), kind=mytype)</span>
</span><span class='line'>             <span class="c">!tmp2=aimag(zk2(k)+yk2(j)+xk2(i))</span>
</span><span class='line'>             <span class="nv">tmp1</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="nv">kxyz</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span><span class="o">=</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">kxyz</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="c">!xyzk=cmplx(tmp1,tmp2, kind=mytype)</span>
</span><span class='line'>             <span class="c">! CANNOT DO A DIVISION BY ZERO</span>
</span><span class='line'><span class="c">! yes</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp1</span><span class="p">)</span><span class="ow">.lt.</span><span class="nb">epsilon</span><span class="p">)</span><span class="ow">.and.</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp2</span><span class="p">)</span><span class="ow">.lt.</span><span class="nb">epsilon</span><span class="p">))</span> <span class="k">then    </span>
</span><span class='line'><span class="k">                </span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="mf">0.</span><span class="err">_</span><span class="nv">mytype</span><span class="p">,</span><span class="mf">0.</span><span class="err">_</span><span class="nv">mytype</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">             if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp1</span><span class="p">)</span><span class="ow">.lt.</span><span class="nb">epsilon</span><span class="p">)</span><span class="ow">.and.</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp2</span><span class="p">)</span><span class="ow">.ge.</span><span class="nb">epsilon</span><span class="p">))</span> <span class="k">then</span>
</span><span class='line'><span class="k">                </span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="mf">0.</span><span class="err">_</span><span class="nv">mytype</span><span class="p">,</span> <span class="p">&amp;</span>
</span><span class='line'>                     <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="nv">tmp2</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">             if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp1</span><span class="p">)</span><span class="ow">.ge.</span><span class="nb">epsilon</span><span class="p">)</span><span class="ow">.and.</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp2</span><span class="p">)</span><span class="ow">.lt.</span><span class="nb">epsilon</span><span class="p">))</span> <span class="k">then    </span>
</span><span class='line'><span class="k">                </span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>                     <span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="nv">tmp1</span><span class="p">),</span> <span class="mf">0.</span><span class="err">_</span><span class="nv">mytype</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'>             <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>             <span class="c">!!!!!!!!!!!!!!!!!!the most dayly processing</span>
</span><span class='line'>             <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp1</span><span class="p">)</span><span class="ow">.ge.</span><span class="nb">epsilon</span><span class="p">)</span><span class="ow">.and.</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp2</span><span class="p">)</span><span class="ow">.ge.</span><span class="nb">epsilon</span><span class="p">))</span> <span class="k">then</span>
</span><span class='line'><span class="k">                </span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>                     <span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="nv">tmp1</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                     <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="nv">tmp2</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;AFTER&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! post-processing backward</span>
</span><span class='line'>
</span><span class='line'><span class="c">!!!!!!!!!!!!!!!!!!!!!!  You know cw1b is the cw1&#39;s another form in the spectral</span>
</span><span class='line'><span class="c">!!!!!!!!!!!!!!!!!!!!!! space ,so you need to change the spetral space to physical</span>
</span><span class='line'><span class="c">!!!!!!!!!!!!!!!!!!!!!!! space again ,yes get the cw1</span>
</span><span class='line'><span class="c">!!!!!!!!!!!!!!!!!!!!!!!! from now on ,you will found that the calculate of poisson</span>
</span><span class='line'><span class="c">!!!!!!!!!!!!!!!!!!!!!!!! equation is in the spectral space ,from the fft,then 3 post</span>
</span><span class='line'><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!! processing in x,y,z 3 directions, then calculate the  poisson</span>
</span><span class='line'><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!! equation. OK,then you start next!</span>
</span><span class='line'>    <span class="c">! POST PROCESSING IN X</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">cw1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw1b</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="nv">nx</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">tmp3</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">nx</span><span class="o">-</span><span class="nv">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp4</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">nx</span><span class="o">-</span><span class="nv">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">xx1</span><span class="o">=</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx2</span><span class="o">=</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx3</span><span class="o">=</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx4</span><span class="o">=</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx5</span><span class="o">=</span><span class="nv">tmp3</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx6</span><span class="o">=</span><span class="nv">tmp3</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx7</span><span class="o">=</span><span class="nv">tmp4</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx8</span><span class="o">=</span><span class="nv">tmp4</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">xx1</span><span class="o">-</span><span class="nv">xx4</span><span class="o">+</span><span class="nv">xx6</span><span class="o">+</span><span class="nv">xx7</span><span class="p">,</span><span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="nv">xx2</span><span class="o">-</span><span class="nv">xx3</span><span class="o">+</span><span class="nv">xx5</span><span class="o">-</span><span class="nv">xx8</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>              <span class="c">!!!!!the buterfly algorithm!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>          <span class="k">end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!from now on x direction ,the spectral data has been transform to</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!! physical space, but still the complex</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">                write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;AFTER X&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! POST PROCESSING IN Y</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">-</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nv">tmp2</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">+</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nv">j</span><span class="ow">.gt.</span><span class="p">(</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=-</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;AFTER Y&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>
</span><span class='line'>                                    <span class="c">!!!!!!!!!!!!!!!!!!!!!! by  ay</span>
</span><span class='line'>                                    <span class="c">!!!!!!!!!!!!!!!!!!!!!! bz  az</span>
</span><span class='line'>    <span class="c">! POST PROCESSING IN Z</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">bz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">-</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">az</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nv">tmp2</span><span class="o">*</span><span class="nv">bz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">+</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">az</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;END&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! compute c2r transform</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">decomp_2d_fft_3d</span><span class="p">(</span><span class="nv">cw1</span><span class="p">,</span><span class="nv">rhs</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! rhs is in Z-pencil but requires global operations in X</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">transpose_z_to_y</span><span class="p">(</span><span class="nv">rhs</span><span class="p">,</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">transpose_y_to_x</span><span class="p">(</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">rw1</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">nx</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>             <span class="nv">rw1b</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">rw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>   <span class="c">! the odd terms is setted!</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">nx</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>             <span class="nv">rw1b</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">rw1</span><span class="p">(</span><span class="nv">nx</span><span class="o">-</span><span class="nv">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>  <span class="c">! the even terms is setted</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>       <span class="nv">enddo</span>
</span><span class='line'>    <span class="k">end do</span>
</span><span class='line'><span class="k">    call </span><span class="nv">transpose_x_to_y</span><span class="p">(</span><span class="nv">rw1b</span><span class="p">,</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">transpose_y_to_z</span><span class="p">(</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">rhs</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'><span class="c">!!!!!!!!!!!!!the finally outcome rhs</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">!  call decomp_2d_fft_finalize</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span>
</span><span class='line'><span class="k">  end subroutine </span><span class="nv">poisson_100</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!Neumann!!!!!!!!!!!!!!!!!!!!!!!!!!!111</span>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="c">! Solving 3D Poisson equation: Neumann in Y; periodic in X &amp; Z</span>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="k">subroutine </span><span class="nv">poisson_010</span><span class="p">(</span><span class="nv">rhs</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">implicit none</span>
</span><span class='line'>
</span><span class='line'><span class="k">    </span><span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">intent</span><span class="p">(</span><span class="nv">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">rhs</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">complex</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">xyzk</span>
</span><span class='line'>    <span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">tmp1</span><span class="p">,</span> <span class="nv">tmp2</span><span class="p">,</span> <span class="nv">tmp3</span><span class="p">,</span> <span class="nv">tmp4</span>
</span><span class='line'>    <span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">xx1</span><span class="p">,</span><span class="nv">xx2</span><span class="p">,</span><span class="nv">xx3</span><span class="p">,</span><span class="nv">xx4</span><span class="p">,</span><span class="nv">xx5</span><span class="p">,</span><span class="nv">xx6</span><span class="p">,</span><span class="nv">xx7</span><span class="p">,</span><span class="nv">xx8</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">integer</span> <span class="kd">::</span> <span class="nv">nx</span><span class="p">,</span><span class="nv">ny</span><span class="p">,</span><span class="nv">nz</span><span class="p">,</span> <span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span>
</span><span class='line'>
</span><span class='line'><span class="mi">100</span> <span class="k">format</span><span class="p">(</span><span class="mi">1</span><span class="nv">x</span><span class="p">,</span><span class="nv">a8</span><span class="p">,</span><span class="mi">3</span><span class="nv">I4</span><span class="p">,</span><span class="mi">2</span><span class="nv">F12</span><span class="mf">.6</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">nx</span> <span class="o">=</span> <span class="nv">nx_global</span>
</span><span class='line'>    <span class="nv">ny</span> <span class="o">=</span> <span class="nv">ny_global</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c">! (010)  so have fewer1 ny!</span>
</span><span class='line'>    <span class="nv">nz</span> <span class="o">=</span> <span class="nv">nz_global</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!so if (11*)  you need to ?what pencil??????</span>
</span><span class='line'>    <span class="c">!!!!??</span>
</span><span class='line'>    <span class="c">! rhs is in Z-pencil but requires global operations in Y  because(010)</span>
</span><span class='line'>
</span><span class='line'>                   <span class="c">!!!!!!!!!!!!!!twice real to complex</span>
</span><span class='line'>                     <span class="c">!!!!!!!!!!! 1: transform rhs-rw2-rw1</span>
</span><span class='line'>                     <span class="c">!!!!!!!!!!! 2: fft       rhs-----rw1</span>
</span><span class='line'>                   <span class="c">!!!!!!!!!!!!!!twice complex to real</span>
</span><span class='line'>                     <span class="c">!!!!!!!!!!! 1: transfrom rw1-rw2--rhs</span>
</span><span class='line'>                     <span class="c">!!!!!!!!!!! 2: fft       rw1------rhs</span>
</span><span class='line'>                   <span class="c">!!!!!!!!!!!!! post-processing operations is under the complex condition</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   input real rhs(:.:,:) in the z pencil</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1+1 transform  z-&gt;y y-&gt;z  |destination: modify the rhs  because z-y=1  rather than z-x=2</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 normalisation</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 FFT forward</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   2 post-processing   z--&gt;x  direction not pencil</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 transform z-y</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 post-processing   y</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 poisson solver</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 matrice_refinement</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   3 inversion5_v1  inversion5_v2</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 post-processing backward  Y</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 transform y-z</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   2 post-processing backward  x----&gt;z  direction</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 FFT backward</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1+1 transform    |destination: modify the rhs</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   output real rhs(:,:,:)  in the z pencil</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>                   <span class="c">!!!!!!!!!!!!!!!!!!so the key factor  a  a2  a3    ax bx</span>
</span><span class='line'>                   <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! ay by</span>
</span><span class='line'>                   <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! az bz</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">call </span><span class="nv">transpose_z_to_y</span><span class="p">(</span><span class="nv">rhs</span><span class="p">,</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>             <span class="nv">rw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">rw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">ny</span>
</span><span class='line'>             <span class="nv">rw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">rw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nv">ny</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>       <span class="nv">enddo</span>
</span><span class='line'>    <span class="k">end do</span>
</span><span class='line'><span class="k">    call </span><span class="nv">transpose_y_to_z</span><span class="p">(</span><span class="nv">rw2b</span><span class="p">,</span><span class="nv">rhs</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="ow">.not.</span> <span class="nv">fft_initialised</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       call </span><span class="nv">decomp_2d_fft_init</span><span class="p">(</span><span class="nv">PHYSICAL_IN_Z</span><span class="p">,</span><span class="nv">nx</span><span class="p">,</span><span class="nv">ny</span><span class="p">,</span><span class="nv">nz</span><span class="p">)</span>
</span><span class='line'>       <span class="nv">fft_initialised</span> <span class="o">=</span> <span class="nb">.true.</span>
</span><span class='line'>    <span class="k">end if</span>
</span><span class='line'>    <span class="c">! compute r2c transform</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">decomp_2d_fft_3d</span><span class="p">(</span><span class="nv">rhs</span><span class="p">,</span><span class="nv">cw1</span><span class="p">)</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! normalisation</span>
</span><span class='line'>    <span class="nv">cw1</span> <span class="o">=</span> <span class="nv">cw1</span> <span class="o">/</span> <span class="kt">real</span><span class="p">(</span><span class="nv">nx</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span> <span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">ny</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>         <span class="o">/</span> <span class="kt">real</span><span class="p">(</span><span class="nv">nz</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">                write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;START&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! post-processing in spectral space</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! POST PROCESSING IN Z</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">bz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">+</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">az</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nv">tmp2</span><span class="o">*</span><span class="nv">bz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">-</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">az</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;after z&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! POST PROCESSING IN X</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">+</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nv">tmp2</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">-</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nv">i</span><span class="ow">.gt.</span><span class="p">(</span><span class="nv">nx</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=-</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;after x&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! POST PROCESSING IN Y</span>
</span><span class='line'>    <span class="c">! NEED TO BE IN Y PENCILS!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!sp!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">transpose_x_to_y</span><span class="p">(</span><span class="nv">cw1</span><span class="p">,</span><span class="nv">cw2</span><span class="p">,</span><span class="nv">sp</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!sp!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="nv">ny</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">tmp3</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">-</span><span class="nv">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp4</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">-</span><span class="nv">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">xx1</span><span class="o">=</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx2</span><span class="o">=</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx3</span><span class="o">=</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx4</span><span class="o">=</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx5</span><span class="o">=</span><span class="nv">tmp3</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx6</span><span class="o">=</span><span class="nv">tmp3</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx7</span><span class="o">=</span><span class="nv">tmp4</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx8</span><span class="o">=</span><span class="nv">tmp4</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">xx1</span><span class="o">+</span><span class="nv">xx4</span><span class="o">+</span><span class="nv">xx5</span><span class="o">-</span><span class="nv">xx8</span><span class="p">,</span><span class="o">-</span><span class="nv">xx2</span><span class="o">+</span><span class="nv">xx3</span><span class="o">+</span><span class="nv">xx6</span><span class="o">+</span><span class="nv">xx7</span><span class="p">,</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>          <span class="k">end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">                write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;after y&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>                <span class="k">print</span> <span class="o">*</span><span class="p">,</span><span class="nv">kxyz</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'>
</span><span class='line'><span class="k">    if</span> <span class="p">(</span><span class="nv">istret</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! Solve Poisson</span>
</span><span class='line'>    <span class="c">! doing wave number division in Y-pencil</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="c">!tmp1=real(zk2(k)+yk2(j)+xk2(i), kind=mytype)</span>
</span><span class='line'>             <span class="c">!tmp2=aimag(zk2(k)+yk2(j)+xk2(i))</span>
</span><span class='line'>             <span class="nv">tmp1</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="nv">kxyz</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span><span class="o">=</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">kxyz</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="c">!xyzk=cmplx(tmp1,tmp2, kind=mytype)</span>
</span><span class='line'>             <span class="c">!CANNOT DO A DIVISION BY ZERO</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp1</span><span class="p">)</span><span class="ow">.lt.</span><span class="nb">epsilon</span><span class="p">)</span><span class="ow">.and.</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp2</span><span class="p">)</span><span class="ow">.lt.</span><span class="nb">epsilon</span><span class="p">))</span> <span class="k">then    </span>
</span><span class='line'><span class="k">                </span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="mf">0.</span><span class="err">_</span><span class="nv">mytype</span><span class="p">,</span><span class="mf">0.</span><span class="err">_</span><span class="nv">mytype</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">             if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp1</span><span class="p">)</span><span class="ow">.lt.</span><span class="nb">epsilon</span><span class="p">)</span><span class="ow">.and.</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp2</span><span class="p">)</span><span class="ow">.ge.</span><span class="nb">epsilon</span><span class="p">))</span> <span class="k">then</span>
</span><span class='line'><span class="k">                </span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="mf">0.</span><span class="err">_</span><span class="nv">mytype</span><span class="p">,</span> <span class="p">&amp;</span>
</span><span class='line'>                     <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="nv">tmp2</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">             if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp1</span><span class="p">)</span><span class="ow">.ge.</span><span class="nb">epsilon</span><span class="p">)</span><span class="ow">.and.</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp2</span><span class="p">)</span><span class="ow">.lt.</span><span class="nb">epsilon</span><span class="p">))</span> <span class="k">then    </span>
</span><span class='line'><span class="k">                </span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>                     <span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="nv">tmp1</span><span class="p">),</span> <span class="mf">0.</span><span class="err">_</span><span class="nv">mytype</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">             if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp1</span><span class="p">)</span><span class="ow">.ge.</span><span class="nb">epsilon</span><span class="p">)</span><span class="ow">.and.</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp2</span><span class="p">)</span><span class="ow">.ge.</span><span class="nb">epsilon</span><span class="p">))</span> <span class="k">then</span>
</span><span class='line'><span class="k">                </span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>                     <span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="nv">tmp1</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                     <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="nv">tmp2</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>
</span><span class='line'><span class="k">    else</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>       <span class="k">call </span><span class="nv">matrice_refinement</span><span class="p">()</span>
</span><span class='line'>        <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'><span class="c">!       do k = sp%yst(3), sp%yen(3)</span>
</span><span class='line'><span class="c">!          do j = 1,ny/2</span>
</span><span class='line'><span class="c">!             do i = sp%yst(1), sp%yen(1)</span>
</span><span class='line'><span class="c">!                print *,i,j,k,a(i,j,k,3)</span>
</span><span class='line'><span class="c">!!                if (nrank.le.1) print *,i,j,k,a(i,j,k,3)</span>
</span><span class='line'><span class="c">!!                if (nrank.gt.1) print *,i+4,j,k,a(i,j,k,3)</span>
</span><span class='line'><span class="c">!             enddo</span>
</span><span class='line'><span class="c">!          enddo</span>
</span><span class='line'><span class="c">!       enddo</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!istret  !=3</span>
</span><span class='line'><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>       <span class="k">if</span> <span class="p">(</span><span class="nv">istret</span><span class="ow">.ne.</span><span class="mi">3</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">          </span><span class="nv">cw2</span><span class="p">(:,:,:)</span><span class="o">=</span><span class="mf">0.</span><span class="p">;</span><span class="nv">cw2c</span><span class="p">(:,:,:)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">cw2c</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>
</span><span class='line'> <span class="c">!   do k = sp%yst(3), sp%yen(3)</span>
</span><span class='line'> <span class="c">!      do j = 1,ny/2</span>
</span><span class='line'> <span class="c">!         do i = sp%yst(1), sp%yen(1)</span>
</span><span class='line'> <span class="c">!            if (abs(cw2(i,j,k)) &gt; 1.0e-4) then</span>
</span><span class='line'> <span class="c">!               write(*,*) &#39;before IN&#39;,i,j,k,cw2(i,j,k)!*2.</span>
</span><span class='line'> <span class="c">!!            end if</span>
</span><span class='line'>  <span class="c">!        end do</span>
</span><span class='line'>  <span class="c">!     end do</span>
</span><span class='line'>  <span class="c">!  end do</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!for the strech  grid!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>         <span class="k">call </span><span class="nv">inversion5_v1</span><span class="p">(</span><span class="nv">a</span><span class="p">,</span><span class="nv">cw2</span><span class="p">,</span><span class="nv">sp</span><span class="p">)</span>
</span><span class='line'>         <span class="k">call </span><span class="nv">inversion5_v1</span><span class="p">(</span><span class="nv">a2</span><span class="p">,</span><span class="nv">cw2c</span><span class="p">,</span><span class="nv">sp</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c">!         cw2(1,1,1)=cw2(1,1,1)*0.5</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c">!   do k = sp%yst(3), sp%yen(3)</span>
</span><span class='line'><span class="c">!       do j = 1,ny/2</span>
</span><span class='line'><span class="c">!          do i = sp%yst(1), sp%yen(1)</span>
</span><span class='line'><span class="c">!             if (abs(cw2c(i,j,k)) &gt; 1.0e-4) then</span>
</span><span class='line'><span class="c">!                write(*,*) &#39;after IN&#39;,i,j,k,cw2c(i,j,k)!*2.</span>
</span><span class='line'><span class="c">!             end if</span>
</span><span class='line'><span class="c">!          end do</span>
</span><span class='line'><span class="c">!       end do</span>
</span><span class='line'><span class="c">!    end do</span>
</span><span class='line'>
</span><span class='line'>          <span class="nv">cw2b</span><span class="p">(:,:,:)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,(</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="nv">ny</span><span class="p">,</span><span class="mi">2</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw2c</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="c">!do k=sp%yst(3), sp%yen(3)</span>
</span><span class='line'>          <span class="c">!do i=sp%yst(1), sp%yen(1)</span>
</span><span class='line'>          <span class="c">!   if ((xkx(i)==0).and.(zkz(k)==0)) then</span>
</span><span class='line'>          <span class="c">!   !   cw2b(i,1,1)=0.</span>
</span><span class='line'>          <span class="c">!   !   cw2b(i,ny,1)=0.</span>
</span><span class='line'>          <span class="c">!   endif</span>
</span><span class='line'>          <span class="c">!enddo</span>
</span><span class='line'>          <span class="c">!enddo</span>
</span><span class='line'>       <span class="k">else</span>
</span><span class='line'><span class="k">          do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="nv">ny</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="k">call </span><span class="nv">inversion5_v2</span><span class="p">(</span><span class="nv">a3</span><span class="p">,</span><span class="nv">cw2</span><span class="p">,</span><span class="nv">sp</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="nv">ny</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>       <span class="k">endif</span>
</span><span class='line'>
</span><span class='line'><span class="k">    endif</span>
</span><span class='line'>
</span><span class='line'><span class="c">!    print *,nrank, sp%yst(3),sp%yen(3),sp%yst(1),sp%yen(1)</span>
</span><span class='line'>
</span><span class='line'><span class="c">!we are in Y pencil</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>       <span class="k">if</span> <span class="p">((</span><span class="nv">i</span><span class="o">==</span><span class="nv">nx</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="ow">.and.</span><span class="p">(</span><span class="nv">k</span><span class="o">==</span><span class="nv">nz</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="k">then</span>
</span><span class='line'><span class="k">          </span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,:,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>       <span class="k">endif</span>
</span><span class='line'><span class="k">    </span><span class="nv">enddo</span>
</span><span class='line'>    <span class="nv">enddo</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">                write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;AFTER&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>                <span class="k">print</span> <span class="o">*</span><span class="p">,</span><span class="nv">kxyz</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! post-processing backward</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! POST PROCESSING IN Y</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="nv">ny</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">tmp3</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">-</span><span class="nv">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp4</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">-</span><span class="nv">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">xx1</span><span class="o">=</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx2</span><span class="o">=</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx3</span><span class="o">=</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx4</span><span class="o">=</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx5</span><span class="o">=</span><span class="nv">tmp3</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx6</span><span class="o">=</span><span class="nv">tmp3</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx7</span><span class="o">=</span><span class="nv">tmp4</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx8</span><span class="o">=</span><span class="nv">tmp4</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">xx1</span><span class="o">-</span><span class="nv">xx4</span><span class="o">+</span><span class="nv">xx6</span><span class="o">+</span><span class="nv">xx7</span><span class="p">,</span><span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="nv">xx2</span><span class="o">-</span><span class="nv">xx3</span><span class="o">+</span><span class="nv">xx5</span><span class="o">-</span><span class="nv">xx8</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>          <span class="k">end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! Back to X-pencil</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">transpose_y_to_x</span><span class="p">(</span><span class="nv">cw2</span><span class="p">,</span><span class="nv">cw1</span><span class="p">,</span><span class="nv">sp</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">                write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;AFTER Y&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! POST PROCESSING IN X</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">-</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nv">tmp2</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">+</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nv">i</span><span class="ow">.gt.</span><span class="p">(</span><span class="nv">nx</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=-</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;AFTER X&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! POST PROCESSING IN Z</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">bz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">-</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">az</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nv">tmp2</span><span class="o">*</span><span class="nv">bz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">+</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">az</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;END&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! compute c2r transform, back to physical space</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">call </span><span class="nv">decomp_2d_fft_3d</span><span class="p">(</span><span class="nv">cw1</span><span class="p">,</span><span class="nv">rhs</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! rhs is in Z-pencil but requires global operations in Y</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">transpose_z_to_y</span><span class="p">(</span><span class="nv">rhs</span><span class="p">,</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>             <span class="nv">rw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">rw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>             <span class="nv">rw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">rw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">-</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>       <span class="nv">enddo</span>
</span><span class='line'>    <span class="k">end do</span>
</span><span class='line'><span class="k">    call </span><span class="nv">transpose_y_to_z</span><span class="p">(</span><span class="nv">rw2b</span><span class="p">,</span><span class="nv">rhs</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">!  call decomp_2d_fft_finalize</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span>
</span><span class='line'><span class="k">  end subroutine </span><span class="nv">poisson_010</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!Neumann!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!11x!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!Neumann Neumann Neumann!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!Neumann Neumann periodic!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="c">! Solving 3D Poisson equation: Neumann in X, Y; Neumann/periodic in Z</span>
</span><span class='line'>  <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>  <span class="k">subroutine </span><span class="nv">poisson_11x</span><span class="p">(</span><span class="nv">rhs</span><span class="p">,</span> <span class="nv">nclz1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>                   <span class="c">!!!!!!!!!!!!!!twice real to complex</span>
</span><span class='line'>                     <span class="c">!!!!!!!!!!! 1: transform rhs-rw2-rw1</span>
</span><span class='line'>                     <span class="c">!!!!!!!!!!! 2: fft       rhs-----rw1</span>
</span><span class='line'>                   <span class="c">!!!!!!!!!!!!!!twice complex to real</span>
</span><span class='line'>                     <span class="c">!!!!!!!!!!! 1: transfrom rw1-rw2--rhs</span>
</span><span class='line'>                     <span class="c">!!!!!!!!!!! 2: fft       rw1------rhs</span>
</span><span class='line'>                   <span class="c">!!!!!!!!!!!!! post-processing operations is under the complex condition</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   input real rhs(:.:,:) in the z pencil</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   2+2 transform    z--y  y-&gt;x   x-y y-z|destination: modify the rhs</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 normalisation</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 FFT forward</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 post-processing  z</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 transpose  x--y</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 post-processing  y</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 transpose  y--x</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 post-processing  x (because  he thinks he is in X pencil, Zhaoliang said no)</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 poisson solver</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 matrice_refinemento</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 transpse   x--y  (for strecting  because strecthing is in the y direction)</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 inversion5_v1</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 transpose  y---x</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!  </span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 post-processing x</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 transpose  x-y</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 post-processing y</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 transpose  y-x</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 post-processing z</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   1 FFT backward</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   2+2 transform    |destination: modify the rhs</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!   output real rhs(:,:,:)  in the z pencil</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="k">implicit none</span>
</span><span class='line'>
</span><span class='line'><span class="k">    </span><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">nclz1</span>
</span><span class='line'>    <span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">intent</span><span class="p">(</span><span class="nv">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">rhs</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">complex</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">xyzk</span>
</span><span class='line'>    <span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">tmp1</span><span class="p">,</span> <span class="nv">tmp2</span><span class="p">,</span> <span class="nv">tmp3</span><span class="p">,</span> <span class="nv">tmp4</span>
</span><span class='line'>    <span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">xx1</span><span class="p">,</span><span class="nv">xx2</span><span class="p">,</span><span class="nv">xx3</span><span class="p">,</span><span class="nv">xx4</span><span class="p">,</span><span class="nv">xx5</span><span class="p">,</span><span class="nv">xx6</span><span class="p">,</span><span class="nv">xx7</span><span class="p">,</span><span class="nv">xx8</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">integer</span> <span class="kd">::</span> <span class="nv">nx</span><span class="p">,</span><span class="nv">ny</span><span class="p">,</span><span class="nv">nz</span><span class="p">,</span> <span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span>
</span><span class='line'>
</span><span class='line'><span class="mi">100</span> <span class="k">format</span><span class="p">(</span><span class="mi">1</span><span class="nv">x</span><span class="p">,</span><span class="nv">a8</span><span class="p">,</span><span class="mi">3</span><span class="nv">I4</span><span class="p">,</span><span class="mi">2</span><span class="nv">F12</span><span class="mf">.6</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">nx</span> <span class="o">=</span> <span class="nv">nx_global</span> <span class="o">-</span> <span class="mi">1</span>   <span class="c">! becasuse (110)</span>
</span><span class='line'>    <span class="nv">ny</span> <span class="o">=</span> <span class="nv">ny_global</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nv">nclz1</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>     <span class="c">!!!!!the free-slip boundary condition</span>
</span><span class='line'>       <span class="nv">nz</span> <span class="o">=</span> <span class="nv">nz_global</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">else if</span> <span class="p">(</span><span class="nv">nclz1</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       </span><span class="nv">nz</span> <span class="o">=</span> <span class="nv">nz_global</span>
</span><span class='line'>    <span class="k">end if</span>
</span><span class='line'><span class="k">   </span>
</span><span class='line'><span class="k">    if</span> <span class="p">(</span><span class="nv">nclz1</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then  </span>
</span><span class='line'><span class="k">       do </span><span class="nv">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">ph</span><span class="p">%</span><span class="nv">zsz</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">ph</span><span class="p">%</span><span class="nv">zsz</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">nz</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>                <span class="nv">rw3</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">rhs</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nv">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end do</span>
</span><span class='line'><span class="k">             do </span><span class="nv">k</span><span class="o">=</span><span class="nv">nz</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">nz</span>
</span><span class='line'>                <span class="nv">rw3</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">rhs</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nv">nz</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nv">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end do</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">       call </span><span class="nv">transpose_z_to_y</span><span class="p">(</span><span class="nv">rw3</span><span class="p">,</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>    <span class="k">else if</span> <span class="p">(</span><span class="nv">nclz1</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then     </span>
</span><span class='line'><span class="k">       call </span><span class="nv">transpose_z_to_y</span><span class="p">(</span><span class="nv">rhs</span><span class="p">,</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end if</span>
</span><span class='line'><span class="k">    </span>
</span><span class='line'>
</span><span class='line'><span class="k">    do </span><span class="nv">k</span><span class="o">=</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>             <span class="nv">rw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">rw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="k">end do</span>
</span><span class='line'><span class="k">          do </span><span class="nv">j</span><span class="o">=</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">ny</span>
</span><span class='line'>             <span class="nv">rw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">rw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nv">ny</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="k">end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! the global operations in X</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">transpose_y_to_x</span><span class="p">(</span><span class="nv">rw2b</span><span class="p">,</span><span class="nv">rw1</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">nx</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>             <span class="nv">rw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">rw1</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nv">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="k">end do</span>
</span><span class='line'><span class="k">          do </span><span class="nv">i</span><span class="o">=</span><span class="nv">nx</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">nx</span>
</span><span class='line'>             <span class="nv">rw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">rw1</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">nx</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nv">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="k">end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! back to Z-pencil</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">transpose_x_to_y</span><span class="p">(</span><span class="nv">rw1b</span><span class="p">,</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">transpose_y_to_z</span><span class="p">(</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">rhs</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="ow">.not.</span> <span class="nv">fft_initialised</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       call </span><span class="nv">decomp_2d_fft_init</span><span class="p">(</span><span class="nv">PHYSICAL_IN_Z</span><span class="p">,</span><span class="nv">nx</span><span class="p">,</span><span class="nv">ny</span><span class="p">,</span><span class="nv">nz</span><span class="p">)</span>
</span><span class='line'>       <span class="nv">fft_initialised</span> <span class="o">=</span> <span class="nb">.true.</span>
</span><span class='line'>    <span class="k">end if</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! compute r2c transform</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">call </span><span class="nv">decomp_2d_fft_3d</span><span class="p">(</span><span class="nv">rhs</span><span class="p">,</span><span class="nv">cw1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="c">! normalisation</span>
</span><span class='line'>    <span class="nv">cw1</span> <span class="o">=</span> <span class="nv">cw1</span> <span class="o">/</span> <span class="kt">real</span><span class="p">(</span><span class="nv">nx</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span> <span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">ny</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>         <span class="o">/</span> <span class="kt">real</span><span class="p">(</span><span class="nv">nz</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">                write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;START&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! post-processing in spectral space</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! POST PROCESSING IN Z</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">bz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">+</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">az</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nv">tmp2</span><span class="o">*</span><span class="nv">bz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">-</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">az</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;after z&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!while  1  should be in the corresponding pencils</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!characteristic 2 : there sholud be tmp1*2*3*4</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! POST PROCESSING IN Y</span>
</span><span class='line'>    <span class="c">! WE HAVE TO BE IN Y PENCILS</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!No  we should be the z pencil!  </span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!there is something wrong in the source code!!!!!!!!!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!But now we are in the z pencil not in</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!  the x pencil!</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!so,it should be</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!call transpose_z_to_y rather than transpose_x_to_y</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">transpose_x_to_y</span><span class="p">(</span><span class="nv">cw1</span><span class="p">,</span><span class="nv">cw2</span><span class="p">,</span><span class="nv">sp</span><span class="p">)</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="nv">ny</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">tmp3</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">-</span><span class="nv">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp4</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">-</span><span class="nv">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">xx1</span><span class="o">=</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx2</span><span class="o">=</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx3</span><span class="o">=</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx4</span><span class="o">=</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx5</span><span class="o">=</span><span class="nv">tmp3</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx6</span><span class="o">=</span><span class="nv">tmp3</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx7</span><span class="o">=</span><span class="nv">tmp4</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx8</span><span class="o">=</span><span class="nv">tmp4</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">xx1</span><span class="o">+</span><span class="nv">xx4</span><span class="o">+</span><span class="nv">xx5</span><span class="o">-</span><span class="nv">xx8</span><span class="p">,</span><span class="o">-</span><span class="nv">xx2</span><span class="o">+</span><span class="nv">xx3</span><span class="o">+</span><span class="nv">xx6</span><span class="o">+</span><span class="nv">xx7</span><span class="p">,</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>          <span class="k">end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! back to X-pencil</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!the same wrong ,now you should</span>
</span><span class='line'>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!go back to the z pencil rather than the x pencil</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">transpose_y_to_x</span><span class="p">(</span><span class="nv">cw2b</span><span class="p">,</span><span class="nv">cw1</span><span class="p">,</span><span class="nv">sp</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">                write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;after y&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! POST PROCESSING IN X</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">cw1b</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="nv">nx</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">tmp3</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">nx</span><span class="o">-</span><span class="nv">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp4</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">nx</span><span class="o">-</span><span class="nv">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">xx1</span><span class="o">=</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx2</span><span class="o">=</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx3</span><span class="o">=</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx4</span><span class="o">=</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx5</span><span class="o">=</span><span class="nv">tmp3</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx6</span><span class="o">=</span><span class="nv">tmp3</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx7</span><span class="o">=</span><span class="nv">tmp4</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">xx8</span><span class="o">=</span><span class="nv">tmp4</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="err">_</span><span class="nv">mytype</span>
</span><span class='line'>             <span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">xx1</span><span class="o">+</span><span class="nv">xx4</span><span class="o">+</span><span class="nv">xx5</span><span class="o">-</span><span class="nv">xx8</span><span class="p">,</span><span class="o">-</span><span class="nv">xx2</span><span class="o">+</span><span class="nv">xx3</span><span class="o">+</span><span class="nv">xx6</span><span class="o">+</span><span class="nv">xx7</span><span class="p">,</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>          <span class="k">end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">                write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;BEFORE&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'>
</span><span class='line'><span class="k">    if</span> <span class="p">(</span><span class="nv">istret</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! Solve Poisson</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="c">!tmp1=real(zk2(k)+yk2(j)+xk2(i), kind=mytype)</span>
</span><span class='line'>             <span class="c">!tmp2=aimag(zk2(k)+yk2(j)+xk2(i))</span>
</span><span class='line'>             <span class="nv">tmp1</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="nv">kxyz</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span><span class="o">=</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">kxyz</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="c">!xyzk=cmplx(tmp1,tmp2, kind=mytype)</span>
</span><span class='line'>             <span class="c">!CANNOT DO A DIVISION BY ZERO</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp1</span><span class="p">)</span><span class="ow">.lt.</span><span class="nb">epsilon</span><span class="p">)</span><span class="ow">.and.</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp2</span><span class="p">)</span><span class="ow">.lt.</span><span class="nb">epsilon</span><span class="p">))</span> <span class="k">then    </span>
</span><span class='line'><span class="k">                </span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="mf">0.</span><span class="err">_</span><span class="nv">mytype</span><span class="p">,</span><span class="mf">0.</span><span class="err">_</span><span class="nv">mytype</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">             if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp1</span><span class="p">)</span><span class="ow">.lt.</span><span class="nb">epsilon</span><span class="p">)</span><span class="ow">.and.</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp2</span><span class="p">)</span><span class="ow">.ge.</span><span class="nb">epsilon</span><span class="p">))</span> <span class="k">then</span>
</span><span class='line'><span class="k">                </span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="mf">0.</span><span class="err">_</span><span class="nv">mytype</span><span class="p">,</span> <span class="p">&amp;</span>
</span><span class='line'>                     <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="nv">tmp2</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">             if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp1</span><span class="p">)</span><span class="ow">.ge.</span><span class="nb">epsilon</span><span class="p">)</span><span class="ow">.and.</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp2</span><span class="p">)</span><span class="ow">.lt.</span><span class="nb">epsilon</span><span class="p">))</span> <span class="k">then    </span>
</span><span class='line'><span class="k">                </span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>                     <span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="nv">tmp1</span><span class="p">),</span> <span class="mf">0.</span><span class="err">_</span><span class="nv">mytype</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">             if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp1</span><span class="p">)</span><span class="ow">.ge.</span><span class="nb">epsilon</span><span class="p">)</span><span class="ow">.and.</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">tmp2</span><span class="p">)</span><span class="ow">.ge.</span><span class="nb">epsilon</span><span class="p">))</span> <span class="k">then</span>
</span><span class='line'><span class="k">                </span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>                     <span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="nv">tmp1</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                     <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="nv">tmp2</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>
</span><span class='line'><span class="k">    else</span>
</span><span class='line'><span class="k">       call </span><span class="nv">matrice_refinement</span><span class="p">()</span>
</span><span class='line'>       <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!11so       we  should  z-&gt;y pencil but not  x-&gt;ypencil</span>
</span><span class='line'><span class="c">! the stretching is only working in Y pencils</span>
</span><span class='line'>
</span><span class='line'><span class="c">!!!!!!!!!!!!!!!why the default the pencil is  x pencil rather than z pencil!!!</span>
</span><span class='line'>       <span class="k">call </span><span class="nv">transpose_x_to_y</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">,</span><span class="nv">cw2b</span><span class="p">,</span><span class="nv">sp</span><span class="p">)</span>
</span><span class='line'>       <span class="c">!we are now in Y pencil</span>
</span><span class='line'>
</span><span class='line'>       <span class="k">if</span> <span class="p">(</span><span class="nv">istret</span><span class="ow">.ne.</span><span class="mi">3</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">          </span><span class="nv">cw2</span><span class="p">(:,:,:)</span><span class="o">=</span><span class="mf">0.</span><span class="p">;</span><span class="nv">cw2c</span><span class="p">(:,:,:)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">cw2c</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="k">call </span><span class="nv">inversion5_v1</span><span class="p">(</span><span class="nv">a</span><span class="p">,</span><span class="nv">cw2</span><span class="p">,</span><span class="nv">sp</span><span class="p">)</span>
</span><span class='line'>          <span class="k">call </span><span class="nv">inversion5_v1</span><span class="p">(</span><span class="nv">a2</span><span class="p">,</span><span class="nv">cw2c</span><span class="p">,</span><span class="nv">sp</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>          <span class="nv">cw2b</span><span class="p">(:,:,:)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,(</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="nv">ny</span><span class="p">,</span><span class="mi">2</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw2c</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>       <span class="k">else</span>
</span><span class='line'><span class="k">          </span><span class="nv">cw2</span><span class="p">(:,:,:)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">call </span><span class="nv">inversion5_v2</span><span class="p">(</span><span class="nv">a3</span><span class="p">,</span><span class="nv">cw2</span><span class="p">,</span><span class="nv">sp</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>       <span class="k">endif</span>
</span><span class='line'><span class="c">!we have to go back in X pencils</span>
</span><span class='line'>       <span class="k">call </span><span class="nv">transpose_y_to_x</span><span class="p">(</span><span class="nv">cw2b</span><span class="p">,</span><span class="nv">cw1b</span><span class="p">,</span><span class="nv">sp</span><span class="p">)</span>
</span><span class='line'>    <span class="k">endif</span>
</span><span class='line'>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-6</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">                write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;AFTER&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'><span class="c">!stop</span>
</span><span class='line'>    <span class="c">! post-processing backward</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">cw1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw1b</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="nv">nx</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">tmp3</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">nx</span><span class="o">-</span><span class="nv">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp4</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1b</span><span class="p">(</span><span class="nv">nx</span><span class="o">-</span><span class="nv">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">xx1</span><span class="o">=</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx2</span><span class="o">=</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx3</span><span class="o">=</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx4</span><span class="o">=</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx5</span><span class="o">=</span><span class="nv">tmp3</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx6</span><span class="o">=</span><span class="nv">tmp3</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx7</span><span class="o">=</span><span class="nv">tmp4</span><span class="o">*</span><span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx8</span><span class="o">=</span><span class="nv">tmp4</span><span class="o">*</span><span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">xx1</span><span class="o">-</span><span class="nv">xx4</span><span class="o">+</span><span class="nv">xx6</span><span class="o">+</span><span class="nv">xx7</span><span class="p">,</span><span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="nv">xx2</span><span class="o">-</span><span class="nv">xx3</span><span class="o">+</span><span class="nv">xx5</span><span class="o">-</span><span class="nv">xx8</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>          <span class="k">end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">                write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;AFTER X&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! POST PROCESSING IN Y</span>
</span><span class='line'>    <span class="c">! NEED to be in Y-pencil</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">transpose_x_to_y</span><span class="p">(</span><span class="nv">cw1</span><span class="p">,</span><span class="nv">cw2</span><span class="p">,</span><span class="nv">sp</span><span class="p">)</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="nv">ny</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">tmp3</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">-</span><span class="nv">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp4</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">-</span><span class="nv">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">xx1</span><span class="o">=</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx2</span><span class="o">=</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx3</span><span class="o">=</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx4</span><span class="o">=</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx5</span><span class="o">=</span><span class="nv">tmp3</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx6</span><span class="o">=</span><span class="nv">tmp3</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx7</span><span class="o">=</span><span class="nv">tmp4</span><span class="o">*</span><span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">xx8</span><span class="o">=</span><span class="nv">tmp4</span><span class="o">*</span><span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">xx1</span><span class="o">-</span><span class="nv">xx4</span><span class="o">+</span><span class="nv">xx6</span><span class="o">+</span><span class="nv">xx7</span><span class="p">,</span><span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="nv">xx2</span><span class="o">-</span><span class="nv">xx3</span><span class="o">+</span><span class="nv">xx5</span><span class="o">-</span><span class="nv">xx8</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>          <span class="k">end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">                write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;AFTER Y&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end if</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'>    <span class="c">! back to X-pencil</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">transpose_y_to_x</span><span class="p">(</span><span class="nv">cw2b</span><span class="p">,</span><span class="nv">cw1</span><span class="p">,</span><span class="nv">sp</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! POST PROCESSING IN Z</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp1</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>             <span class="nv">tmp2</span> <span class="o">=</span> <span class="nb">aimag</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span>
</span><span class='line'>             <span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">bz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">-</span><span class="nv">tmp2</span><span class="o">*</span><span class="nv">az</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="nv">tmp2</span><span class="o">*</span><span class="nv">bz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">+</span><span class="nv">tmp1</span><span class="o">*</span><span class="nv">az</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="nv">ifdef</span> <span class="nv">DEBUG</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.0e-4</span><span class="p">)</span> <span class="p">&amp;</span>
</span><span class='line'>                  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="s1">&#39;END&#39;</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">cw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'><span class="err">#</span><span class="k">endif</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">    end do</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">! compute c2r transform, back to physical space</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">decomp_2d_fft_3d</span><span class="p">(</span><span class="nv">cw1</span><span class="p">,</span><span class="nv">rhs</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nv">nclz1</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       do </span><span class="nv">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">ph</span><span class="p">%</span><span class="nv">zsz</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">ph</span><span class="p">%</span><span class="nv">zsz</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">nz</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>                <span class="nv">rw3</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nv">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="nv">rhs</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end do</span>
</span><span class='line'><span class="k">             do </span><span class="nv">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">nz</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>                <span class="nv">rw3</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">rhs</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">nz</span><span class="o">-</span><span class="nv">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>             <span class="k">end do</span>
</span><span class='line'><span class="k">          end do</span>
</span><span class='line'><span class="k">       end do</span>
</span><span class='line'><span class="k">       call </span><span class="nv">transpose_z_to_y</span><span class="p">(</span><span class="nv">rw3</span><span class="p">,</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>    <span class="k">else if</span> <span class="p">(</span><span class="nv">nclz1</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       call </span><span class="nv">transpose_z_to_y</span><span class="p">(</span><span class="nv">rhs</span><span class="p">,</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end if</span>
</span><span class='line'><span class="k">    </span>
</span><span class='line'><span class="k">    do </span><span class="nv">k</span><span class="o">=</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>             <span class="nv">rw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">rw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="k">end do</span>
</span><span class='line'><span class="k">          do </span><span class="nv">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>             <span class="nv">rw2b</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">rw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">-</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="k">end do</span>
</span><span class='line'><span class="k">       </span><span class="nv">enddo</span>
</span><span class='line'>    <span class="k">end do</span>
</span><span class='line'><span class="k">    call </span><span class="nv">transpose_y_to_x</span><span class="p">(</span><span class="nv">rw2b</span><span class="p">,</span><span class="nv">rw1</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>    <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>       <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">ph</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">nx</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>             <span class="nv">rw1b</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">rw1</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>          <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">nx</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>             <span class="nv">rw1b</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">rw1</span><span class="p">(</span><span class="nv">nx</span><span class="o">-</span><span class="nv">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">enddo</span>
</span><span class='line'>       <span class="nv">enddo</span>
</span><span class='line'>    <span class="k">end do</span>
</span><span class='line'><span class="k">    call </span><span class="nv">transpose_x_to_y</span><span class="p">(</span><span class="nv">rw1b</span><span class="p">,</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>    <span class="k">call </span><span class="nv">transpose_y_to_z</span><span class="p">(</span><span class="nv">rw2</span><span class="p">,</span><span class="nv">rhs</span><span class="p">,</span><span class="nv">ph</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">!  call decomp_2d_fft_finalize</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span>
</span><span class='line'><span class="k">  end subroutine </span><span class="nv">poisson_11x</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="k">subroutine </span><span class="nv">abxyz</span><span class="p">(</span><span class="nv">ax</span><span class="p">,</span><span class="nv">ay</span><span class="p">,</span><span class="nv">az</span><span class="p">,</span><span class="nv">bx</span><span class="p">,</span><span class="nv">by</span><span class="p">,</span><span class="nv">bz</span><span class="p">,</span><span class="nv">nx</span><span class="p">,</span><span class="nv">ny</span><span class="p">,</span><span class="nv">nz</span><span class="p">,</span><span class="nv">bcx</span><span class="p">,</span><span class="nv">bcy</span><span class="p">,</span><span class="nv">bcz</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">use </span><span class="nv">param</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">implicit none</span>
</span><span class='line'>
</span><span class='line'><span class="k">    </span><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">nx</span><span class="p">,</span><span class="nv">ny</span><span class="p">,</span><span class="nv">nz</span>
</span><span class='line'>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">bcx</span><span class="p">,</span><span class="nv">bcy</span><span class="p">,</span><span class="nv">bcz</span>
</span><span class='line'>    <span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">intent</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">ax</span><span class="p">,</span><span class="nv">bx</span>
</span><span class='line'>    <span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">intent</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">ay</span><span class="p">,</span><span class="nv">by</span>
</span><span class='line'>    <span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">intent</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">az</span><span class="p">,</span><span class="nv">bz</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">integer</span> <span class="kd">::</span> <span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nv">bcx</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       do </span><span class="nv">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">nx</span>
</span><span class='line'>           <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>           <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>           <span class="c">!!!!!!!!!!!!!! generate the x direction coeficiency!!!!!!!!!!!</span>
</span><span class='line'>           <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>           <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'>          <span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sin</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">PI</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">nx</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))</span>
</span><span class='line'>          <span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">PI</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">nx</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))</span>
</span><span class='line'>       <span class="k">end do</span>
</span><span class='line'><span class="k">    else if</span> <span class="p">(</span><span class="nv">bcx</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       do </span><span class="nv">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">nx</span>
</span><span class='line'>           <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!one and a half of PI</span>
</span><span class='line'>          <span class="nv">ax</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sin</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">PI</span><span class="o">/</span><span class="mf">2.0</span><span class="err">_</span><span class="nv">mytype</span><span class="o">/</span> <span class="p">&amp;</span>
</span><span class='line'>               <span class="kt">real</span><span class="p">(</span><span class="nv">nx</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))</span>
</span><span class='line'>          <span class="nv">bx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">PI</span><span class="o">/</span><span class="mf">2.0</span><span class="err">_</span><span class="nv">mytype</span><span class="o">/</span> <span class="p">&amp;</span>
</span><span class='line'>               <span class="kt">real</span><span class="p">(</span><span class="nv">nx</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))</span>
</span><span class='line'>       <span class="k">end do</span>
</span><span class='line'><span class="k">    end if</span>
</span><span class='line'>
</span><span class='line'><span class="k">    if</span> <span class="p">(</span><span class="nv">bcy</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       do </span><span class="nv">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">ny</span>
</span><span class='line'>          <span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sin</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">PI</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">ny</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))</span>
</span><span class='line'>          <span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">PI</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">ny</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))</span>
</span><span class='line'>       <span class="k">end do</span>
</span><span class='line'><span class="k">    else if</span> <span class="p">(</span><span class="nv">bcy</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       do </span><span class="nv">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">ny</span>
</span><span class='line'>          <span class="nv">ay</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sin</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">PI</span><span class="o">/</span><span class="mf">2.0</span><span class="err">_</span><span class="nv">mytype</span><span class="o">/</span> <span class="p">&amp;</span>
</span><span class='line'>               <span class="kt">real</span><span class="p">(</span><span class="nv">ny</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))</span>
</span><span class='line'>          <span class="nv">by</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">PI</span><span class="o">/</span><span class="mf">2.0</span><span class="err">_</span><span class="nv">mytype</span><span class="o">/</span> <span class="p">&amp;</span>
</span><span class='line'>               <span class="kt">real</span><span class="p">(</span><span class="nv">ny</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))</span>
</span><span class='line'>       <span class="k">end do</span>
</span><span class='line'><span class="k">    end if</span>
</span><span class='line'>
</span><span class='line'><span class="k">    if</span> <span class="p">(</span><span class="nv">bcz</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       do </span><span class="nv">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">nz</span>
</span><span class='line'>          <span class="nv">az</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sin</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">PI</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">nz</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))</span>
</span><span class='line'>          <span class="nv">bz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">PI</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">nz</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))</span>
</span><span class='line'>       <span class="k">end do</span>
</span><span class='line'><span class="k">    else if</span> <span class="p">(</span><span class="nv">bcz</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">       do </span><span class="nv">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">nz</span>
</span><span class='line'>          <span class="nv">az</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sin</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">PI</span><span class="o">/</span><span class="mf">2.0</span><span class="err">_</span><span class="nv">mytype</span><span class="o">/</span> <span class="p">&amp;</span>
</span><span class='line'>               <span class="kt">real</span><span class="p">(</span><span class="nv">nz</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))</span>
</span><span class='line'>          <span class="nv">bz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">PI</span><span class="o">/</span><span class="mf">2.0</span><span class="err">_</span><span class="nv">mytype</span><span class="o">/</span> <span class="p">&amp;</span>
</span><span class='line'>               <span class="kt">real</span><span class="p">(</span><span class="nv">nz</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))</span>
</span><span class='line'>       <span class="k">end do</span>
</span><span class='line'><span class="k">    end if</span>
</span><span class='line'>
</span><span class='line'><span class="k">    return</span>
</span><span class='line'><span class="k">  end subroutine </span><span class="nv">abxyz</span>
</span><span class='line'>
</span><span class='line'><span class="c">! ***********************************************************</span>
</span><span class='line'><span class="c">!</span>
</span><span class='line'><span class="k">subroutine </span><span class="nv">waves</span> <span class="p">()</span>
</span><span class='line'><span class="c">!</span>
</span><span class='line'><span class="c">!***********************************************************</span>
</span><span class='line'>
</span><span class='line'><span class="k">USE </span><span class="nv">derivX</span>
</span><span class='line'><span class="k">USE </span><span class="nv">derivY</span>
</span><span class='line'><span class="k">USE </span><span class="nv">derivZ</span>
</span><span class='line'><span class="k">USE </span><span class="nv">param</span>
</span><span class='line'><span class="k">USE </span><span class="nv">decomp_2d</span>
</span><span class='line'><span class="k">USE </span><span class="nv">variables</span>
</span><span class='line'><span class="k">use </span><span class="nv">decomp_2d_fft</span>
</span><span class='line'>
</span><span class='line'><span class="k">implicit none</span>
</span><span class='line'>
</span><span class='line'><span class="kt">integer</span> <span class="kd">::</span> <span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span>
</span><span class='line'><span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">w</span><span class="p">,</span><span class="nv">wp</span><span class="p">,</span><span class="nv">w1</span><span class="p">,</span><span class="nv">w1p</span>
</span><span class='line'><span class="kt">complex</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">xyzk</span>
</span><span class='line'><span class="kt">complex</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">ytt</span><span class="p">,</span><span class="nv">xtt</span><span class="p">,</span><span class="nv">ztt</span><span class="p">,</span><span class="nv">yt1</span><span class="p">,</span><span class="nv">xt1</span><span class="p">,</span><span class="nv">yt2</span><span class="p">,</span><span class="nv">xt2</span>
</span><span class='line'><span class="kt">complex</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">xtt1</span><span class="p">,</span><span class="nv">ytt1</span><span class="p">,</span><span class="nv">ztt1</span><span class="p">,</span><span class="nv">zt1</span><span class="p">,</span><span class="nv">zt2</span><span class="p">,</span><span class="nv">tmp1</span><span class="p">,</span><span class="nv">tmp2</span><span class="p">,</span><span class="nv">tmp3</span>
</span><span class='line'><span class="kt">complex</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">tmp4</span><span class="p">,</span><span class="nv">tmp5</span><span class="p">,</span><span class="nv">tmp6</span>
</span><span class='line'>
</span><span class='line'><span class="nv">xkx</span><span class="p">(:)</span><span class="o">=</span><span class="mf">0.</span> <span class="p">;</span> <span class="nv">xk2</span><span class="p">(:)</span><span class="o">=</span><span class="mf">0.</span> <span class="p">;</span> <span class="nv">yky</span><span class="p">(:)</span><span class="o">=</span><span class="mf">0.</span> <span class="p">;</span> <span class="nv">yk2</span><span class="p">(:)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'><span class="nv">zkz</span><span class="p">(:)</span><span class="o">=</span><span class="mf">0.</span> <span class="p">;</span> <span class="nv">zk2</span><span class="p">(:)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>
</span><span class='line'><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'><span class="c">!WAVE NUMBER IN X</span>
</span><span class='line'><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nv">nclx</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">   do </span><span class="nv">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">nx</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span>
</span><span class='line'>      <span class="nv">w</span><span class="o">=</span><span class="mf">2.</span><span class="o">*</span><span class="nv">pi</span><span class="o">*</span><span class="p">(</span><span class="nv">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nv">nx</span>
</span><span class='line'>      <span class="nv">wp</span><span class="o">=</span><span class="nv">acix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nv">dx</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="nv">w</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="nv">bcix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nv">dx</span><span class="p">)</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span><span class="o">*</span><span class="nv">w</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">wp</span><span class="o">=</span><span class="nv">wp</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">alcaix6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="nv">w</span><span class="p">))</span>
</span><span class='line'>      <span class="nv">xkx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">nx</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">xlx</span><span class="p">,</span><span class="nv">nx</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">xlx</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">nx</span><span class="o">*</span><span class="nv">w</span><span class="o">/</span><span class="nv">xlx</span><span class="p">,</span><span class="nv">nx</span><span class="o">*</span><span class="nv">w</span><span class="o">/</span><span class="nv">xlx</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">nx</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">xlx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,(</span><span class="nv">nx</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">xlx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">nx</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">nx</span>
</span><span class='line'>      <span class="nv">xkx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">=</span><span class="nv">xkx</span><span class="p">(</span><span class="nv">nx</span><span class="o">-</span><span class="nv">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">=</span><span class="nv">exs</span><span class="p">(</span><span class="nv">nx</span><span class="o">-</span><span class="nv">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">=</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">nx</span><span class="o">-</span><span class="nv">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="k">   do </span><span class="nv">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">nx</span>
</span><span class='line'>      <span class="nv">w</span><span class="o">=</span><span class="mf">2.</span><span class="o">*</span><span class="nv">pi</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="nv">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nv">nxm</span>
</span><span class='line'>      <span class="nv">wp</span><span class="o">=</span><span class="nv">acix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nv">dx</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="nv">w</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="nv">bcix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nv">dx</span><span class="p">)</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span><span class="o">*</span><span class="nv">w</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">wp</span><span class="o">=</span><span class="nv">wp</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">alcaix6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="nv">w</span><span class="p">))</span>
</span><span class='line'>      <span class="nv">xkx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">nxm</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">xlx</span><span class="p">,</span><span class="nv">nxm</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">xlx</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">nxm</span><span class="o">*</span><span class="nv">w</span><span class="o">/</span><span class="nv">xlx</span><span class="p">,</span><span class="nv">nxm</span><span class="o">*</span><span class="nv">w</span><span class="o">/</span><span class="nv">xlx</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">nxm</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">xlx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,(</span><span class="nv">nxm</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">xlx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">xkx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">exs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">xk2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'><span class="k">endif</span>
</span><span class='line'>
</span><span class='line'><span class="c">!WAVE NUMBER IN Y</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nv">ncly</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">   do </span><span class="nv">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span>
</span><span class='line'>      <span class="nv">w</span><span class="o">=</span><span class="mf">2.</span><span class="o">*</span><span class="nv">pi</span><span class="o">*</span><span class="p">(</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nv">ny</span>
</span><span class='line'>      <span class="nv">wp</span><span class="o">=</span><span class="nv">aciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nv">dy</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="nv">w</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="nv">bciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nv">dy</span><span class="p">)</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span><span class="o">*</span><span class="nv">w</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">wp</span><span class="o">=</span><span class="nv">wp</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">alcaiy6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="nv">w</span><span class="p">))</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nv">istret</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="nv">yky</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">ny</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">yly</span><span class="p">,</span><span class="nv">ny</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">yly</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nv">istret</span><span class="ow">.ne.</span><span class="mi">0</span><span class="p">)</span> <span class="nv">yky</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">ny</span><span class="o">*</span><span class="nv">wp</span><span class="p">,</span><span class="nv">ny</span><span class="o">*</span><span class="nv">wp</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">ny</span><span class="o">*</span><span class="nv">w</span><span class="o">/</span><span class="nv">yly</span><span class="p">,</span><span class="nv">ny</span><span class="o">*</span><span class="nv">w</span><span class="o">/</span><span class="nv">yly</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">yk2</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">ny</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">yly</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,(</span><span class="nv">ny</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">yly</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">ny</span>
</span><span class='line'>      <span class="nv">yky</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">=</span><span class="nv">yky</span><span class="p">(</span><span class="nv">ny</span><span class="o">-</span><span class="nv">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">=</span><span class="nv">eys</span><span class="p">(</span><span class="nv">ny</span><span class="o">-</span><span class="nv">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">yk2</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">=</span><span class="nv">yk2</span><span class="p">(</span><span class="nv">ny</span><span class="o">-</span><span class="nv">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="k">   do </span><span class="nv">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">ny</span>
</span><span class='line'>      <span class="nv">w</span><span class="o">=</span><span class="mf">2.</span><span class="o">*</span><span class="nv">pi</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nv">nym</span>
</span><span class='line'>      <span class="nv">wp</span><span class="o">=</span><span class="nv">aciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nv">dy</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="nv">w</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="nv">bciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nv">dy</span><span class="p">)</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span><span class="o">*</span><span class="nv">w</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">wp</span><span class="o">=</span><span class="nv">wp</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">alcaiy6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="nv">w</span><span class="p">))</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nv">istret</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="nv">yky</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">nym</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">yly</span><span class="p">,</span><span class="nv">nym</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">yly</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nv">istret</span><span class="ow">.ne.</span><span class="mi">0</span><span class="p">)</span> <span class="nv">yky</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">nym</span><span class="o">*</span><span class="nv">wp</span><span class="p">,</span><span class="nv">nym</span><span class="o">*</span><span class="nv">wp</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">nym</span><span class="o">*</span><span class="nv">w</span><span class="o">/</span><span class="nv">yly</span><span class="p">,</span><span class="nv">nym</span><span class="o">*</span><span class="nv">w</span><span class="o">/</span><span class="nv">yly</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">yk2</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">nym</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">yly</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,(</span><span class="nv">nym</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">yly</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">yky</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">eys</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">yk2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'><span class="k">endif</span>
</span><span class='line'>
</span><span class='line'><span class="c">!WAVE NUMBER IN Z</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nv">nclz</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">   do </span><span class="nv">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">nz</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span>
</span><span class='line'>      <span class="nv">w</span><span class="o">=</span><span class="mf">2.</span><span class="o">*</span><span class="nv">pi</span><span class="o">*</span><span class="p">(</span><span class="nv">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nv">nz</span>
</span><span class='line'>      <span class="nv">wp</span><span class="o">=</span><span class="nv">aciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nv">dz</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="nv">w</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="nv">bciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nv">dz</span><span class="p">)</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span><span class="o">*</span><span class="nv">w</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">wp</span><span class="o">=</span><span class="nv">wp</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">alcaiz6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="nv">w</span><span class="p">))</span>
</span><span class='line'>      <span class="nv">zkz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">nz</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">zlz</span><span class="p">,</span><span class="nv">nz</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">zlz</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">nz</span><span class="o">*</span><span class="nv">w</span><span class="o">/</span><span class="nv">zlz</span><span class="p">,</span><span class="nv">nz</span><span class="o">*</span><span class="nv">w</span><span class="o">/</span><span class="nv">zlz</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">nz</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">zlz</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,(</span><span class="nv">nz</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">zlz</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="k">   do </span><span class="nv">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">nz</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span>
</span><span class='line'>      <span class="nv">w</span><span class="o">=</span><span class="mf">2.</span><span class="o">*</span><span class="nv">pi</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="nv">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nv">nzm</span>
</span><span class='line'>      <span class="nv">w1</span><span class="o">=</span><span class="mf">2.</span><span class="o">*</span><span class="nv">pi</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="nv">nzm</span><span class="o">-</span><span class="nv">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nv">nzm</span>
</span><span class='line'>      <span class="nv">wp</span><span class="o">=</span><span class="nv">aciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nv">dz</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="nv">w</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="nv">bciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nv">dz</span><span class="p">)</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span><span class="o">*</span><span class="nv">w</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">wp</span><span class="o">=</span><span class="nv">wp</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">alcaiz6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="nv">w</span><span class="p">))</span>
</span><span class='line'>      <span class="nv">w1p</span><span class="o">=</span><span class="nv">aciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nv">dz</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="nv">w1</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="nv">bciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nv">dz</span><span class="p">)</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span><span class="o">*</span><span class="nv">w1</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">w1p</span><span class="o">=</span><span class="nv">w1p</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">alcaiz6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="nv">w1</span><span class="p">))</span>
</span><span class='line'>      <span class="nv">zkz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">nzm</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">zlz</span><span class="p">,</span><span class="o">-</span><span class="nv">nzm</span><span class="o">*</span><span class="nv">w1p</span><span class="o">/</span><span class="nv">zlz</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">nzm</span><span class="o">*</span><span class="nv">w</span><span class="o">/</span><span class="nv">zlz</span><span class="p">,</span><span class="nv">nzm</span><span class="o">*</span><span class="nv">w1</span><span class="o">/</span><span class="nv">zlz</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">nzm</span><span class="o">*</span><span class="nv">wp</span><span class="o">/</span><span class="nv">zlz</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,(</span><span class="nv">nzm</span><span class="o">*</span><span class="nv">w1p</span><span class="o">/</span><span class="nv">zlz</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'><span class="k">endif</span>
</span><span class='line'><span class="c">!</span>
</span><span class='line'><span class="c">!if (nrank==0) then</span>
</span><span class='line'><span class="c">!   do i=1,nx</span>
</span><span class='line'><span class="c">!      print *,i,ezs(i)</span>
</span><span class='line'><span class="c">!   enddo</span>
</span><span class='line'><span class="c">!endif</span>
</span><span class='line'><span class="c">!stop</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">((</span><span class="nv">nclx</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="ow">.and.</span><span class="p">(</span><span class="nv">nclz</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="ow">.and.</span><span class="p">((</span><span class="nv">ncly</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="ow">.or.</span><span class="p">(</span><span class="nv">ncly</span><span class="o">==</span><span class="mi">2</span><span class="p">)))</span> <span class="k">then</span>
</span><span class='line'><span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'><span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'><span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">xtt</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">bicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>        <span class="nv">cicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>        <span class="p">(</span><span class="nv">bicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>        <span class="nv">cicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">ytt</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">biciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>        <span class="nv">ciciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>        <span class="p">(</span><span class="nv">biciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>        <span class="nv">ciciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">ztt</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">biciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>        <span class="nv">ciciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>        <span class="p">(</span><span class="nv">biciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>        <span class="nv">ciciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">xtt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">aicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>        <span class="p">(</span><span class="nv">aicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">ytt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">aiciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>        <span class="p">(</span><span class="nv">aiciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">ztt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">aiciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>        <span class="p">(</span><span class="nv">aiciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">xt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaix6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dx</span><span class="p">)),&amp;</span>
</span><span class='line'>        <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaix6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dx</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">yt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaiy6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dy</span><span class="p">)),&amp;</span>
</span><span class='line'>        <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaiy6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dy</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">zt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaiz6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dz</span><span class="p">)),&amp;</span>
</span><span class='line'>        <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaiz6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dz</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">xt2</span><span class="o">=</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">*</span><span class="p">((((</span><span class="nv">ytt1</span><span class="o">+</span><span class="nv">ytt</span><span class="p">)</span><span class="o">/</span><span class="nv">yt1</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="nv">ztt1</span><span class="o">+</span><span class="nv">ztt</span><span class="p">)</span><span class="o">/</span><span class="nv">zt1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">yt2</span><span class="o">=</span><span class="nv">yk2</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">*</span><span class="p">((((</span><span class="nv">xtt1</span><span class="o">+</span><span class="nv">xtt</span><span class="p">)</span><span class="o">/</span><span class="nv">xt1</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="nv">ztt1</span><span class="o">+</span><span class="nv">ztt</span><span class="p">)</span><span class="o">/</span><span class="nv">zt1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">zt2</span><span class="o">=</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">*</span><span class="p">((((</span><span class="nv">xtt1</span><span class="o">+</span><span class="nv">xtt</span><span class="p">)</span><span class="o">/</span><span class="nv">xt1</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="nv">ytt1</span><span class="o">+</span><span class="nv">ytt</span><span class="p">)</span><span class="o">/</span><span class="nv">yt1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">xyzk</span><span class="o">=</span><span class="nv">xt2</span><span class="o">+</span><span class="nv">yt2</span><span class="o">+</span><span class="nv">zt2</span>
</span><span class='line'>   <span class="nv">kxyz</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">xyzk</span>
</span><span class='line'><span class="c">!   print *,i,j,k, kxyz(i,j,k)</span>
</span><span class='line'><span class="nv">enddo</span>
</span><span class='line'><span class="nv">enddo</span>
</span><span class='line'><span class="nv">enddo</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="k">   if</span> <span class="p">(</span><span class="nv">nclz</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">      do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>      <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>      <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">xtt</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">bicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>              <span class="nv">cicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>              <span class="p">(</span><span class="nv">bicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>              <span class="nv">cicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">ytt</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">biciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>              <span class="nv">ciciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>              <span class="p">(</span><span class="nv">biciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>              <span class="nv">ciciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">ztt</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">biciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>              <span class="nv">ciciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>              <span class="p">(</span><span class="nv">biciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>              <span class="nv">ciciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">xtt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">aicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>              <span class="p">(</span><span class="nv">aicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">ytt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">aiciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>              <span class="p">(</span><span class="nv">aiciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">ztt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">aiciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>              <span class="p">(</span><span class="nv">aiciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">xt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaix6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dx</span><span class="p">)),&amp;</span>
</span><span class='line'>              <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaix6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nv">dx</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">yt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaiy6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dy</span><span class="p">)),&amp;</span>
</span><span class='line'>              <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaiy6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dy</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">zt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaiz6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dz</span><span class="p">)),&amp;</span>
</span><span class='line'>              <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaiz6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dz</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">xt2</span><span class="o">=</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">*</span><span class="p">((((</span><span class="nv">ytt1</span><span class="o">+</span><span class="nv">ytt</span><span class="p">)</span><span class="o">/</span><span class="nv">yt1</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="nv">ztt1</span><span class="o">+</span><span class="nv">ztt</span><span class="p">)</span><span class="o">/</span><span class="nv">zt1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">yt2</span><span class="o">=</span><span class="nv">yk2</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">*</span><span class="p">((((</span><span class="nv">xtt1</span><span class="o">+</span><span class="nv">xtt</span><span class="p">)</span><span class="o">/</span><span class="nv">xt1</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="nv">ztt1</span><span class="o">+</span><span class="nv">ztt</span><span class="p">)</span><span class="o">/</span><span class="nv">zt1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">zt2</span><span class="o">=</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">*</span><span class="p">((((</span><span class="nv">xtt1</span><span class="o">+</span><span class="nv">xtt</span><span class="p">)</span><span class="o">/</span><span class="nv">xt1</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="nv">ytt1</span><span class="o">+</span><span class="nv">ytt</span><span class="p">)</span><span class="o">/</span><span class="nv">yt1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">xyzk</span><span class="o">=</span><span class="nv">xt2</span><span class="o">+</span><span class="nv">yt2</span><span class="o">+</span><span class="nv">zt2</span>
</span><span class='line'>         <span class="nv">kxyz</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">xyzk</span>
</span><span class='line'><span class="c">!   print *,i,j,k, kxyz(i,j,k)</span>
</span><span class='line'>      <span class="nv">enddo</span>
</span><span class='line'>      <span class="nv">enddo</span>
</span><span class='line'>      <span class="nv">enddo</span>
</span><span class='line'>   <span class="k">else</span>
</span><span class='line'><span class="k">      do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>      <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>      <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">xst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">xen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">xtt</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">bicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>              <span class="nv">cicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>              <span class="p">(</span><span class="nv">bicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>              <span class="nv">cicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">ytt</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">biciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>              <span class="nv">ciciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>              <span class="p">(</span><span class="nv">biciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>              <span class="nv">ciciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="c">!</span>
</span><span class='line'>         <span class="nv">ztt</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">biciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>              <span class="nv">ciciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>              <span class="p">(</span><span class="nv">biciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>              <span class="nv">ciciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="c">!</span>
</span><span class='line'>         <span class="nv">xtt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">aicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>              <span class="p">(</span><span class="nv">aicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">ytt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">aiciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>              <span class="p">(</span><span class="nv">aiciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="c">!</span>
</span><span class='line'>         <span class="nv">ztt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">aiciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>              <span class="p">(</span><span class="nv">aiciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="c">!</span>
</span><span class='line'>         <span class="nv">xt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaix6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dx</span><span class="p">)),&amp;</span>
</span><span class='line'>              <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaix6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dx</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">yt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaiy6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dy</span><span class="p">)),&amp;</span>
</span><span class='line'>              <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaiy6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dy</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">zt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaiz6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dz</span><span class="p">)),&amp;</span>
</span><span class='line'>              <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaiz6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nv">dz</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>         <span class="nv">tmp1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ztt1</span><span class="o">+</span><span class="nv">ztt</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">zt1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">),&amp;</span>
</span><span class='line'>              <span class="nb">aimag</span><span class="p">(</span><span class="nv">ztt1</span><span class="o">+</span><span class="nv">ztt</span><span class="p">)</span><span class="o">/</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">zt1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">tmp2</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ytt1</span><span class="o">+</span><span class="nv">ytt</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">yt1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">),&amp;</span>
</span><span class='line'>              <span class="kt">real</span><span class="p">(</span><span class="nv">ytt1</span><span class="o">+</span><span class="nv">ytt</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">yt1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">tmp3</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">xtt1</span><span class="o">+</span><span class="nv">xtt</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">xt1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">),&amp;</span>
</span><span class='line'>              <span class="kt">real</span><span class="p">(</span><span class="nv">xtt1</span><span class="o">+</span><span class="nv">xtt</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">xt1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>         <span class="nv">tmp4</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="kt">real</span><span class="p">(</span><span class="nv">tmp1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">tmp2</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">,(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">tmp1</span><span class="p">)</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">tmp2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">tmp5</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="kt">real</span><span class="p">(</span><span class="nv">tmp1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">tmp3</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">,(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">tmp1</span><span class="p">)</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">tmp3</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">tmp6</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="kt">real</span><span class="p">(</span><span class="nv">tmp3</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">tmp2</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">,(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">tmp3</span><span class="p">)</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">tmp2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>         <span class="nv">tmp1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">tmp4</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">),</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">tmp4</span><span class="p">)</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">tmp2</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">tmp5</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">yk2</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">),</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">tmp5</span><span class="p">)</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">yk2</span><span class="p">(</span><span class="nv">j</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">tmp3</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">tmp6</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">),</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">tmp6</span><span class="p">)</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>         <span class="nv">xyzk</span><span class="o">=</span><span class="nv">tmp1</span><span class="o">+</span><span class="nv">tmp2</span><span class="o">+</span><span class="nv">tmp3</span>
</span><span class='line'>         <span class="nv">kxyz</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nv">xyzk</span>
</span><span class='line'><span class="c">!         print *,i,j,k,zt1,yt1</span>
</span><span class='line'>      <span class="nv">enddo</span>
</span><span class='line'>      <span class="nv">enddo</span>
</span><span class='line'>      <span class="nv">enddo</span>
</span><span class='line'>   <span class="k">endif</span>
</span><span class='line'><span class="k">endif</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c">!          do k=1,1!nz</span>
</span><span class='line'><span class="c">!          do j=1,ny</span>
</span><span class='line'><span class="c">!          do i=1,1!!nx</span>
</span><span class='line'><span class="c">!             print *,j,a(i,j,k,3),kxyz(i,j,k)</span>
</span><span class='line'><span class="c">!          enddo</span>
</span><span class='line'><span class="c">!          enddo</span>
</span><span class='line'><span class="c">!          enddo</span>
</span><span class='line'>
</span><span class='line'><span class="k">end subroutine </span><span class="nv">waves</span>
</span><span class='line'>
</span><span class='line'><span class="c">!**************************************************************************</span>
</span><span class='line'><span class="c">!</span>
</span><span class='line'><span class="k">subroutine </span><span class="nv">matrice_refinement</span><span class="p">()</span>
</span><span class='line'><span class="c">!</span>
</span><span class='line'><span class="c">!**************************************************************************</span>
</span><span class='line'>
</span><span class='line'><span class="k">USE </span><span class="nv">decomp_2d</span>
</span><span class='line'><span class="k">USE </span><span class="nv">variables</span>
</span><span class='line'><span class="k">USE </span><span class="nv">param</span>
</span><span class='line'><span class="k">USE </span><span class="nv">var</span>
</span><span class='line'><span class="k">USE </span><span class="nv">MPI</span>
</span><span class='line'><span class="k">USE </span><span class="nv">derivX</span>
</span><span class='line'><span class="k">USE </span><span class="nv">derivY</span>
</span><span class='line'><span class="k">USE </span><span class="nv">derivZ</span>
</span><span class='line'>
</span><span class='line'><span class="k">implicit none</span>
</span><span class='line'>
</span><span class='line'><span class="kt">integer</span> <span class="kd">::</span> <span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span>
</span><span class='line'>
</span><span class='line'><span class="kt">complex</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="kd">::</span> <span class="nv">transx</span>
</span><span class='line'><span class="kt">complex</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="kd">::</span> <span class="nv">transy</span>
</span><span class='line'><span class="kt">complex</span><span class="p">(</span><span class="nv">mytype</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="kd">::</span> <span class="nv">transz</span>
</span><span class='line'><span class="kt">real</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">xa0</span><span class="p">,</span><span class="nv">xa1</span>
</span><span class='line'><span class="kt">complex</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">ytt</span><span class="p">,</span><span class="nv">xtt</span><span class="p">,</span><span class="nv">ztt</span><span class="p">,</span><span class="nv">yt1</span><span class="p">,</span><span class="nv">xt1</span><span class="p">,</span><span class="nv">yt2</span><span class="p">,</span><span class="nv">xt2</span>
</span><span class='line'><span class="kt">complex</span><span class="p">(</span><span class="nv">mytype</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">xtt1</span><span class="p">,</span><span class="nv">ytt1</span><span class="p">,</span><span class="nv">ztt1</span><span class="p">,</span><span class="nv">zt1</span><span class="p">,</span><span class="nv">zt2</span><span class="p">,</span><span class="nv">tmp1</span><span class="p">,</span><span class="nv">tmp2</span><span class="p">,</span><span class="nv">tmp3</span>
</span><span class='line'>
</span><span class='line'><span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">xtt</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">bicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>        <span class="nv">cicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>        <span class="p">(</span><span class="nv">bicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>        <span class="nv">cicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">xtt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">aicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>        <span class="p">(</span><span class="nv">aicix6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">xt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaix6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dx</span><span class="p">)),&amp;</span>
</span><span class='line'>        <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaix6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">exs</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dx</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">xtt1</span><span class="o">+</span><span class="nv">xtt</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">xt1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">),&amp;</span>
</span><span class='line'>        <span class="kt">real</span><span class="p">(</span><span class="nv">xtt1</span><span class="o">+</span><span class="nv">xtt</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">xt1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="c">!(xtt+xtt)/xt1</span>
</span><span class='line'><span class="nv">enddo</span>
</span><span class='line'><span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">ytt</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">biciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>        <span class="nv">ciciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>        <span class="p">(</span><span class="nv">biciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>        <span class="nv">ciciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">ytt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">aiciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>        <span class="p">(</span><span class="nv">aiciy6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dy</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">yt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaiy6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dy</span><span class="p">)),&amp;</span>
</span><span class='line'>        <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaiy6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">eys</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dy</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">transy</span><span class="p">(</span><span class="nv">j</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ytt1</span><span class="o">+</span><span class="nv">ytt</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">yt1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">),&amp;</span>
</span><span class='line'>        <span class="kt">real</span><span class="p">(</span><span class="nv">ytt1</span><span class="o">+</span><span class="nv">ytt</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">yt1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="c">!(ytt+ytt)/yt1</span>
</span><span class='line'><span class="nv">enddo</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nv">nclz</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">   do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">ztt</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">biciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="nv">ciciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="p">(</span><span class="nv">biciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="nv">ciciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">ztt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">aiciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="p">(</span><span class="nv">aiciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">zt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaiz6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dz</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaiz6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dz</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ztt1</span><span class="o">+</span><span class="nv">ztt</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">zt1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">),&amp;</span>
</span><span class='line'>           <span class="nb">aimag</span><span class="p">(</span><span class="nv">ztt1</span><span class="o">+</span><span class="nv">ztt</span><span class="p">)</span><span class="o">/</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">zt1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="c">!(ztt+ztt)/zt1</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="k">   do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">ztt</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">biciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="nv">ciciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="p">(</span><span class="nv">biciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="mf">3.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="nv">ciciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="mf">5.</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">ztt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">aiciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="p">(</span><span class="nv">aiciz6</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nv">dz</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">zt1</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaiz6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">dz</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="nv">ailcaiz6</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">ezs</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nv">dz</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">ztt1</span><span class="o">+</span><span class="nv">ztt</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">zt1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">),&amp;</span>
</span><span class='line'>           <span class="nb">aimag</span><span class="p">(</span><span class="nv">ztt1</span><span class="o">+</span><span class="nv">ztt</span><span class="p">)</span><span class="o">/</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">zt1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="c">!(ztt+ztt)/zt1</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'><span class="k">endif</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">((</span><span class="nv">istret</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="ow">.or.</span><span class="p">(</span><span class="nv">istret</span><span class="o">==</span><span class="mi">2</span><span class="p">))</span> <span class="k">then</span>
</span><span class='line'>
</span><span class='line'><span class="k"> </span>
</span><span class='line'><span class="k">   </span><span class="nv">xa0</span><span class="o">=</span><span class="nv">alpha</span><span class="o">/</span><span class="nv">pi</span><span class="o">+</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="o">/</span><span class="nv">beta</span><span class="o">/</span><span class="nv">pi</span>
</span><span class='line'>   <span class="k">if</span> <span class="p">(</span><span class="nv">istret</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="nv">xa1</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="mf">4.</span><span class="o">/</span><span class="nv">beta</span><span class="o">/</span><span class="nv">pi</span>
</span><span class='line'>   <span class="k">if</span> <span class="p">(</span><span class="nv">istret</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="nv">xa1</span><span class="o">=-</span><span class="mf">1.</span><span class="o">/</span><span class="mf">4.</span><span class="o">/</span><span class="nv">beta</span><span class="o">/</span><span class="nv">pi</span>
</span><span class='line'><span class="c">!</span>
</span><span class='line'><span class="c">!construction of the pentadiagonal matrice</span>
</span><span class='line'><span class="c">!</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">yky</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">),&amp;</span>
</span><span class='line'>           <span class="nb">aimag</span><span class="p">(</span><span class="nv">yky</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">yky</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">),&amp;</span>
</span><span class='line'>           <span class="nb">aimag</span><span class="p">(</span><span class="nv">yky</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c">!main diagonal</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">a</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)&amp;</span>
</span><span class='line'>           <span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa0</span><span class="o">-</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">+</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa0</span><span class="o">-</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">+</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">a2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa0</span><span class="o">-</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">+</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nv">j</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa0</span><span class="o">-</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">+</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">a</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa0</span><span class="o">-</span><span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa0</span><span class="o">-</span><span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">a</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">ny</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">ny</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)&amp;</span>
</span><span class='line'>           <span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">ny</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">ny</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa0</span><span class="o">-</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">ny</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">ny</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">ny</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">ny</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa0</span><span class="o">-</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">a2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nv">xa0</span><span class="o">-</span><span class="nv">xa1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nv">xa0</span><span class="o">+</span><span class="nv">xa1</span><span class="p">)</span><span class="o">-</span><span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="nv">xa0</span><span class="o">-</span><span class="nv">xa1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nv">xa0</span><span class="o">+</span><span class="nv">xa1</span><span class="p">)</span><span class="o">-</span><span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">a2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nv">xa0</span><span class="o">+</span><span class="nv">xa1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nv">xa0</span><span class="o">+</span><span class="nv">xa1</span><span class="p">)</span><span class="o">-</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="nv">xa0</span><span class="o">+</span><span class="nv">xa1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nv">xa0</span><span class="o">+</span><span class="nv">xa1</span><span class="p">)</span><span class="o">-</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c">!sup diag +1</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">a</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">+</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">+</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">a2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">+</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">+</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">a</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">=</span><span class="mf">2.</span><span class="o">*</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">+</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))),&amp;</span>
</span><span class='line'>           <span class="p">(</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">+</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">)))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">a2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">xa0</span><span class="o">-</span><span class="nv">xa1</span><span class="p">)</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">+</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="p">(</span><span class="nv">xa0</span><span class="o">-</span><span class="nv">xa1</span><span class="p">)</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">+</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">a2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">+</span><span class="p">(</span><span class="nv">xa0</span><span class="o">+</span><span class="nv">xa1</span><span class="p">)</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">+</span><span class="p">(</span><span class="nv">xa0</span><span class="o">+</span><span class="nv">xa1</span><span class="p">)</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">a2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c">!sup diag +2</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span>
</span><span class='line'>      <span class="nv">a</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="o">-</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="p">,&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">a2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="o">-</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="p">,&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">a</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">a</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="mf">2.</span><span class="p">,</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">a</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span><span class="o">*</span><span class="mf">2.</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">a</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">a</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">a2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">a2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c">!inf diag -1</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>      <span class="nv">a</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">+</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">+</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">a2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">+</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">+</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">a</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">a2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">a2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>        <span class="o">+</span><span class="p">(</span><span class="nv">xa0</span><span class="o">+</span><span class="nv">xa1</span><span class="p">)</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)),&amp;</span>
</span><span class='line'>        <span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">)))&amp;</span>
</span><span class='line'>        <span class="o">+</span><span class="p">(</span><span class="nv">xa0</span><span class="o">+</span><span class="nv">xa1</span><span class="p">)</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">a2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">xa0</span><span class="o">+</span><span class="nv">xa1</span><span class="p">)</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>        <span class="o">+</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)),&amp;</span>
</span><span class='line'>        <span class="p">(</span><span class="nv">xa0</span><span class="o">+</span><span class="nv">xa1</span><span class="p">)</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">)))&amp;</span>
</span><span class='line'>        <span class="o">+</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'><span class="c">!inf diag -2</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="nv">ny</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'>      <span class="nv">a</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="o">-</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="p">,&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">a2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="o">-</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="p">,&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">a</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">a</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">a2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">a2</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'><span class="c">!not to have a singular matrice</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">((</span><span class="kt">real</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">==</span><span class="mf">0.</span><span class="p">)</span><span class="ow">.and.</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">))</span> <span class="k">then</span>
</span><span class='line'><span class="k">         </span><span class="nv">a</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">a</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>         <span class="nv">a</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>      <span class="k">endif</span>
</span><span class='line'><span class="k">   </span><span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="k">   </span><span class="nv">xa0</span><span class="o">=</span><span class="nv">alpha</span><span class="o">/</span><span class="nv">pi</span><span class="o">+</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="o">/</span><span class="nv">beta</span><span class="o">/</span><span class="nv">pi</span>
</span><span class='line'>   <span class="nv">xa1</span><span class="o">=-</span><span class="mf">1.</span><span class="o">/</span><span class="mf">4.</span><span class="o">/</span><span class="nv">beta</span><span class="o">/</span><span class="nv">pi</span>
</span><span class='line'><span class="c">!</span>
</span><span class='line'><span class="c">!construction of the pentadiagonal matrice</span>
</span><span class='line'><span class="c">!   </span>
</span><span class='line'>   <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">nym</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">yky</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">),&amp;</span>
</span><span class='line'>           <span class="nb">aimag</span><span class="p">(</span><span class="nv">yky</span><span class="p">(</span><span class="nv">j</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">)),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>
</span><span class='line'><span class="c">!main diagonal</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="nv">nym</span><span class="o">-</span><span class="mi">1</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">a3</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">j</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa0</span><span class="o">-</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">+</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">j</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">j</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">j</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">j</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa0</span><span class="o">-</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">+</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">a3</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa0</span><span class="o">-</span><span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa0</span><span class="o">-</span><span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">a3</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">nym</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">nym</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">nym</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">nym</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">nym</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">nym</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">nym</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa0</span><span class="o">-</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">nym</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">nym</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">xk2</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">nym</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">nym</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transz</span><span class="p">(</span><span class="nv">k</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">zk2</span><span class="p">(</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">nym</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transy</span><span class="p">(</span><span class="nv">nym</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">transx</span><span class="p">(</span><span class="nv">i</span><span class="p">)))&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">nym</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">nym</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa0</span><span class="o">-</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">nym</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">nym</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c">!sup diag +1</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="nv">nym</span><span class="o">-</span><span class="mi">1</span>
</span><span class='line'>      <span class="nv">a3</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">+</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">+</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">a3</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">((</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">+</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>        <span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">))),&amp;</span>
</span><span class='line'>        <span class="p">(</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">+</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">)))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'><span class="c">!sup diag +2</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">nym</span><span class="o">-</span><span class="mi">2</span>
</span><span class='line'>      <span class="nv">a3</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="o">-</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="p">,&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="c">!a3(i,1,k,5)=a3(i,1,k,5)*2.</span>
</span><span class='line'>   <span class="c">!a3(i,1,k,5)=0.</span>
</span><span class='line'>   <span class="nv">a3</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">nym</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">a3</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">nym</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c">!inf diag -1</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="nv">nym</span>
</span><span class='line'>      <span class="nv">a3</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">+</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
</span><span class='line'>           <span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)),&amp;</span>
</span><span class='line'>           <span class="nv">xa0</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="p">(</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">+</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">a3</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'><span class="c">!inf diag -2</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">k</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">i</span><span class="o">=</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yst</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nv">sp</span><span class="p">%</span><span class="nv">yen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>   <span class="k">do </span><span class="nv">j</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="nv">nym</span>
</span><span class='line'>      <span class="nv">a3</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="o">-</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">),</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="p">,&amp;</span>
</span><span class='line'>           <span class="o">-</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nb">aimag</span><span class="p">(</span><span class="nv">cw22</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">))</span><span class="o">*</span><span class="nv">xa1</span><span class="o">*</span><span class="nv">xa1</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">a3</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">a3</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>   <span class="nv">enddo</span>
</span><span class='line'>
</span><span class='line'><span class="c">!not to have a singular matrice</span>
</span><span class='line'><span class="c">!   do k=sp%yst(3),sp%yen(3)</span>
</span><span class='line'><span class="c">!   do i=sp%yst(1),sp%yen(1)</span>
</span><span class='line'><span class="c">!      if ((xkx(i)==0.).and.(zkz(k)==0)) then</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nv">nrank</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
</span><span class='line'><span class="k">   </span><span class="nv">a3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="nb">cmplx</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="nv">mytype</span><span class="p">)</span>
</span><span class='line'>   <span class="nv">a3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'>   <span class="nv">a3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
</span><span class='line'><span class="k">endif</span>
</span><span class='line'><span class="c">!      endif</span>
</span><span class='line'><span class="c">!   enddo</span>
</span><span class='line'><span class="c">!   enddo</span>
</span><span class='line'><span class="k">endif</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">   </span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">return</span>
</span><span class='line'><span class="k">end subroutine </span><span class="nv">matrice_refinement</span>
</span><span class='line'>
</span><span class='line'><span class="k">end module </span><span class="nv">decomp_2d_poisson</span>
</span></code></pre></td></tr></table></div></figure>


<p class='post-footer'>
                        原始地址:<a href='http://jueqingsizhe66.github.io/blog/2014/05/14/poisson/'>http://jueqingsizhe66.github.io/blog/2014/05/14/poisson/</a><br/>&nbsp;written by <a href='http://jueqingsizhe66.github.io'>Ye Zhaoliang</a>&nbsp;posted at <a href='http://jueqingsizhe66.github.io'>http://jueqingsizhe66.github.io</a></p>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Ye Zhaoliang</span></span>

      








  


<time datetime="2014-05-14T02:09:00+08:00" pubdate data-updated="true">May 14<span>th</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/incompact3d/'>incompact3d</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/05/13/markdown-learning/" title="Previous Post: markdown_learning">&laquo; markdown_learning</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/05/14/xie-bo-ke-de-yi-yi/" title="Next Post: 写博客的意义">写博客的意义 &raquo;</a>
      
    </p>
  </footer>
</article>



  <section>
    <h1>Comments</h1>
    <div id="comments" aria-live="polite"><div class="ds-thread" > </div>
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"f708708"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->
</div>
  </section>


</div>

<aside class="sidebar">
  
    <section>
  <article role="article">  <!--不是他的原因-->
    <p>
      <!--<img class="alignleft" src="/images/xinran.jpg" style="Float:left;MARGIN-BOTTOM: 10px;MARGIN-RIGHT: 40px" weight="100" height="140" border="0" /> -->
      <img class="alignleft" src="/images/lvxing/sea.jpg" style="Float:left;MARGIN-BOTTOM: 10px;MARGIN-RIGHT: 10px" weight="100" height="140" border="0" /> 
 <!--而是yellow的原因-->
<!--不是他的原因-->
 </br> 
    <h4> 叶昭良(Zhaoliang Ye) believe& 肖欣然(Xinran Xiao)</h4>
    <h5> Our Life </h5>
<hr style="color:#990000;border:1px dotted">
    QQ: <a href="977962857@qq.com">977962857@qq.com</a>
        <a href="36559660@qq.com">36559660@qq.com</a>

    </br>
    Weibo: <a href="zhaoturkkey@sina.com">zhaoturkkey@sina.com</a>

    <h5>Our Work</h5>

<hr style="color:#990000;border:1px dotted">
  <p>fortran程序员,Java程序员,HR,CFD</p>

<h5>Some books and links</h5>
<hr style="color:#990000;border:1px dotted">

<p>Scheme:</br>
  <a href="http://www.ccs.neu.edu/home/matthias/BTLS/"><font color="red">《the little scheme》(TLS)</font></a></br>
    <a href=" http://www.ccs.neu.edu/home/matthias/BTSS/">《The Season Scheme》(TSS)</a> </br>
    <a href="http://www.realmofracket.com/ ">《 Realm of Racket》</a> </br>
  <a href="http://scheme.com/tspl4/">《The Scheme Programming Language》(TSPL) </a> </br> 
  <a href=" http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-4.html#%_toc_start">《Structure and Interpretation of Computer Programs》(SICP)</a></br>
  <a href="http://community.schemewiki.org/?SICP-Solutions ">SICP Solution</a></br>
  <a href="https://github.com/DeathKing/Learning-SICP">Learning SICP</a></br>
  <a href="http://www.eopl3.com/ "><font color="red">《Essentials of Programming Language》(EOPL)</font></a></br>
  <a href="http://academic.udayton.edu/SaverioPerugini/courses/cps343/lecture_notes/ ">EOPL Course</a></br>

  <a href="http://www.ccs.neu.edu/home/matthias/HtDP2e/">How to Design programs(程序设计方法 SICP的简化版)</a></br>
  <a href="http://www.cs.berkeley.edu/~bh/ss-toc2.html"> Simply Scheme(中学级别)</a></br>
  <a href="http://songjinghe.github.io/TYS-zh-translation/"> Scheme语言简明教程(汉)</a></br>
  <a href="http://ds26gte.github.io/tyscheme/index.html"> Teach yourself Scheme in fixed days</a></br>
  <a href="http://vdisk.weibo.com/s/uutnsRMnFAbDA ">Scheme in programming(不错的入门书籍)</a></br>


</p>
<p> Lisp: </br>
  <a href=" http://www.landoflisp.com/">《Land of Lisp》</a></br>
  <a href="http://www.lisperati.com/casting.html">[Casting_spels] </a></br>
  <a href=" http://www.gigamonkeys.com/book/"> 《Practical CommonLisp》</a></br>
  <a href="http://www.paulgraham.com/acl.html">《ANSI_Common_lisp》 </a> </br>
  <a href="http://www.norvig.com/paip.html"> 《Paradigms of Artificial Intelligence Programming(PAIP)》</a></br>

</p>
<p> Clojure: </br>
  <a href="http://buhoz.net/public/books/lenguajes/clojure/Practical.Clojure.pdf">《Prcatical_clojure》</a></br>
  <a href=" http://www.joyofclojure.com/">《The joy of Clojure》</a>
  <a href="http://www.clojurebook.com/">《programming Clojure》 </a> </br>
  <a href="http://blog.csdn.net/zh2qiang/article/category/928066"> Programming clojure学习笔记 </a></br>
  <a href="http://xumingming.sinaapp.com/302/">Clojure入门教程: Clojure – Functional Programming for the JVM </a> </br>
  <a href="http://www.oschina.net/translate/the-clojure-philosophy?cmp">Clojure 哲学</a></br> 

</p></br>
<p> Haskell:</br>
  <a href="http://fleurer-lee.com/lyah/introduction.htm#%E5%85%B3%E4%BA%8E%E8%BF%99%E4%B8%AA%E6%95%99%E7%A8%8B ">Haskell趣味指南</a></br>
  <a href="https://www.haskell.org/">Hashell:An advanced purely-functional programming language </a></br>
  <a href="http://www.cs.nott.ac.uk/~gmh/book.html "> Programming in Haskell</a></br>
  <a href=" http://www.scs.stanford.edu/11au-cs240h/">Hashell Mit Course</a></br>

<p> Fortran:</br>
  <a href="http://www.personal.psu.edu/jhm/f90/lectures/quickref.html"> fortran90</a></br>
  <a href="http://people.sc.fsu.edu/~jburkardt/">John Burkardt</a> </br>
  <a href=" http://jblevins.org/mirror/amiller/#pzeros">Alan-Miller</a></br>
  <a href="http://micro.ustc.edu.cn/Fortran/">Fortran收集 </a></br>
  <a href="http://pan.baidu.com/s/1gdCN1T5"><font color="red">工程数值方法</font></a></br>
  <a href=" https://github.com/jueqingsizhe66/gtk-fortran">fortran-gtk</a></br>
  <a href="http://203.195.149.196/ldt9v/ebook/Modern_Fortran_Explained.pdf "> 《Modern Fortran Explained》(高级)</a></br>
  <a href="http://203.195.149.196/ldt9v/ebook/Fortran95_2003_Science_Project_SongYeZhi.zip ">《Fortran95~2003数值计算》(宋叶志)</a></br>
 
   
</p>

<p> Java:</br>
  <a href="http://a-little-java-a-few-patterns.readthedocs.org/zh_CN/latest/index.html"> A little Java (visitor pattern)</a></br>
  <a href="http://www.mkyong.com/"> Mkyong-java8</a></br>
  <a href="http://howtodoinjava.com/ "> how-to-do-in-java</a></br>
  <a href="http://stackoverflow.com/ "> StackOverflow问题堆栈 </a></br>
  <a href="http://www.blogjava.net/ ">BlogJava</a></br>
  <a href="http://www.importnew.com/ "> Java 新闻</a></br>
  <a href="http://ifeve.com/category/java/ "> 并发编程网</a></br>
  <a href="http://www.iteye.com/blogs ">IT 视角 </a></br>
  <a href="http://www.iteye.com/forums/tag_good/Java%E7%BB%BC%E5%90%88 ">IT 视角之java综合(SSH) </a></br>
  <a href="http://rednaxelafx.iteye.com/category/22617 ">IT 视角之rednaxelafx </a></br>
  <a href="http://droidyue.com/ ">技术小黑屋 </a></br>
  <a href="https://mouxuejie.com/ "> 某学姐 </a></br>
  <a href="http://gudong.name/ "> 咕咚-handler  </a></br>
  <a href="http://www.superqq.com/ "> ios-自媒体  </a></br>
  <a href="http://blog.csdn.net/jackfrued/ "><font color="red"> CSDN-骆昊的技术专栏</font> </a></br>
  <a href="http://www.adrop.me/cat/tech/java/ "> Adrop 自留地</a></br>
  <a href="http://www.programcreek.com/ "> Programcreek</a></br>
  <a href="http://java-performance.info/ "> Java-Performance(JP)</a></br>
  <a href="http://www.ibm.com/developerworks/cn/java/ "> IBM Java开发者社区</a></br>
  <a href="http://shipilev.net/ "> Aleksey Shipilëv: One Stop Page </a></br>
  <a href="http://www.pandablog.cn/?cat=9 "> 熊猫大仙</a></br>
  <a href="http://www.pixelstech.net/article.php?type=all "> pixelstech</a></br>
  <a href="http://timyang.net/ "> 后端技术-java</a></br>
  <a href="http://www.adam-bien.com/roller/abien/ "> abian德国Javaee</a></br>
  <a href="https://javax0.wordpress.com/ "> Java纯粹(匈牙利) </a></br>
  <a href="https://antoniogoncalves.org/ ">JAVAEE协议作者 (法国)-图文并茂 </a></br>
  <a href="http://www.importnew.com/7469.html "> 100个小链接 </a></br>

</p>

<p> Java github repos: </br>
  <a href="https://github.com/akullpp/awesome-java "> awesome-java一些常用的库链接</a></br>
  <a href="https://github.com/codefollower/My-Blog ">  codefollowers</a></br>
  </p>

<p> JAVA API: </br>
   <a href="https://docs.oracle.com/javaee/7/api/  "> JAVAEE 7 API</a></br>
  <a href="https://docs.oracle.com/javase/8/docs/api/index.html  ">  JAVASE 8 API</a></br>
  <a href="https://struts.apache.org/maven/struts2-core/apidocs/index.html "> <font color="red">Struts2core 2.5</font> </a></br>
  <a href="http://docs.jboss.org/hibernate/search/5.6/api/ "> <font color="red">Hibernate5.6 </font></a></br>
  <a href="http://spring.io/docs/reference "><font color="red">Spring系列文档</font> </a></br>
  <a href="http://docs.spring.io/spring/docs/4.3.0.RC1/javadoc-api/ "><font color="red">Spring Framework</font> </a></br>

</p>

<p> Bash:</br>
  <a href="http://vbird.dic.ksu.edu.tw/linux_basic/0320bash.php ">鸟哥的私房菜</a></br>
  <a href=" http://www.thegeekstuff.com/bash-101-hacks-ebook/">Bash 101 Hacks</a></br>
</p>

<p> Perl:</br>
  <a href="http://bbs.pinggu.org/thread-4890642-1-1.html">Learning Perl(7th) 2016 入门 </a></br>
  <a href="https://zhidao.baidu.com/share/2e40aed238e8a3f0fdb8d8148aa88565.html">The Immediate Perl(2th) 2006 中级 </a></br>
  <a href="http://www.jb51.net/books/24569.html"> Mastering Perl 高级</a></br>
  <a href="http://download.csdn.net/detail/blkf/4131770">Perl Programming (4th) (Larry Wall) </a></br>
  <a href="http://www.tutorialspoint.com/perl/perl_oo_perl.htm ">Perl Object Orient Programming(perl oop) </a></br>
  <a href="http://vdisk.weibo.com/s/zcetMufbD44U0">Perl Best Practice(Domian Conway) 2006 终极</a></br>
  <a href="http://wwwacs.gantep.edu.tr/docs/perl-ebook/ch19.htm">Perl Object Orient Programming(by Kamran Husain) </a></br>
  <a href="http://www.ibm.com/developerworks/cn/linux/sdk/perl/perl-1/index.html ">一篇写得不错的perl intro</a></br>
  <a href="http://dbi.perl.org/docs/">Perl DBI </a></br> 
  <a href="http://www.tutorialspoint.com/perl/perl_database.htm">Perl DataBase Management </a></br>
  <a href="http://www.tutorialspoint.com/perl/perl_cgi.htm ">Perl CGI script </a></br>
  <a href="http://www.tutorialspoint.com/perl/perl_modules.htm">Writing Perl Module</a></br>
</p>


  <p>English: </br>
    <a href="http://book.douban.com/subject/1014914/"> 《英语魔法俱乐部》</a>一本相当不错的英语语法书。
    <a href="http://vdisk.weibo.com/search/?type=public&keyword=%E9%A3%8E%E6%A0%BC%E7%9A%84%E8%A6%81%E7%B4%A0">风格的要素(Element of Style)</a> 英语写作的圣经</br>
    <a href="http://www.geraldmweinberg.com/Site/On_Writing.html">WeinBerg On Writing:The fieldstone method </a> 收集WeinBerg Stones</br>
 
  </p>
  <p> 流体力学：</br>
  <a href="http://vdisk.weibo.com/s/uuCAVsYacltnf">计算流体力学入门(安德森)</a></br>
  <a href="http://vdisk.weibo.com/search/?type=public&keyword=%E7%A9%BA%E6%B0%94%E5%8A%A8%E5%8A%9B%E5%AD%A6%E5%9F%BA%E7%A1%80"><font color="red">空气动力学基础(安德森)</font> </a></br>
  <a href="http://vdisk.weibo.com/s/dgA_ls6t1ywY5 ">计算流体力学与传热学(陶文铨)</a></br>
  <a href="http://dyfluid.com/ ">东岳流体</a></br>
  <a href="http://blog.sina.com.cn/openfoamresearch "> 苏军伟-sina</a></br>


  </p>

  <p> 数学:</br>
    <a href="http://ocw.mit.edu/faculty/gilbert-strang/">Gilbert Strang Professor 微积分，线性代数，微分方程</a> </br> 
    <a href="http://math.mit.edu/~rbm/ "> Richard Melrose 泛函分析</a></br> 
    <a href="http://homepage.ntlworld.com/ivan.wilde/notes/ ">Dr Ivan F Wilde 复分析</a></br>
  </p>
  <p> Machine Learning:(降维和优化) Support Vector Machine</br>
    <a href="http://blog.csdn.net/v_july_v/article/details/7624837"><font color="red">July SVM三层境界</font></a> </br> 
    <a href="http://vdisk.weibo.com/u/1580904460 ">July Vdisk</a> </br> 
    <a href="http://www.blogjava.net/zhenandaci/archive/2009/03/15/259786.html "> Jason Java Jacal</a></br> 
    <a href="http://www.csie.ntu.edu.tw/~cjlin/libsvm/ ">LibSvm: </a></br>
    <a href="http://www.svms.org/vc-dimension/ ">Vc-dimension</a></br>
    <a href="http://www.autonlab.org/tutorials/svm15.pdf ">内基梅隆大学carnegie mellon university(CMU) Svm Tutorials</a></br>
    <a href="http://120.52.72.51/www.cmlab.csie.ntu.edu.tw/c3pr90ntcsf0/~cyy/learning/tutorials/SVR.pdf ">SVR :回归分析</a></br>

    <a href="http://blog.csdn.net/zhzhl202/article/details/8197109 ">文本分类和SVM</a></br>
    <a href="http://www.cnblogs.com/jerrylead/tag/Machine%20Learning/ ">斯坦福机器课程学习笔记</a></br>
    <a href="http://www.cnblogs.com/jerrylead/archive/2012/05/08/2489725.html ">斯坦福大学的原始讲义</a></br>
    <a href="http://www.mit.edu/~9.520/spring11/slides/class06-svm.pdf ">MIT SVM讲义</a></br>
    <a href="http://icml2008.cs.helsinki.fi/papers/266.pdf ">SVM优化</a></br>
    <a href="http://blog.csdn.net/qll125596718/article/details/8248249 ">最小二乘法及其实现</a></br>
    <a href="http://vdisk.weibo.com/s/s-XOVNRQc_reY ">《数理统计学简史》陈希孺院士著  </a></br>
    <a href="http://vdisk.weibo.com/s/BZndAHHdASslv ">《最优化理论与算法》(第2版)－陈宝林 </a></br>
    <a href="http://www.52nlp.cn/tag/%E6%AD%A3%E6%80%81%E5%88%86%E5%B8%83%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F ">正态分布的前世今生</a></br>

  </p>
  <p>Climing and Take a tourist</p>
    <h5>Contact Us</h5>
<hr style="color:#990000;border:1px dotted">
    Email:<a href="zhaoturkkey@163.com">zhaoturkkey@163.com</a></br>
         <a href="36559660@qq.com">36559660@qq.com</a>

  </article>
  <p><img src="/images/wood.jpg"  alt="zhaoturkkey@gmail.com" /></p></section>
</section>

<section>
  <h1>分类目录</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/fast/'>Fast (4)</a></li>
<li class='category'><a href='/blog/categories/html/'>HTML (1)</a></li>
<li class='category'><a href='/blog/categories/haskell/'>Haskell (21)</a></li>
<li class='category'><a href='/blog/categories/jsdom/'>JSDom (3)</a></li>
<li class='category'><a href='/blog/categories/javabasic/'>JavaBasic (22)</a></li>
<li class='category'><a href='/blog/categories/javascript/'>JavaScript (3)</a></li>
<li class='category'><a href='/blog/categories/linux/'>Linux (20)</a></li>
<li class='category'><a href='/blog/categories/lisp/'>Lisp (1)</a></li>
<li class='category'><a href='/blog/categories/mysql/'>Mysql (2)</a></li>
<li class='category'><a href='/blog/categories/tecplot/'>Tecplot (1)</a></li>
<li class='category'><a href='/blog/categories/error/'>error (1)</a></li>
<li class='category'><a href='/blog/categories/fortran/'>fortran (4)</a></li>
<li class='category'><a href='/blog/categories/git/'>git (3)</a></li>
<li class='category'><a href='/blog/categories/gnuplot/'>gnuplot (1)</a></li>
<li class='category'><a href='/blog/categories/graphviz/'>graphviz (1)</a></li>
<li class='category'><a href='/blog/categories/humor/'>humor (1)</a></li>
<li class='category'><a href='/blog/categories/incompact3d/'>incompact3d (4)</a></li>
<li class='category'><a href='/blog/categories/jquery/'>jQuery (2)</a></li>
<li class='category'><a href='/blog/categories/life/'>life (19)</a></li>
<li class='category'><a href='/blog/categories/makefile/'>makefile (2)</a></li>
<li class='category'><a href='/blog/categories/markdown/'>markdown (4)</a></li>
<li class='category'><a href='/blog/categories/matlab/'>matlab (2)</a></li>
<li class='category'><a href='/blog/categories/openfoam/'>openfoam (1)</a></li>
<li class='category'><a href='/blog/categories/perl/'>perl (1)</a></li>
<li class='category'><a href='/blog/categories/physics/'>physics (1)</a></li>
<li class='category'><a href='/blog/categories/prolog/'>prolog (4)</a></li>
<li class='category'><a href='/blog/categories/python/'>python (1)</a></li>
<li class='category'><a href='/blog/categories/scheme/'>scheme (35)</a></li>
<li class='category'><a href='/blog/categories/vim/'>vim (2)</a></li>
<li class='category'><a href='/blog/categories/xml/'>xml (1)</a></li>

  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/02/07/%5B%3F%5D-fen-you-qu-de-fortrandong-tai-jing-tai-lian-jie-wen/">一份有趣的fortran动态静态链接文</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/02/07/fastdiao-shi/">FAST调试</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/02/01/wen-xi-zhi-fen/">文戏之分</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/01/22/perl-summary/">Perl_Summary</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/01/22/how-to-learn-one-technique/">How_to_learn_one_technique</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/jueqingsizhe66">@jueqingsizhe66</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jueqingsizhe66',
            count: 2,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/zhaoturkkey@gmail.com?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>


<section>
<h1>Zhao's Douban</h1>
<div>
 <script type="text/javascript" src="http://www.douban.com/service/badge/50717256/?selection=latest&amp;picsize=small&amp;hideself=on&amp;show=collection&amp;n=8&amp;cat=drama%7Cmovie%7Cbook%7Cmusic&amp;columns=2"></script>
</div>
</section>
<section>
<h1>Recent Comments</h1>
<ul class="ds-recent-comments" data-num-items="10" data-show-avatars="0" data-show-time="1" data-show-title="0" data-show-admin="0" data-excerpt-length="18"></ul>

</section>
<section>
  <h1>盟友</h1>
  <ul>
    <li><a href="http://www.cfd-online.com/">CFD1</a></li>
    <li><a href="https://nwtc.nrel.gov/">NREL-NWTC </a></li>
    <li>
      <a href="http://mindhacks.cn/">刘未鹏MIND HACKS</a>
    </li>
    <li>
      <a href="http://www.cnblogs.com/Solstice/">陈硕</a>
    </li>
    <li>
      <a href="http://tianchunbinghe.blog.163.com/">冰河-网易</a></br>
      <a href="http://weibo.com/tianchunbinghe?from=myfollow_all&is_all=1#_rnd1455615502647">冰河-新浪</a>
    </li>
    <li>
      <a href="http://yinwang.org/">王垠</a></br>
      <a href="http://www.jianshu.com/users/b1dd2b2c87a8/latest_articles">王垠-简书</a>
    </li>
    <li>
      <a href="http://www.huzheng.org/ ">胡正</a>
      </li>
    <li>
      <a href="http://xahlee.org/ ">李杀</a>
      </li>
    <li>
      <a href="http://www.is.pku.edu.cn/~qzy/ "> 裘宗燕</a>
      </li>
    <li>
      <a href=" http://blog.csdn.net/v_july_v"> July</a>
      </li>
    <li>
      <a href="http://deathking.github.io/ "> deathKing: Learning-in-SICP</a>
      </li>



    <li>
      <a href=" https://en.wikipedia.org/wiki/Scheme_%28programming_language%29"> scheme wikipedia(history of scheme)</a>
    </li>
    <li>
      <a href="https://inst.eecs.berkeley.edu/~cs61a/fa14/proj/scheme/ ">CS61a:a scheme interpreter </a>
      <a href="https://github.com/dhrushilbadani/Scheme "> interpreter with python implementation </a>
    </li>
    <li>
      <a href="https://cgi.soic.indiana.edu/~c311/doku.php "> C311/B521/B621 </a>
    </li>
    <li>
      <a href="http://minikanren.org/ "> MiniKanren</a>
    </li>
    <li>
      <a href=" http://lambda-the-ultimate.org/"> Lambda the ultimate</a>
    </li>
    <li>
      <a href="http://people.csail.mit.edu/jaffer/SLIB "> The SLIB Portable Scheme library</a>
    </li>

    <li>
      <a href="http://v.qq.com/cover/p/pd51cjco90d1rc1.html?vid=o0015dvd155 "> 北平无战事43:承受</a>
    </li>


  </ul>
</section>
<section>
<h1>My website link<abbr title="The word 'QR Code' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'QR Code', not for image.">&trade;</abbr></h1>
<a href="http://jueqingsizhe66.github.io/blog/2014/05/14/poisson/"><img src="http://chart.apis.google.com/chart?chs=150x150&cht=qr&chld=|0&chco=165B94&chl=http://jueqingsizhe66.github.io/blog/2014/05/14/poisson/" alt="post-qrcode"></a></section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Ye Zhaoliang -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>







</body>
</html>
